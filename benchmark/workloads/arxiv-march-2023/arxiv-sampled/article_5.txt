
























matrix
matrix,shapes,backgrounds












.tifpng.png`convert #1 `dirname #1`/`basename #1 .tif`.png















 


com

yes


        [t]1in[footnote]



yes






equationsection

cl


theorem[equation]Theorem
*theorem'Main Theorem
*theoremnnTheorem
question[equation]Question
questions[equation]Question
prop[equation]Proposition
reductionReduction
claim[equation]Claim
*clamClaim
cor[equation]Corollary
lemma[equation]Lemma
*GromovGromov's Lemma
thmiTheorem

*namedtheorem

named[1]

definition
definition[equation]Definition
*remRemark
remark[equation]Remark
convention[equation]Convention
example[equation]Example
facts[equation]Facts






(
    [
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    Mathematics and Statistics Dept., University of North Carolina at Greensboro, Greensboro, NC 27412, USAt_fernos@uncg.eduDept. of Mathematics, Temple University, Philadelphia, PA 19122, USAdfuter@temple.eduSchool of Mathematics, University of Bristol, Bristol BS8 1UG, UKmarkfhagen@posteo.net
    A finite-dimensional CAT(0) cube complex X is equipped with several well-studied boundaries. These include the 
    Tits boundaryX (which depends on the CAT(0) metric), the Roller boundaryX (which 
    depends only on the combinatorial structure), and the simplicial boundaryX (which also depends only on the combinatorial structure). We use a partial order on a certain quotient of 
    X to define a simplicial Roller boundary  X. Then, we show that X, X, and X are all homotopy equivalent, (X)–equivariantly up to 
    homotopy. As an application, we deduce that the perturbations of the CAT(0) metric introduced by Qing do not affect the equivariant homotopy type of the Tits boundary. Along the way, we develop a 
    self-contained exposition providing a dictionary among different perspectives on cube complexes.
    Homotopy equivalent boundaries of cube complexes
        Mark Hagen
        March 30, 2023
    ================================================
    
    
    
    § INTRODUCTION
    
    
    CAT(0) cube complexes, which exist in many guises in discrete mathematics (see e.g. <cit.>), were introduced into 
    group theory by Gromov <cit.> and have since taken on a central role in that field.  As 
    combinatorial objects, CAT(0) cube complexes are ubiquitous due to their flexible, functorial construction from set-theoretic data <cit.>.  This has led to an 
    industry of cubulating groups, i.e. 
    constructing group actions on CAT(0) cube complexes in order to transfer  information from the highly organized cubical structure to the group.  Probably the best known application of this method is the resolution of the virtual 
    Haken and virtual fibering conjectures in 3–manifold theory <cit.>.
    
    The utility of CAT(0) cube complexes comes from the fact that they simultaneously exhibit several types of structures.  They have an organized combinatorial structure coming from their hyperplanes/half-spaces; this is closely 
    related to the very tractable geometry of their 1–skeleta, which are median graphs<cit.>.  On the other 
    hand, endowing the complex with the piecewise-Euclidean metric in which cubes are Euclidean unit cubes, one gets a CAT(0) 
    space.  So, in studying CAT(0) cube complexes, and groups acting on them, one has a wide variety of tools.
    
    This paper is about the interplay between the CAT(0) and combinatorial structures, at the level of boundaries.    
    We construe the term “boundary” broadly: we include not just  spaces arising as frontiers of injections into compact spaces, 
     but also other spaces encoding some sort of behavior at infinity or large-scale asymptotic structure, such as the Tits boundary. 
    
    
    
    
    
     §.§ A plethora of boundaries
     
    CAT(0) cube complexes have several natural boundaries, each encoding different information, and each defined in terms 
    of either the CAT(0) metric structure or the combinatorial structure coming from the hyperplanes.  Fixing a 
    finite-dimensional CAT(0) cube complex X, one has the following list of boundaries:
    
      *  The visual boundaryX. 
          The visual boundary can be defined for any CAT(0) space; see 
    <cit.>.  Points are asymptotic equivalence 
    classes of CAT(0) geodesic rays. The visual topology is defined in such a way 
    that, roughly speaking, rays that fellow-travel for a long time are close.  When X is locally finite, X∪ X is 
    a compactification of X.  While it is a very useful object, we do not study the visual boundary in this paper.
    
    
      *  The Tits boundaryX.  As with X, the points in X correspond to asymptotic equivalence classes of CAT(0) 
    geodesic rays, but the topology is finer than the visual topology.  Specifically, we equip X with the Tits 
    metric: by taking a supremum of angles between rays
     one obtains the angle metric, and the 
    induced length metric is the Tits metric, which is CAT(1); see <cit.>.  The Tits boundary encodes much of the 
    geometry of a CAT(0) space; for example, spherical join decompositions of the Tits boundary correspond to product 
    decompositions of the space <cit.>.  Although X is in general not compact even when X is 
    proper, it is  of interest for  other reasons, such as encoding “partial flat regions” in X. For example, endpoints 
    of axes of rank-one isometries are isolated points, while flats in X yield spheres in X.  We recall the definition 
    of X in Definition <ref>.
    
    
      *  The simplicial boundaryX, from <cit.>, is an analogue 
    of the Tits boundary depending on the hyperplane structure, rather than on the CAT(0) metric.  The idea is that certain sets 
    of hyperplanes — termed unidirectional boundary sets (hereafter, UBSes) — identify “ways of approaching infinity in X.”  Containment of UBSes (modulo finite differences) gives a partial order on 
    UBSes, and this order gives rise to a simplicial complex X (see Definition <ref>).  Here are three helpful examples. First, the simplicial boundary of a tree (or, more generally, of a δ–hyperbolic cube complex) is a discrete set 
    of 0–simplices. Second, the simplicial boundary of the standard square tiling of [0,∞)^2 is a 1–simplex, whose 0–simplices correspond to the sub-UBSes consisting of the vertical hyperplanes 
    and the horizontal hyperplanes. Third,  the staircase obtained from this square tiling by considering only the cubes below some increasing, unbounded function also has simplicial boundary a 
    1–simplex. (See Figure <ref>.) The maximal simplices of X encode such “generalized orthants” (namely, convex hulls of ℓ^1–geodesic rays) in X in roughly the same way that the Tits boundary encodes “partial flats.”
    
    The 
    simplicial boundary has been used to study quasi-isometry invariants like divergence<cit.> and 
    thickness<cit.> for groups acting on cube complexes, and has been generalized in the context of 
    median spaces<cit.> as a tool for proving a Tits alternative for groups acting on such spaces.
    
    
    
    
      *  The Roller boundaryX gives another way of compactifying X, using the half-space structure associated to the hyperplanes.
      Each hyperplane ĥ of X has two complementary components, called half-spaces, h and h^*, which induce a two-sided partition of 
    X^(0).  Each vertex x∈ X is completely determined by specifying the collection of half-spaces that contain it.  This gives an injective map X^(0)→ 2^ℌ, where 
    ℌ denotes the set of half-spaces.  The closure of the image of X^(0) in the Tychonoff topology is the Roller compactificationX, and X=X∖ X^(0) is the 
    Roller boundary of X. (See Definition <ref>.) 
    
    
    Of the boundaries of X that are defined in terms of the cubical structure only, the Roller boundary is perhaps the most well-studied. It has been used to prove a variety of results about CAT(0) 
    cube complexes and groups acting on them.
    
    For example, the Roller boundary plays a key role in the proof that irreducible lattices in _2×_2 always 
    have global fixed points in any action on a CAT(0) cube complex, while reducible actions always admit proper cocompact 
    actions on CAT(0) cube complexes <cit.>. 
    
    Nevo and Sageev identified the Roller boundary as a model for the Furstenberg–Poisson boundary of a cocompact lattice in 
    (X)<cit.>.  Fernós generalized this result  
     to groups acting properly and non-elementarily on finite dimensional X, and also proved a Tits alternative 
    <cit.>.   The same paper identifies an important subset of the Roller boundary: the regular points, 
    which 
    correspond to “hyperbolic” directions in various senses.  
    
    In particular,  the set of regular points with the induced 
    topology is (X)–equivariantly homeomorphic with the boundary of the (hyperbolic) contact graph<cit.>.  The set of regular points is used in <cit.> to find rank-one isometries under more 
    general conditions than in previous 
    work <cit.>.  The method in <cit.> is to use convergence of random walks to regular points to 
    deduce the existence of regular elements without assuming that the ambient group is a lattice.
    
    The set of regular points also features in the proof of marked length spectrum rigidity <cit.>, 
    and was independently identified by Kar and Sageev, who used it to study property P_naive and hence 
    C^*–simplicity for cubulated 
    groups <cit.>.  Finally, the Roller boundary has recently been generalized in the context of median spaces 
    <cit.>.
    
      
      
      *  The simplicial Roller boundaryX is constructed as follows.
         The Roller boundary X carries a natural equivalence relation, first introduced 
     by Guralnik <cit.>, where two points 
    are equivalent if they differ on finitely many half-spaces.  The equivalence classes, called Roller classes, play a fundamental role in this paper.  Part of the reason for this is that the set of Roller 
    classes carries a natural partial order, which admits several equivalent useful characterizations (see Lemma <ref>).  The simplicial Roller boundaryX is the simplicial 
    complex realizing this partial order (see Definition <ref>).  
    
    In this paper, we build on earlier work relating Roller classes to CAT(0) geodesic rays.  Specifically, Guralnik in <cit.> recognized that each equivalence class of CAT(0) geodesic rays  determines a 
    Roller class.  Conversely, in <cit.>, it is shown that each Roller class determines a subset of the Tits boundary which admits a canonical circumcenter.  These observations 
    are crucial for our arguments: Definition <ref> depends on the latter and Definition <ref> is based on the former.
    
    We also note that X is isomorphic to the 
     combinatorial boundary defined and studied by Genevois <cit.>. In that work, he explains that the combinatorial boundary is isomorphic to the 
    face-poset of a naturally-defined subcomplex of X<cit.> and is isomorphic to X<cit.>.  (More precisely, Genevois' work yields the map  from Corollary <ref> below, although <cit.> does not 
    explicitly mention a homotopy equivalence.)  
    
    
    For each of these boundaries, the action of the group (X) of cubical automorphisms of X extends to an action on the 
    boundary preserving its structure. The actions on X and X are by homeomorphisms, the action on X is by isometries of the Tits metric, and the actions on X and X are by simplicial automorphisms.
    
    The definitions of the simplicial boundary and the simplicial Roller boundary are conceptually similar. Part of the work 
    in this paper is making that similarity precise, by establishing a correspondence between Roller classes and equivalence 
    classes of UBSes. This line of work culminates in Corollary <ref>, which gives explicit maps between X and a 
    natural subcomplex of X. These maps are (X)–equivariant homotopy equivalences, although in general they are 
    not simplicial isomorphisms.  Then, in Proposition <ref>, we upgrade this to a homotopy equivalence 
    between X and the whole of X.
    
    One glimpse of a relationship between X and X comes from UBSes associated to geodesic rays. Given a geodesic ray α→ X, in either the CAT(0) metric or the combinatorial metric, the set of hyperplanes crossing α (denoted (α)) is always a UBS. A UBS  is called ℓ^1–visible (resp. ℓ^2–visible) if it is has finite symmetric difference with (α) for a combinatorial (resp. CAT(0)) geodesic α. Figure <ref> shows examples of both ℓ^1–invisible and ℓ^2–invisible UBSes. Despite those caveats, ℓ^2–visible UBSes provide a way to map points of X to classes in X; a similar construction also provides a map to X. 
    
    
    
     §.§ Main result
      Our main theorem relates X, X, and  X via maps that are (X)–equivariant up to homotopy.  
    It helps to introduce the following terminology.  
    
    
    Suppose 
    that A,B are topological spaces with a group G acting on both spaces by homeomorphisms.  A map f  A → B is called a
    a  homotopy equivalence 
    if f is a homotopy equivalence, and furthermore  g∘ f and f∘ g are 
    homotopic for every g∈ G.  If such an f exists, we say that A,B are  homotopy equivalent.
    
    
    It is immediate to check that the property of being  homotopy equivalent is an equivalence relation. 
    Indeed, the composition of two  homotopy equivalences is a  homotopy equivalence. Furthermore, any homotopy inverse of a  homotopy equivalence is itself a
     homotopy equivalence. 
    
    
    
    Let X be a finite-dimensional CAT(0) cube complex.  Then 
    we have the following commutative diagram of  homotopy equivalences between boundaries of X:
    
    
      X       ^       X  
       _      _   
          _ X      
    In particular, the spaces X, X, X are all  homotopy equivalent, where X is equipped with the metric topology and X, X are equipped with either the 
    metric or the weak topology.
    
    
    In the above diagram, the letter S stands for Simplicial, the letter R for Roller-simplicial, and the letter T 
    for Tits.  The map  is an  homotopy equivalence from the simplicial boundary to the Tits 
    boundary, and similarly for the other two.  The map  is provided by Corollary <ref>, and the 
    map  comes from Proposition <ref>.  The map  is just the composition =∘.
    
    Some intuition behind the theorem can be gleaned from the following simplified situation. A cube complex X is called fully visible if every UBS is ℓ^1–visible. 
     When X is fully visible, UBSes correspond to combinatorial 
    orthants in X (i.e. products of combinatorial geodesic rays) <cit.>, and Theorem <ref> can be understood as relating 
    combinatorial orthants to CAT(0) orthants. See <cit.>, where a proof is sketched that the simplicial and 
    Tits 
    boundaries are homotopy equivalent under the restrictive hypothesis of full visibility.  However, 
     full visibility is a very strong and somewhat mysterious hypothesis: it is not known to hold even if X 
    admits a proper cocompact group action <cit.>. Thus 
    Theorem <ref> is more satisfying (and difficult) because it does not assume this restrictive hypothesis. In order to prove the theorem, we have 
    to understand combinatorial convex hulls of CAT(0) geodesic rays, which is a much more delicate affair when one is not 
    simply assuming that these hulls can be taken to contain Euclidean orthants.
    
    Theorem <ref> also motivates the introduction of several new technical tools for relating the geometry of CAT(0) geodesic rays to the combinatorics of hyperplanes. We believe that these tools, explained in Section <ref>, are of independent interest.
    
    
    
    
      
    
     §.§ Invariance of CAT(0) boundaries for cubulated groups
    
    A group G is called CAT(0) if there is a proper CAT(0) space X on which G acts 
    geometrically (properly and cocompactly).  Multiple CAT(0) spaces might admit a geometric G–action and witness that G is a CAT(0) group.  Since we are often 
    interested in invariants of the group itself, it is natural to look for features of the geometry of X that  depend 
    only on G.  For instance, in the context of a Gromov hyperbolic group G, recall that all hyperbolic groups with a geometric G–action have Gromov boundaries that are G–equivariantly homeomorphic. So one might wonder whether a similar result might hold for CAT(0) groups that are not hyperbolic.
    
    A famous result of Croke and Kleiner  <cit.>, on 
    which we elaborate more below, shows that this is not the case.  Explicitly, they considered the right-angled Artin group
    
        G=⟨ a,b,c,d : [a,b],[b,c],[c,d]⟩,
    
    whose Cayley 2-complex X_π/2 is a CAT(0) square complex. The subscript π/2 emphasizes the angles at the corners of the 2–cells. Viewing the 2–cells as Euclidean squares with 
    side length 1, we obtain a CAT(0) space where G acts geometrically.  Croke 
    and Kleiner deformed the squares of X into rhombi that have angles α and π - α, producing a perturbed 
    CAT(0) metric X_α,
    and showed that this perturbation changes the homeomorphism type of the visual boundary X_α. Subsequently, Wilson
    <cit.> showed that the visual boundaries of X_α and X_β are homeomorphic only if the angles satisfy 
    α=β, hence these perturbations produce  uncountably many homeomorphism types of boundaries.  Further examples are 
    provided by Mooney <cit.>, who exhibited CAT(0) knot groups G 
    admitting uncountably many geometric actions on CAT(0) spaces, all with different visual boundaries.  Hosaka <cit.> 
    has given some conditions on G,X,Y implying that there is an equivariant homeomorphism X→ Y 
    continuously extending the quasi-isometry X→ Y coming from orbit maps, but the preceding examples show that any such 
    condition will be hard to satisfy.
    
    So, one has to look for weaker results or less refined invariants, or ask slightly different questions.  This has stimulated 
    a great deal of work in various directions.  
    
    In the context of 2–dimensional CAT(0) complexes, there are more positive results obtained by replacing the visual 
    boundary X by the Tits boundary X, and passing to a natural subspace.  Specifically, the core of X is the union of 
    all embedded circles in X. 
     Xie <cit.> showed that if G acts 
    geometrically on CAT(0) 2–complexes X and Y, then the Tits boundaries X and Y have homeomorphic cores.
    (This is weaker than Xie's actual statement; compare <cit.>.)   In the Croke–Kleiner example, the core is a G–invariant connected 
    component, while the rest of the Tits boundary consists of uncountably many isolated points and arcs.  
    
    There is a closely related result due to Qing, which inspired us to consider cuboid complexes in the present paper.  
    Another way to perturb the CAT(0) metric on a CAT(0) cube complex X is to leave the angles alone, but to vary the lengths 
    of the edges in such a way that 
    edges intersecting a common  hyperplane are given equal length. In this perturbation, each cube becomes a Euclidean box 
    called a cuboid.  The resulting path metric is still CAT(0), at least when there are uniform upper and lower bounds 
    on 
    the edge-lengths. In particular, this happens when some group G acts on X with 
    finitely many orbits of hyperplanes, and the edge-lengths are assigned G–equivariantly.   We explain the details in 
    Section <ref>,  
    where we define a G–admissible hyperplane rescaling in Definition <ref> and  show in 
    Lemma <ref> that the resulting path-metric space (X,^ρ_X) 
    is CAT(0) and G continues to act by isometries.  Cuboid complexes have been studied by various authors, including Beyrer 
    and Fioravanti <cit.>.
    
    Qing <cit.> studied the visual boundary of the CAT(0) cuboid metric under perturbation of the edge-lengths. She showed that 
    the visual boundaries of the CAT(0) cuboid complexes obtained from the  Croke–Kleiner complex X_π/2 are all 
    homeomorphic. More germane to the present paper, Qing also showed that the Tits boundaries of the rescaled cuboid complexes 
    are homeomorphic, but that no  equivariant homeomorphism exists.  (Roughly, the cores of any two such Tits boundaries are 
    homeomorphic by the result of Xie mentioned above. Via a cardinality argument, Qing extends the 
    homeomorphism over the whole boundary by sending isolated points/arcs to isolated points/arcs.  But this extension cannot be 
    done equivariantly because equivariance forces some isolated points to be sent to isolated arcs and vice versa.)  We will 
    return to cuboid complexes shortly.
    
    There are other results about homeomorphism type as a CAT(0) group invariant for certain classes of CAT(0) groups.  For 
    example, Bowers and Ruane <cit.> showed that if G is a product of a hyperbolic CAT(0) group and 
    ^D, then the visual boundaries of the CAT(0) spaces X and Y with a geometric G–action are equivariantly homeomorphic. However, this equivariant homeomorphism need not come from a continuous extension of a quasi-isometry X → Y.  Later, Ruane  <cit.> extended this result to the case where G is 
    a CAT(0) direct product of two non-elementary hyperbolic groups. 
    
    Around the same time, Buyalo studied groups of the form G=π_1(S)×ℤ, where S is a hyperbolic surface <cit.>. He constructed two distinct geometric G–actions on ℍ^2× and showed that while the two copies of ℍ^2× are G–equivariantly quasi-isometric, the Tits boundaries do not admit any G–equivariant quasi-isometry. 
    
    Since we are interested in G–equivariant results, it makes sense to seek more general positive results by replacing homeomorphism with a coarser equivalence relation.  This 
    has been a successful idea: Bestvina <cit.> proved that torsion-free CAT(0) groups have a well-defined visual 
    boundary up to shape-equivalence. 
    This was generalized by Ontaneda <cit.>, whose result removes the “torsion-free” 
    hypothesis.
    
    
    Homotopy equivalence is a finer equivalence relation than shape equivalence.  Might there be some result guaranteeing that the 
    homotopy type of the Tits boundary of X is to some extent independent of the choice of the CAT(0) space X, even if we 
    allow only homotopy equivalences between boundaries that respect the G–action in the appropriate sense? One precise version of this question appears below as Question <ref>.
    
    
    Motivated by Qing's results about perturbing the metric on a CAT(0) cube complex by changing edge lengths, we consider the 
    situation where G acts on the finite-dimensional CAT(0) cube complex X, and study the Tits boundaries of the CAT(0) spaces 
    that result from G–equivariantly replacing cubes by cuboids.  Now, the hyperplane combinatorics, and hence the simplicial 
    and Roller boundaries, are unaffected by this change.  And, for the unperturbed X, Theorem <ref> tells us 
    that the homotopy type of the Tits boundary is really a feature of the hyperplane combinatorics.  So, in order to conclude 
    that the homotopy type of the Tits boundary is unaffected by such perturbations of the CAT(0) metric, we just need to know 
    that Theorem <ref> holds for cuboid complexes as well as cube complexes.  
    Indeed, we show:
    
    
    
     Let X be a finite-dimensional CAT(0) cube complex and let G be a group acting by automorphisms on X. Let (X,^ρ_X) be the CAT(0) cuboid complex obtained 
    from a G–admissible hyperplane rescaling of X.  Then the original Tits boundary X, the perturbed Tits boundary (X,^ρ_X),  the simplicial boundary X, and the simplicial Roller boundary X are 
    all  homotopy equivalent. 
    
    
    The proof of this result only requires minor modifications to the proof of Theorem <ref>,
    essentially because convexity of 
    half-spaces and the 
    metric product structure 
    of hyperplane carriers persist in the CAT(0) cuboid 
    metric ^ρ_X.
    These small modifications  are described in 
    Sections <ref>, <ref>,  and <ref>. 
    
    The theorem implies, in particular, that if X admits a geometric action by a group G, then the  homotopy type of 
    the Tits boundary is unaffected by replacing the standard CAT(0) metric (where all edge lengths are 1) with a 
    cuboid metric obtained by rescaling edges G–equivariantly. This is perhaps evidence in favor of the possibility that the 
    results of Bestvina and Ontaneda about shape equivalence of visual boundaries <cit.> can be strengthened to results about  
    homotopy equivalence if one instead uses the Tits boundary:
    
    
    For which CAT(0) groups G is it the case that any two CAT(0) spaces X,Y on which G acts geometrically have  
    homotopy equivalent Tits boundaries?
    
    If G acts geometrically on CAT(0) cube complexes X,Y, are the simplicial boundaries of X,Y 
    homotopy equivalent?
    
    
     §.§ Quasiflats
    
    A remarkable theorem of Huang <cit.> says that if X is a d–dimensional CAT(0) cube complex, then any quasi-isometric embedding ^d→ X has image that is 
    Hausdorff-close to a finite union of cubical orthants, i.e. a convex subcomplex that splits as the product of rays.  This statement is important for the study of quasi-isometric rigidity in cubical groups, and it is natural to want to strengthen the 
    statement to cover quasi-isometric embeddings ^d→ X, where d is the largest dimension for which such a map exists, but X is allowed to be larger than d (although still 
    finite).  Natural examples where this strenthened form of Huang's theorem is useful include right-angled Coxeter groups.
    
    We believe that Theorem <ref> could be used as an ingredient in proving such a result.  Very roughly, the homotopy equivalence X→ X can be used to 
    produce, given a singular d–cycle z in X, a simplicial d–cycle z' in X represented by a finite collection of standard orthants in X.  By the latter, we mean there is a 
    finite collection of d–simplices in X whose union S carries z'.  The proof of Theorem <ref>,
    specifically Proposition <ref> and the nerve arguments in Sections <ref> and <ref>,
    should provide enough metric control on the map S→ X 
    to invoke a result of Kleiner–Lang <cit.> to deduce the strengthened quasiflats theorem.  
    Given that the 
    strengthened quasiflats theorem has recently been established by 
    Bowditch <cit.> and independently Huang–Kleiner–Stadler <cit.>, we have decided not 
    to pursue the matter in this paper.
    
    
    
    
    
     §.§ Ingredients of our proof
    
    
    As mentioned above, our primary goal is to elucidate the relationships among three boundaries: the simplicial boundary X, the simplicial Roller boundary X, and the Tits boundary X. 
    
    The first two boundaries that we study are combinatorial in nature. The primary difference is that the central objects in X are sequences of hyperplanes, whereas the central objects in X are sequences of half-spaces. After developing a number of lemmas that translate between the two contexts, we prove the following result:
    
    Corollary <ref>
    The barycentric subdivision of X contains a canonical, (X)–invariant subcomplex X. There are (X)–equivariant 
     simplicial maps X→ X and X →  X, with the following properties:
    
      * X→ X is  surjective.
    
      * X →  X  is an injective section of .  
    
      *  is a homotopy 
    equivalence with homotopy inverse  .
    
    
     In fact, all of X deformation retracts to X in an 
     (X)–equivariant 
     way. See Remark <ref>.
    
    In contrast to the the two combinatorial boundaries, the Tits boundary X is  inherently linked to the geometry of the CAT(0) metric on X.
    To relate the Tits boundary to the other two boundaries, we need to combinatorialize it: that is, we need to cover X by a certain collection of open sets, and then study the nerve of the 
    corresponding covering. Similarly, we cover each of X and X by simplicial subcomplexes, and study the resulting nerves. We will use two different versions of the nerve theorem to 
    show that a topological space (such as one of our boundaries) is homotopy equivalent to the nerve of a covering. The Open Nerve Theorem <ref> deals with open coverings and is 
    originally due to Borsuk <cit.>. The Simplicial Nerve Theorem <ref> deals with coverings by simplical complexes and is originally due to Björner 
    <cit.>. In fact, since Theorem <ref> is a G–equivariant statement, we need equivariant versions of both theorems, which have not previously appeared in the literature 
    to our knowledge. Consequently, Section <ref> contains self-contained proofs of both theorems. 
    
    
    
    A central object in our construction of nerves is the Tits boundary realization of a Roller class, or point in  the Roller boundary (see Definitions <ref>, <ref><ref> 
    ). In <cit.>, a Roller class v, yields a convex, visually compact subset of the Tits boundary X. Employing the work of Caprace–Lytchak <cit.> and 
    Balser–Lytchak <cit.>, this set has radius at most π/2 and
    a canonical circumcenter (v). A first approach might be to use these compacta to provide the 0–skeleton of a nerve for X that will be homotopy equivalent to X. However, 
    several issues arise. First, these associated convex closed sets must be made smaller so that their overlaps can be controlled. This is achieved by considering points in the Roller boundary versus 
    their classes.
    
    Secondly, the issue of ℓ^2–visibility, or rather invisibility must be addressed. A Roller class, (respectively a UBS) is ℓ^2–visible if it is the intersection (respectively union) of the deep half-spaces (respectively hyperplanes) naturally associated to a CAT(0) geodesic ray α.  As Figure <ref> shows, some Roller classes are not ℓ^2–visible, and invisible classes cause headaches when trying to connect this data to the Tits boundary. In particular, if v is an invisible Roller class, then we will have Q(v) = Q(w) for any Roller class w < v.
    To confront this challenge, we have to find a single  class which is maximal among the visible Roller classes represented by rays with endpoints in Q(v). Proving the existence of such a maximal class requires finding a single geodesic ray that is diagonal, in the sense that its convex hull is the union of the convex hulls of two geodesic rays.
    In particular, we need the following statement, which is of independent interest:
      
      
     Proposition <ref>
    Let α, β be CAT(0) geodesic rays with α(0) = β(0) ∈ X^(0).
    Suppose that (α)∪(β) is commensurate 
    with a UBS.  Then a=α(∞) and b=β(∞) are joined by a unique geodesic 
    g in X. Furthermore, any interior point c of g is represented by a CAT(0) geodesic ray γ 
    such that (γ)  = (α)∪(β).
    
      
    
    Next, 
    we consider maps between X and X that  relate these boundaries.
     The first of these maps, called ψ X → X, 
     is fairly easy to describe. A Tits point a ∈ X is represented by a CAT(0) geodesic ray α and  the intersection of half-spaces which are “deep" yields a (principal) Roller class ψ(a).  
     See Definition <ref> and Lemma <ref>. The reverse map  φ X → X is somewhat more delicate: given a Roller class v, we start with the circumcenter (v) ∈ Q(v) and then perturb (v) to a nearby point φ(v) that has slightly better properties. 
     See Definition <ref> and Proposition <ref> for details, and note that the perturbation uses Proposition <ref> in a crucial way. The upshot is that φ is a section of ψ on exactly the ℓ^2–visible classes: we have v = ψ(φ(v)) if and only if v is ℓ^2–visible (Lemma <ref>). 
    
     
    We can now construct nerves and prove results about them. We begin by defining the set (X) of all visible Roller classes that are maximal among all ℓ^2–visible classes. Then, we construct a simplicial complex _T whose vertex set is (X), with simplices corresponding to collections of Roller classes v_i whose Tits boundary realizations Q(v_i) all intersect. We check that this is indeed the nerve of a cover of X (Corollary <ref>). Then, we prove:
    
    Theorem <ref>
    There is an  homotopy equivalence from  the simplicial complex _T to X. 
    
    The proof of Theorem <ref> requires an open thickening. The sets Q(v) are closed (in fact, compact), and we do not have a version of the Nerve Theorem for closed covers. Thus we thicken up each compact set Q(v) to an open set U(v), in such a way that the intersection pattern of the open cover {U(v) :v∈(X) } is the same as that of the closed cover {Q(v):v∈(X)}. The thickening procedure involves some delicate CAT(0) geometry; see Proposition <ref>. As a result, we obtain an open cover of X whose nerve is isomorphic to the nerve of the closed cover, namely _T. Now, the Equivariant Open Nerve Theorem <ref> gives an  homotopy equivalence _T → X.
     
    There are two reasons why the  homotopy equivalence in Theorem <ref> is not (X)–equivariant. First, the Equivariant Open Nerve Theorem <ref> does not provide (X)–equivariance on the nose. Second, while the collection of Tits boundary realizations Q(v_i) is (X)–equivariant, the perturbed circumcenter map φ might not be. For these reasons,  homotopy equivalence is the strongest form of invariance that we can guarantee.
     
     In  Section <ref>, we use all of the above results  to complete the proof of Theorem <ref>. We already have an open cover of X whose nerve is _T. 
    Working in X, we focus attention on a subcomplex X whose vertex set corresponds to the ℓ^2–visible Roller classes, and then construct a cover of X by finite 
    simplicial complexes {Σ_v : v ∈ X}. It is not too hard to check that the nerve _ of this cover is isomorphic to _T, which implies that X and 
    X  are  homotopy equivalent (Proposition <ref>). To complete the construction of an  homotopy equivalence X → X, we build an  deformation retraction  ^ X → X; see Proposition <ref>. While the construction of this retraction is 
    mostly combinatorial, it relies on CAT(0) geometry and the perturbed circumcenter map φ at one crucial step.
     
    
    Finally,  the homotopy equivalence X → X is morally very similar to the simplicial map X→ X constructed in
     Corollary <ref>. To make the argument precise, we construct isomorphic nerves of simplicial covers of 
     X and X and apply the Equivariant Simplicial Nerve Theorem <ref> one final time.
    
    
    
    
     §.§ Expository content
    
    Part of our goal in this paper is to provide exposition of varying aspects of cubical theory. 
     CAT(0) cube complexes are ubiquitous objects that have been well-studied in many different guises. Accordingly, there are several different 
    viewpoints, and various important technical statements are stated and proved in a variety of different ways throughout the literature.  Therefore, we have endeavored to give a self-contained 
    discussion of CAT(0) cube complexes combining some of these viewpoints.  
    
    Also, throughout the paper, we make heavy use of the nerve theorem, for both open and simplicial covers. Results of this sort were originally proved by Borsuk <cit.>, and are now widely used in many slightly different forms.  To the best of our knowledge, the existing literature does not contain a version of the nerve theorem for covers of simplicial complexes by locally infinite families of subcomplexes, with a conclusion that provides equivariance with respect to group actions on the input data.
    Since we could not find a written account of such a result, we have given self-contained proofs (based on arguments in <cit.>) in Section <ref>.
    
    
    
     §.§ Section Breakdown
    
    Section <ref> establishes some language about simplicial complexes and proves equivariant versions of two nerve theorems.  Section <ref> is devoted to background on CAT(0) cube complexes and the Roller boundary.  In 
    Section <ref>, we discuss CAT(0) cuboid complexes coming from an admissible rescaling of the hyperplanes.  Section <ref> introduces the simplicial Roller 
    boundary. In Section <ref>, we introduce UBSes and the simplicial boundary, and relate these to Roller classes and the simplicial Roller boundary.  In Section <ref>, 
    we introduce the Tits boundary and prove some technical results relating CAT(0) geodesic rays to Roller classes and UBSes.  We apply these in Section <ref> to analyze the 
    realizations of Roller classes in the Tits boundary.  These results are in turn used in Section <ref> to prove that the Tits boundary is homotopy equivalent to a 
    simplicial complex _T arising as the nerve of the covering by open sets associated to certain Roller classes.  In Section <ref>, we realize this nerve as the nerve of a covering of the 
    simplicial Roller boundary by subcomplexes associated to Roller classes, and deduce Theorems <ref> and <ref>.  
    
    See Table <ref> for a summary of the notation used in this paper.
    
    
    
    
     §.§ Acknowledgments
    
    We are grateful to Craig Guilbault, Jingyin Huang, Dan Ramras, and Kim Ruane for some helpful 
    discussions. 
    We thank the organizers of the conference “Nonpositively curved groups on the Mediterranean” in May of 2018,  where the three of us began collaborating as a unit.
    Fernós was partially supported by NSF grant DMS–2005640.
    Futer was partially supported by NSF grant DMS–1907708.
    Hagen was partially supported by EPSRC New Investigator Award EP/R042187/1.
    
    
    
    § SIMPLICIAL COMPLEXES AND NERVE THEOREMS
    
    Throughout the paper, we will make use of simplicial complexes and assume that the reader is familiar with these objects.  
    For clarity, we recall the definition and describe two topologies on a simplicial complex.
    Then, in Section <ref>, we prove two group-equivariant homotopy equivalence theorems about nerves of covers.
    
    A k–simplex is the set 
    
        σ={a_0e_0+⋯+a_ke_k  | ∑_i=0^ka_k=1 and a_i≥ 0 for all i},
    
    where e_0,…,e_k are the standard basis vectors in ^k+1.  A face of σ is a j–simplex 
    obtained by restricting all but j–many 
      of the a_i to 0.  Note that σ has a CW complex structure where the 0–cells 
    are the 0–dimensional faces and, more generally, the j–cells are the j–dimensional faces.
    
    A simplicial complex is a CW complex  whose closed cells are simplices, such that
    
      *  each (closed) simplex is embedded in , and
         
      *  if σ,τ are simplices, then σ∩τ is either empty or a face of both σ and 
    τ.  In particular, simplices with the same 0–skeleton are equal.
    
    We often refer to 0–simplices of  as vertices and 1–simplices as edges.   
    
    As a CW complex,  is endowed with the weak topology:
    
    
        Let  be a simplicial complex. The weak topology𝒯_w on   is characterized by the property that a set C ⊂ is closed if and only if C ∩σ 
    is closed for every simplex σ⊂.  
    
    
    
    
    In some of the arguments in this section, it will be more convenient to work with the metric topology on the simplicial complex .  
    
    
    
     Let  be a simplicial complex.  Let V be the real vector space consisting of functions f ^(0)→ such that f(v)≠ 0 for finitely many v∈^(0).  
     Then there is a 
    canonical inclusion ^(0)↪ V, where every vertex v ∈^(0) maps to the corresponding Dirac function δ_v ∈ V.  This map extends affinely over 
    simplices endowed with barycentric coordinates to give an inclusion ↪ V. 
    
    Equip V with the ℓ^2 norm 
        f^2=∑_v∈^(0)f^2(v),
     which is well-defined since every f∈ V is finitely supported.  The restriction of the resulting metric topology on V 
    to the subspace  is the metric topology on , denoted 𝒯_m.
    
    
    The metric topology is coarser than the weak topology, hence the identity map 𝕀_ (,𝒯_w)→(,𝒯_m) is always continuous. When a simplicial complex 
     is locally infinite, the inverse map (,𝒯_m)→(,𝒯_w) is not continuous.  However, Dowker proved  that 𝕀_ is a homotopy equivalence even when 
     is locally infinite <cit.>. 
     Since our interest is in the homotopy type of , Dowker's theorem will be very useful.
    
    
    Unless stated otherwise, a simplicial complex  is presumed to have the weak topology 𝒯_w. The metric topology will only be needed in Lemma <ref> and Theorem <ref>, and never afterward.
    
    
    
    Some of the simplicial complexes used later will  arise from partially ordered sets, as follows.
    
    
    Given a partially ordered set (P,≤), there is a simplicial complex S in which the k–simplices are 
    the (k+1)–chains in (P,≤), and the face relation is determined by containment of chains.  We call S the simplicial realization of the partially ordered set 
    (P,≤). 
    
    
    In several other places, we will work with simplicial complexes arising as nerves of coverings of topological spaces:
    
    
     Let Y be a topological space and let 𝒰={Y_i}_i∈ I be a covering of Y, i.e. a family of subsets with Y=⋃_i∈ IY_i.  The nerve of 𝒰 is the simplicial 
    complex  with a vertex v_i for each Y_i, and with 
    an n–simplex spanned by v_i_0,…,v_i_n whenever
    ⋂_j=0^nY_i_j≠∅.  
    
    
    Note that we have defined nerves for arbitrary coverings of arbitrary topological spaces.  In practice, we will restrict Y and 𝒰: either Y is a paracompact space and 
    𝒰 is an open covering, or Y is itself a simplicial complex and 𝒰 is a covering by subcomplexes.  These assumptions provide the settings for the nerve theorems, which relate the homotopy type of Y to that of the nerve of 𝒰.
    
    
    
     §.§ Equivariant nerve theorems
    
    
    In this section, we prove two flavors of nerve theorem that are needed in our proofs of homotopy equivalence. Theorem <ref> is a group-equivariant version of the classical nerve theorem for open coverings, originally due to Borsuk <cit.>. Similarly, Theorem <ref> is an equivariant version of the nerve theorem for simplicial complexes, which is due to Björner <cit.>.
    
    
    We need the following standard fact:
    
    
     Let Y be a topological space and   a simplicial complex  endowed with the metric topology. 
     Let 
    f_0,f_1  Y→ (,𝒯_m) be continuous maps.  Suppose that, for all y∈ Y, 
    there exists a closed simplex σ of  such that 
    f_0(y), f_1(y)∈σ.  Then f_0 and f_1 are homotopic via a straight line homotopy.
    
    By abuse of notation, we identify  with the embedding ↪ V described in Definition <ref>. Then f_0, f_1  Y → V are continuous functions. For y ∈ Y and t ∈ [0,1], define the affine combination f_t(y) = 
    (1-t)f_0(y) + t f_1(y). Then 
    (y,t) ↦ f_t(y) is a continuous mapping from Y × [0,1] to V. Furthermore, for every y ∈ Y, the image f_t(y) = (1-t)f_0(y) + t f_1(y) belongs to the same simplex σ⊂ that contains f_0(y) and f_1(y). Thus we get a straight line homotopy f_t  Y →.
    
    Let Y be a paracompact space, on which a group G acts by homeomorphisms.  Let I be a set equipped with a left G–action, and let 
    ={Y_i}_i∈ I be an open covering of Y with the following properties:
    
      * gY_i=Y_gi for all g∈ G and i∈ I;
         
      *  for any finite F⊂ I, the intersection ⋂_i∈ FY_i is either empty or 
    contractible.
    
    Let  be the nerve of the covering .  
    
    Then G acts on  by simplicial automorphisms, and there is 
    a  homotopy equivalence f  Y→(,𝒯_m).
    Consequently, there is also a 
      homotopy equivalence Y→ (,𝒯_w).
    
    If the G–action is trivial, this result is the classical nerve theorem, proved for instance in Hatcher <cit.>.
    We adapt Hatcher's line of argument, accounting for the G–action where necessary.  Until we say otherwise, at the very end of the proof, the nerve  will be equipped with the metric 
    topology 𝒯_m.
    
    Simplices comprising the nerve:  Let ℱ be the set of 
    finite subsets F⊂ I 
    such that ⋂_i∈ FY_i≠∅.  Then, by Definition <ref>, every finite set F ∈ℱ can be canonically identified with the set of vertices of a simplex σ(F) ⊂.
    The partial order on ℱ given by set inclusion corresponds to the face relation on .
    The action of G on   induces an action on ℱ, hence a simplicial action on .
    
    The space Y and its quotient maps:  Let σ= σ(F) be a simplex 
    of , corresponding to a finite set F ∈ℱ. 
    Let U_F = ⋂_i ∈ F Y_i, a contractible open set, and consider the product U_F ×σ(F) ⊂ Y ×. Then, define
    
        Y = ⋃_F ∈ℱ( U_F ×σ(F) )  ⊂  Y ×.
    
     The diagonal G–action on Y × induces a G–action on Y.
    The projections from Y × to its factors restrict to G–equivariant projection maps
    
        p  Y → Y,      q  Y →.
    The homotopy equivalence Y →:  
     Given a point x ∈ contained in the interior of a simplex σ(F), the fiber  q^-1(x) = U_F ×{x} is contractible by hypothesis.  Thus, by <cit.>, 
    the projection q  Y → is a homotopy equivalence.
    
    The fiber p^-1(y):
    Fix y∈ Y, and consider the fiber 
    p^-1(y). Let (y,x) ∈ p^-1(y) ⊂ Y ×. Let σ(F) be a simplex of  containing x = q(y,x). The vertices of σ correspond to the elements of F, hence to subsets Y_i for i ∈ F.
    We endow σ(F) with barycentric coordinates, so that
     x = ∑_i ∈ Fβ_i Y_i where ∑β_i = 1. Thus
     
        p^-1(y) = {(y,  ∑_i ∈ Fβ_i Y_i )   |   y ∈ U_F , F ∈ℱ} = {y}×Σ_y
    
    for a simplicial subcomplex Σ_y ⊂. Since the projection p  Y → Y is G–equivariant, we have
    
        {gy}× g Σ_y   =   g (  {y}×Σ_y )   =   g p^-1(y) = p^-1(gy)   =  {gy}×Σ_gy,
    
    and in particular g Σ_y = Σ_gy.
    
    
    For any pair of points x,x' ∈Σ_y, belonging to simplices σ(F), σ(F') of , we have y ∈ U_F ∩ U_F' = U_F ∪ F'. Thus there is also a simplex σ(F ∪ F') containing both σ(F) and σ(F') as faces. It follows that x,x' are connected by an affine line segment in the common simplex σ(F ∪ F'). 
    In other words, Σ_y is convex.
    
    
    The section s  Y → Y:  
    Since Y is paracompact, there is a partition of unity {ϕ_α}_α∈ A subordinate to = {Y_i}_i ∈ I. That is,
     for each α∈ A, we have (ϕ_α)  ⊂ Y_i(α) for some i(α) ∈ I.
      Given y∈ Y, let A(y) = {α∈ A : y ∈(ϕ_α) }, a finite set.
    Then, define
    
        f(y) = ∑_α∈ A(y)ϕ_α (y) Y_i (α) ∈ Σ_y
            and    
        s(y) = ( y, f(y) )
          ∈  
        p^-1(y) .
     
    We will eventually show that f  Y → is the homotopy equivalence claimed in the theorem statement. For now, we focus on s.
    
    Checking that s is a homotopy inverse of p:
    Since s(y) ∈ p^-1(y), we have p ∘ s = id_Y by construction.
    We claim that the other composition s ∘ p is homotopic to id_ Y. 
    To prove this, consider the following pair of functions from  Y →:
    
        q_0(y,x) = q(y,x) = x,      q_1(y,x) = f(y).
    
    For every pair (y, x) ∈ Y, the image points x = q_0(y,x) and x' = q_1(y,x)  = f(y) are both contained in Σ_y. Above, we have checked both image points x,x' are contained in a common simplex σ(F ∪ F') ⊂Σ_y ⊂. Recall that we are working with the metric topology on . Thus, by Lemma <ref>, q_0 is homotopic to q_1 via a straight line homotopy q_t.  For every y, this straight-line homotopy runs through Σ_y.
    
    We can now define a homotopy h_t  Y → Y × as follows:
    
        h_t(y,x) = (y, q_t(y,x)).
    
    Observe that p ∘ h_t is continuous because p ∘ h_t(y,x) = y, and q ∘ h_t is continuous because q ∘ h_t(y,x) = q_t(y,x). Thus, by the universal property of the product topology, h_t is continuous.
    Restricting t to be 0 or 1 gives
    
        h_0(y,x) = (y, q_0(y,x)) = (y,x),    h_1(y,x) = (y, q_1(y,x)) = (y, f(y)) = s∘ p(y,x).
    
    In fact, for every (y,x), the path t ↦ q_t(y,x) has image in Σ_y, hence
    h_t(y,x) has image in {y}×Σ_y ⊂ Y. Thus h_t is a homotopy from s∘ p to id_ Y, and s is a homotopy inverse of p.
    
     
    A  homotopy equivalence:  Thus far, we have homotopy equivalences s  Y→ Y and q  Y→.  Hence the composition f = q∘ s  Y → is a homotopy equivalence as well.  
    
    It remains to check that f is a  homotopy equivalence. Recall from above that for every y ∈ Y and  g ∈ G, we have f(y) ∈Σ_y, hence gf(y) ∈ gΣ_y = Σ_gy. Similarly, we have f(gy) ∈Σ_gy. Thus both f(gy) and gf(y) lie in Σ_gy, and we have already checked that every pair of points of Σ_gy belong to a common simplex of . 
    Thus Lemma <ref> says that the maps gf and fg are homotopic for every g ∈ G, hence f   Y → (,𝒯_m) is a  homotopy equivalence, as claimed in the statement of the theorem.
    
    Conclusion for the weak topology:  This follows since 𝕀_ (,𝒯_w)→(,𝒯_m) is G–equivariant and is a homotopy equivalence by <cit.>.
    
    
    We are now finished with having the metric topology on our nerves, 
    and work only with the weak topology in the remainder of the paper.
    
    
    The following result is stated (without the group action) as 
    <cit.>.  The proof given there assumes that = {Σ_i} is a locally finite cover, and then 
    mentions that the general case requires a slightly different argument.
    (See Ramras <cit.> for a sketch of how the argument might go.)
      Since we need the conclusion in the case where 
    {Σ_i} might be locally infinite, and since we need to adapt the proof slightly to account for the group action, we write down a proof using Theorem <ref>.  
    
    
    
    
    Let Y be a simplicial complex, and let G be a group 
    acting on Y by simplicial automorphisms.   Let I be a set equipped with a left G–action, and let 
    ={Σ_i}_i∈ I be a covering of Y by subcomplexes, with the following properties:
    
      * g Σ_i = Σ_gi for all g∈ G and i∈ I;
         
      *  for any finite F⊂ I, the intersection ⋂_i∈ FΣ_i is either empty or 
    contractible.
    
    Let  be the nerve of the covering . 
    Then there is a 
     homotopy equivalence f  Y→ (,𝒯_w).
    
    Let Y' be the barycentric subdivision of Y. We think of Y and Y' as the same underlying topological space, with different simplicial structures. 
    
    Every subcomplex Σ⊂ Y be viewed as a subcomplex of Y'. Indeed, Σ⊂ Y is a full subcomplex of Y', in the following sense: for every simplex τ⊂ Y' whose vertices belong to Σ, it follows that τ⊂Σ. This holds because the vertices of τ correspond to simplices of Y; if these vertices belong to Σ, then so do the corresponding cells of Y, hence τ⊂Σ.
    
    Complementary complexes and open neighborhoods: 
    For a subcomplex Σ⊂ Y, 
    define the complementary complex T_Σ to be the union of all closed simplices of Y' disjoint from Σ. Then T_Σ is also a full subcomplex of Y'. Indeed, consider a simplex τ⊂ Y' whose vertices are disjoint from Σ. Then τ∩Σ cannot contain any faces of τ, hence τ∩Σ = ∅. Since T_Σ is a subcomplex of Y', it is closed (in the weak topology).
    
    Given a subcomplex Σ⊂ Y, we define an open neighborhood U_Σ = Y ∖ T_Σ. Thus U_Σ is the union of all the open simplices of Y' whose closures intersect Σ. 
    
    
    For every subcomplex Σ_i, where i ∈ I, we write U_i = U_Σ_i.  Observe that U_g i=gU_i for all g∈ G and i ∈ I. We will prove the theorem by replacing the subcomplex cover = {Σ_i }_i ∈ I by the open cover
    = { U_i }_i ∈ I.
    
    Same nerve: Let Σ_α and Σ_β be a pair of subcomplexes of Y, not necessarily belonging to . We claim that Σ_α∩Σ_β = ∅ if and only if U_Σ_α∩ U_Σ_β = ∅. The “if” direction is obvious. For the “only if” direction, suppose that Σ_α∩Σ_β = ∅. Then T_Σ_α∪ T_Σ_β = T_Σ_α∩Σ_β = T_∅ = Y', hence U_Σ_α∩ U_Σ_β = ∅, as desired.
    
    Now, let F ⊂ I be a finite set. By induction on |F|, combined with the argument of the above paragraph, we see that 
    ⋂_i∈ FΣ_i = ∅ if and only if ⋂_i∈ F U_Σ_i = ∅. Hence the open cover = { U_i }_i ∈ I and the subcomplex cover = {Σ_i }_i ∈ I have the same nerve .
    
    Same homotopy type: For every subcomplex Σ⊂ Y, we claim that the open neighborhood U_Σ deformation retracts to Σ. This is a standard fact about simplicial complexes, proved e.g. in Munkres <cit.>. The proof constructs a straight-line homotopy in every simplex σ⊂ Y' that belongs to neither Σ nor T_Σ. The proof uses the fullness of Σ and T_Σ in Y', but does not depend on any finiteness properties of these complexes.
    
    Now, let F ⊂ I be a finite set such that ⋂_i∈ FΣ_i ≠∅. Define Σ_F = ⋂_i∈ FΣ_i, and recall that by hypothesis, Σ_F is contractible. Since U_Σ_F =  ⋂_i∈ F U_Σ_i, and U_Σ_F deformation retracts to Σ_F, it follows that ⋂_i∈ F U_i = ⋂_i∈ F U_Σ_i is also contractible.
    
    Conclusion: By a theorem of Bourgin <cit.>, the simplicial complex Y is paracompact (with the weak topology 𝒯_w).
    We have shown that the open cover = { U_i }_i ∈ I and the subcomplex cover = {Σ_i }_i ∈ I have the same nerve . We have checked that U_g i=gU_i for all g∈ G and i ∈ I. Furthermore, for every finite set F ⊂ I, the intersection ⋂_i∈ F U_i is either empty or contractible. Thus, by Theorem <ref>, we have a  homotopy equivalence f  Y→ (,𝒯_w).
    
    
    § CUBE COMPLEXES AND THE ROLLER BOUNDARY
    
    
    This section recalls some background about CAT(0) cube complexes and their Roller boundaries. Many facts about CAT(0) cube 
    complexes, median graphs, wallspaces, and related structures occur in various 
     places in the literature, in many equivalent 
    guises. We have endeavored to connect some of the perspectives, in part because we will need to use these connections in the sequel. We refer the reader to <cit.> and <cit.> for more background.  
    
    
    
     §.§ CAT(0) cube complexes and metrics
    
    A cube is a copy of a Euclidean unit cube [-1/2,1/2]^n for 0≤ n<∞.  A face of 
    [-1/2,1/2]^n is a subspace obtained by restricting some of the coordinates to ±1/2.  A cube 
    complex is a CW complex whose cells are cubes and whose attaching maps restrict to isometries on faces.  A cube complex 
    with embedded cubes is nonpositively curved if, for all vertices v and all edges e_1,…,e_k incident to v such that 
    e_i,e_j span a 2–cube for all i≠ j, we have that e_1,…,e_k span a unique k–cube. 
     If X is 
    nonpositively-curved and simply connected, then X is a CAT(0) cube complex.  The dimension of X, denoted X, is the 
    supremum of the dimensions of cubes of X.
    
    Throughout this paper, X will denote a finite-dimensional CAT(0) cube complex.   We let (X) denote the group of 
    cellular automorphisms of X.  We do not assume that X is locally finite. 
    
    The cube complex X carries a metric _X such that (X,_X) is a CAT(0) space, the restriction of _X to 
    each cube is the Euclidean metric on a unit cube, and each cube is geodesically convex (see <cit.>). 
     We refer to _X as the ℓ^2 metric or the CAT(0) metric on X.  
     
    One can view X^(1) as a graph whose vertices are the 0–cubes and whose edges are the 1–cubes.  (We 
    often refer to 0–cubes as vertices of X, and 1–cubes as edges.)  We let d_1 denote the ℓ^1 metric on the 
    vertex set X^(0), which is the restriction of the usual graph metric on X^(1). We refer to d_1 as the combinatorial metric on X^(0). A combinatorial geodesic between x,y ∈ X^(0) is an edge path in X^(1) that realizes d_1(x,y).
    
    
    
    
     §.§ Hyperplanes, half-spaces, crossing, and separation
    
    
    Let [- 1/2, 1/2]^n be an n-dimensional cube. A midcube of [- 1/2, 1/2]^n is the subset obtained by restricting one coordinate to be 0.
    
    A hyperplane of a CAT(0) cube complex X is a connected subset whose intersection with each cube is either a midcube 
    of that cube, or empty. The open 1/2–neighborhood of a hyperplane ĥ in the metric d_X is denoted N(ĥ) is called the 
     open 
    hyperplane carrier of ĥ. It is known that every open carrier N(ĥ) is geodesically convex in d_X. Furthermore, X ∖ N(ĥ) consists of two connected components, each of which is also convex
     <cit.>.
     
     A component of X ∖ N(ĥ) is called a CAT(0) half-space. 
     The intersection of one of these components with the vertex set X^(0) is called a vertex half-space. 
     
     The two vertex half-spaces associated to a hyperplane ĥ are denoted h, h^*. Note that ĥ^*= ĥ.
     Given a vertex half-space h,  the corresponding CAT(0) half-space is the union of all cubes of X whose vertices lie in h.
     We will use the unmodified term half-space to mean either a CAT(0) half-space or a vertex half-space when the meaning is clear from context. 
    
    
     
     The collection of all vertex half-spaces is denoted by , or (X) if we wish to specify the space X.    
     If h∈, then h^* = X^(0)∖ h is exactly the complementary half-space associated to the same hyperplane 
    ĥ.
    
    The collection of all hyperplanes of X is denoted  (for “walls”). 
     Generally speaking, calligraphic letters denote collections of hyperplanes, while gothic letters denote collections of  
    half-spaces.
    There is a two-to-one map →, namely h ↦ĥ. Given a subset 𝒮⊂, an orientation on 𝒮 is a choice of a lift 𝒮→. 
    
    
     
    A  pair of half-spaces h,k∈ are called transverse (denoted h⋔ k) if the four intersections h∩ 
    k, h∩ k^*, h^*∩  k and h^*∩ k^* are nonempty. In terms of the underlying hyperplanes ĥ and k̂, 
    transversality is equivalent to the condition that ĥ≠k̂ and ĥ∩k̂≠∅. In this case, 
    we also write ĥ⋔k̂.  We sometimes say that transverse hyperplanes cross.  
    
    Given subsets A,B⊂ X, we say that ĥseparatesA,B if, up to relabelling the half-spaces associated to 
    ĥ, we have A⊂ h and B⊂ h^*.  We will usually be interested in situations where A,B are subcomplexes, sets 
    of vertices, or hyperplanes, in which case this notion is equivalent to another notion of separation:  namely that A,B lie in distinct components of X ∖ĥ.  Later in the paper, we will occasionally use the 
    latter notion when we need to talk about points in N(ĥ) being separated by ĥ.  (Elsewhere in the literature, 
    e.g. <cit.>, the half-spaces associated to ĥ are defined to be the components of X ∖ĥ, or sometimes 
    their closures.  This small difference in viewpoint is usually irrelevant.)
    
    
    If e is an edge, i.e. a 1–cube,  of X, then there is a unique hyperplane ĥ separating the two vertices of e.  
    We say that ĥ is dual toe, and vice versa.  Note that  ĥ is the unique hyperplane intersecting e.  
    More generally, if k≥ 0 and c is a k–cube, then there are exactly k hyperplanes intersecting c.  These 
    hyperplanes pairwise cross, and their intersection contains the barycenter of c.  We say that c is dual to this 
    family of hyperplanes.  Any set of k pairwise-crossing hyperplanes is dual to at least one k–cube.  In particular, 
    X bounds the cardinality of any set of pairwise crossing hyperplanes in X.
    
    For any points x,y ∈ X, define (x,y) to be the set of hyperplanes separating x from y.  If x,y∈ X^(0), 
    then an edge path γ from x to y is a geodesic in X^(1) if and only if γ never crosses the same hyperplane twice. Consequently,
     
        _1(x,y)=|(x,y)|.
    
    In view of this, the following standard lemma relates the metrics _X and _1. See Caprace and 
    Sageev <cit.> or Hagen <cit.> for proofs.
    
    
    There are constants λ_0 ≥ 1, λ_1 ≥ 0, depending on X, such that the following holds. For any pair 
    of points x, y ∈ X,
    
        1/λ_0 d_X(x,y) - λ_1 ≤ |(x,y)| ≤λ_0 d_X(x,y) + λ_1.
    
    
    
    For an arbitrary set B ⊂ X, let (B) be the union of all (x,y) for all x,y ∈ B.  In practice, we will 
    often be interested in the following special cases.  First, if B is a hyperplane, then (B) coincides with the set of hyperplanes
    ĥ that cross B.  If B is a convex subcomplex (see Definition <ref>), then (B) coincides with the set of ĥ with ĥ∩ 
    B≠∅.  If B is a combinatorial geodesic in X^(1), then, because of the above characterization of _1, the set 
    (B) is the set of hyperplanes dual to edges of B, or equivalently the set of hyperplanes intersecting B, or 
    equivalently the set of hyperplanes separating the endpoints of B.
    
    
    
    One can extend the ℓ^1 metric  on X^(0) to all of X as follows. On a single cube c, let d_1 |_c × c→ be the standard ℓ^1 metric. This can be extended to a path-metric on all of X by concatenating paths in individual cubes. Miesch <cit.> showed that this procedure gives a geodesic path metric on X that extends the graph metric on X^(1). With this extended definition, d_1 becomes bilipschitz to d_X, with the Lipschitz constant λ_0 depending only on (X).
    
    
     §.§ The Roller boundary X
    
    Next, we define the Roller boundary and Roller compactification of X. 
    
    
    Every vertex v∈ X^(0) defines the collection _v^+= {h∈: v∈ h} of half-spaces containing v.  Going 
    in the opposite direction, the collection _v^+ uniquely determines v:
    
        ⋂_h ∈_v^+ h = {v}.
    
    
    We endow the set 2^ with the product topology, which is compact by Tychonoff's theorem. Recall that a basis for this 
    topology consists of cylinder sets defined by the property that finitely many coordinates (i.e. finitely many half-spaces)  take a specified value (0 
    or 1). Cylinder sets are both open and closed.
    
    There is a continuous one-to-one map X^(0)↪ 2^ defined by v↦_v^+. (In fact,  
    X^(0) is homeomorphic to its image if and only if X is locally compact. We will not need this fact.)
    
    
    The Roller Compactification of X^(0), denoted by X̃ or X̃(), 
    is the closure of the image of X^(0) in 2^ℌ. 
    The Roller Boundary of X is  X = X̃∖ X^(0). 
    
    
    Recall that (X) is the group of cubical automorphisms of X. We observe that the action of (X) extends to a 
    continuous action on X̃ and therefore on X.
    
    Let h ∈(X). The extension of h to X̃ is defined to be the intersection in 2^ between X̃ and 
    the cylinder set corresponding to h. 
     It is straightforward to check that the extensions of h and h^* form a partition 
    of  X̃. We think of the extensions of h and h^* as complementary (vertex) half-spaces in X̃. By a slight abuse of 
    notation, we use the same symbol h to refer to both a half-space in X and its extension in X̃.
    
    By the above discussion of the topology on 2^ℌ, the basic open sets in X̃ are intersections between X̃ and 
    cylinder sets. Therefore, every basis set is a finite intersections of (extended) half-spaces.
    
    
    
    The duality between points and half-spaces in X, described above, extends to all of X̃ = X^(0)∪ X.
    Let y ∈X̃, and let _y^+ be the set of extended half-spaces that contain y. Then y and _y^+ determine 
    one another:
    
        ⋂_h ∈_y^+ h = { y }.
    
    
    Chatterji and Niblo <cit.>, and independently Nica <cit.>, extended Sageev's construction 
    <cit.> to prove the following.
    
    
    Let ' ⊂(X) be an involution-invariant collection of half-spaces. Then ' determines a CAT(0) cube 
    complex X(') and the Roller compactification X̃(').  In particular, X((X)) = X.
    
    
    
    If  x ∈ X^(0), the corresponding set _x^+ ∈ 2^ satisfies the descending chain condition: any 
    decreasing sequence of elements of _x^+ is eventually constant. On the other hand, the collection of half-spaces _y^+ corresponding to a boundary point y 
    ∈ X will fail the descending chain condition. Namely, for y∈X̃ we have that y∈ X if and only if 
    there exists a sequence {h_n}_n∈⊂_y^+ such that h_n+1⊊ h_n for each n∈.
    
    
    
    
    
     §.§ Convexity, intervals, and medians
    
    Here, we discuss the related notions of convexity and intervals in X and X̃. Since we are interested in two different metrics on X, there are several distinct definitions of convexity (ℓ^1 geodesic convexity, cubical convexity, interval convexity) that turn out to be equivalent for cubical subcomplexes of X.
    
    We then introduce a median operation on X̃ and its restriction to X.
    
    
    
    
    A set A ⊂ X^(0) is called vertex-convex if it is the intersection of vertex half-spaces in 
    X. For a set S ⊂ X^(0), the vertex convex hull of S is the intersection of all vertex-convex sets containing S, or equivalently the  intersection of all vertex half-spaces containing S.
    
    A subcomplex C ⊂ X is called cubically convex 
    if it is the intersection of CAT(0) half-spaces. For a set S ⊂ X, the cubical convex hull, denoted (S), is the intersection of all cubically convex sets containing S, or equivalently the  intersection of all CAT(0) half-spaces containing S. We remark that for subcomplexes of X, this definition coincides with geodesic convexity in the CAT(0) metric d_X; see <cit.> and  <cit.>.
    
    
    Observe that if C is a full subcomplex of X (meaning, C contains a cube c whenever it contains the 0–skeleton of c), then C is cubically convex whenever C^(0) is vertex–convex. For this reason, we can use the two notions of convexity interchangeably when referring to full subcomplexes. 
    
    
    Given x,y ∈ X^(0), define the (vertex) interval(x,y) to be vertex convex hull of {x, y}. Define the cubical interval(x,y) to be the cubical convex hull of {x, y}. 
    
    
    Observe that (x,y) is a full, convex subcomplex, and is the union of all the cubes whose vertex sets are contained in (x,y). In addition, ^(1)(x,y) is the union of all of the combinatorial geodesics from x to y. In fact, intervals can be used to characterize convexity as follows:
    
    
    A set A ⊂ X^(0) is vertex-convex if and only if the following holds: for all x,y ∈ A, the interval (x,y) ⊂ A.
    
    A subcomplex C ⊂ X is cubically convex if and only if the following holds: for all x,y ∈ C^(0), the cubical interval (x,y) ⊂ C.
    
    Suppose C is a cubically convex subcomplex and x,y ∈ C. Since (x,y) is the intersection of all convex subcomplexes containing x,y, and C is one such set, we have (x,y) ⊂ C. 
    
    Toward the converse, suppose that C is interval-convex, meaning (x,y) ⊂ C for every pair x,y. We wish to prove that C is convex.
    
    We claim the following: for every  hyperplane ĥ that intersects C and is dual to an edge e with endpoints x,y such that x ∈ C, the other endpoint y belongs to C as well. This can be shown as follows. Since ĥ intersects C, there is an edge e' ⊂ C that is dual to ĥ. Let x', y' be the endpoints of e', such that x and x' are on the same side of ĥ. Then (x,y') = (x,x') ⊔ĥ = ĥ⊔(y,y'). In particular, there exists a combinatorial geodesic from x to y' whose initial edge is e. Since C is interval-convex, this proves the claim.
    
    We can now show that C is cubically convex. Suppose z ∈ X^(0)∖ C. Let γ⊂ X^(0) be a shortest combinatorial geodesic from z to C, and let x be the terminus of γ, and let e be the last edge of γ. Since the next-to-last vertex of γ is not in C, the above claim implies that the hyperplane ĥ dual to e is disjoint from C, and separates C from z. Thus C is contained in a CAT(0) half-space disjoint from z. Since z was arbitrary, it follows that C is cubically convex.
    
    The proof for vertex-convex subsets is identical, up to replacing all the appropriate sets by their 0–skeleta.
    
    
    Our next goal is to extend the notion of convexity to X̃. 
    It turns out that in X̃, the correct definition of convexity begins with intervals. After developing some definitions and tools, we will eventually prove  a generalization of Lemma <ref> to X̃, using a very different argument.
    
    
    Given x,y ∈X̃, define the interval(x,y) to be the intersection of all (extended, vertex) half-spaces that 
    contain both x and y.  Equivalently, 
    
        (x,y) = { z ∈X̃  :  ^+_z ⊃ ( ^+_x∩^+_y) }.
    
    A nonempty set A ⊂X̃ is called convex if it contains (x,y) for all x, y 
    ∈ A.  
    
    
    As a very particular case, half-spaces and hence also their intersections are convex in X̃.
    
    Observe that for x,y ∈ X^(0), the interval (x,y) will in fact be contained in X^(0), and coincides with the previous definition of (x,y). Consequently, X^(0) is convex in X̃. By Lemma <ref>, any vertex-convex subset of X^(0) is also convex in X̃.
    
    Since X̃⊂ 2^(X) is by definition a set of vertices, we do not define convex subcomplexes of X̃.
    
    
    As in <cit.>, the fact that X̃ is a median space is captured by the following property: for every x,y,z ∈X̃ there is a unique point m = m(x,y,z) ∈X̃ such that 
    
        {m}= (x,y) ∩(y,z) ∩(x,z).
    
    This unique point m = m(x,y,z) is called the  median of x, y, 
    and z. 
    We will not need the general definition of an (extended) median metric space; 
    the only property of medians that we will need is  that m X̃×X̃×X̃→X̃ satisfies (<ref>). 
    In terms of half-spaces, we have:
    
        ^+_m = (^+_x ∩^+_y) ∪ (^+_y∩^+_z)∪ ( ^+_x ∩^+_z).
    
    Since intervals between points in X^(0) are contained in X^(0), we see that m(x,y,z)∈ X^(0) if 
    x,y,z∈ X^(0).  So, the median m on X̃ restricts to a median m on X^(0).  The point m(x,y,z) is the unique 
    vertex m for which any two of x,y,z can be joined by a geodesic in X^(1) passing through m. In other words, we also get an analogue of  (<ref>) with (·,·) replaced by (·, ·):
    
        {m}= (x,y) ∩(y,z) ∩(x,z)
          for   x,y,z∈ X^(0).
    
    
    
     In fact, a graph with 
    this property — called a median graph— is always the 1–skeleton of a uniquely determined CAT(0) cube 
    complex <cit.>.  
    
    
     §.§ Lifting decompositions and convexity
    
    
    
    A set of half-spaces 𝔰⊂ is called consistent if the following two conditions hold: if h∈𝔰 then h^*∉𝔰, and if k ⊃ h ∈𝔰 then k∈𝔰. Given a 
    subset ' ⊂, a lifting decomposition for ' is a consistent set of half-spaces 
    𝔰⊂∖' such that = '⊔𝔰⊔𝔰^*. 
    Lifting decompositions do not necessarily exist, and are not necessarily unique.
     
    Lifting decompositions naturally occur in the following way. Consider a set A ⊂X̃. Analogous to _x^+,  we 
    define a set _A^+ = {h∈ : A⊂ h} of half-spaces that contain A, and observe that _A^+ is 
    consistent. Define _A^- = (_A^+)^* to be the set of half-spaces disjoint from A, and finally a set  
    
        _A = {h∈ : A∩ h ≠∅,   A∩ h^*≠∅}
    
     of half-spaces that cut A. Then we get a lifting decomposition = _A ⊔_A^+ ⊔_A^-, 
    where 𝔰 = _A^+.
    
    
    
     Observe that if A⊂ B, then _B^+ ⊂_A^+. 
    
    
    Given points x,y ∈X̃, let (x,y)= _x^+ _y^+ denote 
    the set of half-spaces that separate x from y. 
     More generally, given two disjoint convex sets A,B⊂X̃, let (A,B)= _A^+ _B^+ denote 
    the set of half-spaces that separate A from B. 
    
    In an analogous fashion, we generalize the definition of (x,y) from Section <ref> to convex subsets A, 
    B ⊂X̃. For subsets of this form, (A,B) = (A,B) consists of all the hyperplanes that 
    separate A from B. 
    We also extend the
     ℓ^1 metric on X^(0) to X̃, where 
    d_1(x,y) = | (x,y) | = 1/2 | _x^+ _y^+| is allowed to take the value ∞.
    
     The following result says that lifting decompositions are in one-to-one correspondence with Roller-closed subcomplexes of 
    X̃. 
    
    
       
    
    
     
    The following are true:
    
      *  Suppose that '⊂(X). If there exists a lifting decomposition 
    𝔰 for ', then there is a d_1–isometric
     embedding X̃(') ↪X̃ induced from the map 2^'↪ 2^(X) where U 
    ↦ U⊔𝔰. The image of this embedding is 
    
    
        ⋂_h∈𝔰 h⊂X̃.
    
    
      *  Similarly, if 𝔰⊂(X) is a consistent set of half-spaces, then, 
    setting _𝔰 = 
    (X)∖(𝔰⊔𝔰^*) we get an isometric embedding 
    X̃(_𝔰) ↪X̃, obtained as above, onto
    
    
        ⋂_h∈𝔰 h⊂X̃.
    
    
      *  The set 𝔰 satisfies the descending chain condition if and only if the image of 
    X(_𝔰) is in X. 
    
    Furthermore, if the set 𝔰 is G–invariant, for some group G≤(X), then, with the restricted action on 
    the image, the above natural embeddings are  G–equivariant.
    
    
    This result is a slightly strengthened version of  <cit.>. See also <cit.> for a 
    very similar statement.
    
    
    We remark that  
    Proposition <ref> includes the possibility that 𝔰=∅ and hence ⊔∅⊔∅ is a legitimate lifting decomposition of . In this case, recall that an intersection over an empty collection of sets is everything, i.e. ⋂_h∈∅ h= X̃. 
    
    
    Suppose that there is a lifting decomposition 𝔰 for  '. Then, since s ∩ s^* = ∅ 
    and = '⊔ s ⊔ s^*, we deduce that ' = ∖( s⊔ s^*) 
    is involution invariant. 
    
    Next, we claim that ' ⊂ has a property called tightly nested, meaning that  for every pair h,k∈', 
    and for every ℓ∈ with h⊂ℓ⊂ k, we have ℓ∈'. Assume, for a contradiction, that 
    h,k∈', and ℓ∈ with h⊂ℓ⊂ k, but 
    ℓ∉'. Then (up to replacing the three half-spaces with their complements) we may assume that ℓ∈𝔰. But then k∈𝔰, a contradiction. 
    
    With the verification that ' is involution invariant and tightly nested, our hypotheses imply those of  <cit.>. 
    Now, conclusions <ref>–<ref> follow from that lemma.
    
    Finally, the conclusion about G–invariance follows because the embeddings are canonically determined by the associated 
    half-spaces.
    
    In Proposition <ref>, the  isometric embeddings of X̃(') and X̃(_𝔰) restrict to 
    isometric embeddings of X(') and X(_𝔰), respectively. 
    Although X is typically not closed, the images under the isometric embedding of  X(') and X(_𝔰)  always lie in X. Indeed, recall from the discussion following Theorem 
    <ref> that a point belongs to the Roller boundary if and only if there is an infinite descending chain  of 
    half-spaces containing the point in question. Hence, if U has an infinite descending chain, then so does U⊔ 
    s. 
    
    
    
    As a first application of Proposition <ref>, we will prove a generalization of Lemma <ref> to X̃. Observe that a naive generalization of  Lemma <ref> does not hold, because X is (interval) convex in X̃ by Definition <ref>, but is not an intersection of extended half-spaces. However, the following lemma says that a closed, convex set in X̃ is always an intersection of extended half-spaces.
    
    
    Let A ⊂X̃ be a convex set. Then the Roller closure A in X̃
     is the image of X̃(_A) under the embedding of Proposition <ref>, and
     
        A = ⋂_h ∈_A^+ h = ⋂_A ⊂ h h.
    
    Observe that _A^+ is a consistent set of half-spaces. Thus Proposition <ref>.<ref> gives an embedding X̃(_A) ↪X̃ whose image is
     
        W =  ⋂_A ⊂ h h = ⋂_h ∈_A^+ h =  ⋂_h ∈_Ã^+ h.
    
    Here, the first equality is the definition of W, the second equality is the definition of _A^+, and the third equality holds because half-spaces are closed, meaning _A^+=_Ã^+.
     
    It remains to show that A = W. The inclusion A⊂ W is obvious, because A⊂ h for every h ∈_Ã^+. To prove the reverse inclusion, suppose for a contradiction that there is a point  y ∈ W ∖Ã. Since X̃∖Ã
    is open, there is a basic open neighborhood of y of the form ⋂_i=1^n h_i, such that 
    
        y ∈( ⋂_i=1^n h_i ) ⊂X̃∖Ã.
    
    Therefore, A ⊂ h_1^*∪⋯∪ h_n^*. Without  loss of generality, assume that n is minimal  in the sense that 
    for each j =1, …, n there is a point 
    
        a_j ∈ A∖(⋃_j ≠ i=1^n h_i^* ) = A ∩(⋂_j ≠ i=1^n h_i ).
    
    One crucial observation is that n≥ 2: otherwise, if A ⊂ h_1^*, then h_1 ∩ W = ∅, but we know that y ∈ h_1 ∩ W.
    
    
    Now, define p = m(y,a_1, a_2). Recall that (a_1,a_2)⊂ A, because A is convex. By the definition of medians, we have 
    
        p ∈(a_1,a_2)⊂ A,     
        p ∈(y, a_1) ⊂(⋂_j =2^n h_i ),
             
        p ∈(y, a_2) ⊂ h_1.
    
    Consequently, we have p ∈ A ∩( ⋂_i =1^n h_i )= ∅, a contradiction.
    Thus A = W.
    
    
     §.§ Gates and bridges
    
    A very useful property of a convex subset A⊂ X^(0) is the existence of a gate map_A  X→ A; this is 
    a well-known notion, see e.g. <cit.> and the citations therein.  Metrically, 
    _A  X^(0)→ A^(0) is just closest-point projection, but gates can be characterized entirely in terms of the median 
    (see e.g. <cit.> and citations therein).  Since we saw that X̃ has a median satisfying (<ref>), convex 
    subsets of X̃ do similarly admit gates.  This is the content of  
    Proposition <ref>, which has the advantage of showing an important relationship between 
    gates and walls.
    
    Recall that (x,Y) is the set of hyperplanes separating x from Y, where Y⊂X̃ is convex. 
    
    
    
     Let C⊂X̃ be closed and convex. There is a unique projection _CX̃ C such that for any x∈X̃ we have 
     
        (x,_C(x)) = (x,C).
    
    Let = _C⊔_C^+ ⊔_C^- be the lifting decomposition associated to C.  The map 
    2^→ 2^_C defined by U↦ U∖ (_C^+ ⊔_C^-) restricts to a surjection X̃X̃(_C). 
    Next, Proposition <ref> gives an embedding  X̃(_C) →X̃, namely V ↦ V ⊔_C^+.
    Composing the surjection X̃X̃(_C) with the embedding X̃(_C) →X̃ yields a map _C X̃→X̃. The image _C(X̃) is C since, by Lemma <ref>, the image of the embedding X̃(_C)→X̃ is exactly C=C.
    
    To prove the equality in the statement, first observe that (x,C) ⊂(x,_C(x)) because _C(x) ∈ C. For the opposite inclusion, consider a hyperplane ĥ∈(x,_C(x)), and choose an orientation h ∈_x^+. By the definition of _C, we have
    
        __C(x)^+ = (_x^+ ∖_C^-) ∪_C^+.
    
    Since h ∈_x^+ ∖__C(x)^+, we must have h ∈_C^-, hence ĥ∈(x,C). Thus (x,C) = (x,_C(x)).
    
    Finally, for x ∈ C, we must have x = _C(x) because (x,_C(x)) = (x,C) = ∅. Thus _C is indeed a projection to C.
    
    
    Note that _C restricts to the identity on C.  We call _C the gate map to C, which is consistent 
    with the terminology used in the theory of median spaces because of the following lemma:
    
    
    Let _C be the map from Proposition <ref>.  Then for all x∈X̃ and y∈ C, we have 
    m(x,y,_C(x))=_C(x).  In particular, _C(x) ∈⋂_y ∈ C(x,y).
    
    By Proposition <ref> and the fact that y∈ C, we have (x,_C(x))⊂(x,y), so 
    (x,_C(x))⊂(x,y).  So, _C(x)∈(x,y)∩(x,_C(x))∩(y,_C(x)), hence m=_C(x).
    
    
    The above lemma has two corollaries. First, we can characterize medians in terms of projections:
    
    
    Suppose that x,y,z ∈ X^(0). Then _(x,y)(z)=m(x,y,z). 
    
    By
    Lemma <ref>, we have _(x,y)(z)  ∈(x,z) and _(x,y)(z) ∈(y,z).  On the 
    other hand, _(x,y)(z)∈(x,y) by definition.  So, by (<ref>), we get  
    _(x,y)(z)=m(x,y,z).
    
    
    Second, Lemma <ref> allows us to project from X to convex subcomplexes of X.
    
    
    Let A ⊂ X be a convex subcomplex. Then, for all x ∈ X^(0), we have _A (x) ∈ A. Consequently, we get a projection _A = _A X^(0)→ A^(0).
    
    Let x ∈ X^(0) and y ∈ A^(0). By Lemma <ref>, we have _A(x) ∈(x,y) ⊂ X^(0). But A∩ X^(0) = A^(0).
    
    In fact, it is possible to extend _A over higher-dimensional cubes to 
    get a map _A  X→ A. This is done as follows (see also <cit.>).  First let e be a 1–cube of X joining 0–cubes x,y and dual to a hyperplane ĥ.  From 
    Proposition <ref>, one has the following: if ĥ does not cross A, then _A(x)=_A(y), and, otherwise, _A(x) and _A(y) are joined by an edge e̅⊂ A dual 
    to ĥ.  
    
    In the former case, _A extends over e by sending every point to _A(x)=_A(y); in the latter case, we extend by declaring _A  e→e̅ to be the obvious 
    isometry. 
    
    Now, if c is a d–cube for d≥ 2, then for some s∈{0,…,d}, there are 1–cubes e_1,…,e_s⊂ c that span an s–cube c' and have the property that the 
    hyperplanes ĥ_1,…,ĥ_s respectively dual to e_1,…,e_s are precisely the hyperplanes intersecting both c and A.  (The case s=0 corresponds to the situation where no 
    hyperplane intersecting c intersects A, and c' is an arbitrary 0–cube of c.)  So for 1≤ i≤ s, we have that e̅_i=_A(e_i) is a 1–cube of A dual to ĥ_i, and the 
    1–cubes e̅_1,…,e̅_s span an s–cube c̅'.  We extend _A over c' using the obvious cubical isometry c'→c̅' extending the map _A on 1–cubes.  By 
    construction, for each v∈ c^(0), there is a unique 0–cube v'∈ c' such that _A(v)=_A(v'), the assignment v↦ v' extends to a cubical map c→ c' (collapsing the 
    hyperplanes not in {ĥ_1,…,ĥ_s}), and composing this with _A:c'→ A gives the (extended) gate map _A:c→ A.  Note that c'⊂ c is only unique up to parallelism, 
    but any two allowable choices of c' give the same map c→ A.  
    
    
    
    We conclude that gates enjoy the following properties: 
    
    
    Let A⊂ X be a convex subcomplex.  Then:
    
      *  For all x,y∈ X, we have (_A(x),_A(y))=(x,y)∩(A), and (x,_A(x))=(x,A).
      *  The map _A is 1–lipschitz on X^(0) with the d_1 metric and the CAT(0) 
    metric d_X.
    
    For 0–cubes, the first part of conclusion <ref> appears in various places in the literature; see e.g. <cit.>, or one can deduce it easily from 
    Proposition <ref>.  The second part of the first assertion (again for 0–cubes) restates Proposition <ref>.  The generalization of <ref> to arbitrary points in X 
    follows immediately from the corresponding assertion for 0–cubes, together with the construction in Remark <ref>. 
    
    Finally, <ref> implies the first part of <ref>, since _1(x,y)=|(x,y)| for 
    0–cubes x,y.  For the second part, first note that the restriction of π_A to each cube is 1–lipschitz for the 
    CAT(0) metric, since it factors as the natural projection of the cube onto one of its faces (which is lipschitz for the 
    Euclidean metric) composed with an isometric embedding.  Now, fix x,y∈ X and let γ be the CAT(0) geodesic joining 
    them, which decomposes as a finite concatenation of geodesics, each lying in a single cube.  Each such geodesic is mapped to 
    a path whose length has not increased, so π_A∘γ is a path from π_A(x) to π_A(y) of length at most 
    _X(x,y), as required.
    
    
    The following standard application of gates is often called the bridge lemma.  
    
    
    
    Let I,J⊂ X be convex subcomplexes.  Let _I  X → I and _J  X→ J be the gate maps.  Then the following hold:
     
      * _I(J) and _J(I) are convex subcomplexes.
         
      * (_I(J))=(_J(I))=(I)∩(J).
         
      *  The map _I _J(I)→_I(J) is an isomorphism of CAT(0) cube complexes.
         
      *  The cubical convex hull  (_I(J)∪_J(I)) is a CAT(0) cube complex isomorphic to _J(I)×(x,_J(x)) for any vertex x∈_I(J).
    
      *  If I∩ J≠∅, then _I(J)=_J(I)=I∩ J, and (I∩ J)=(I)∩𝒲(J).
     
         This can be assembled from results in the literature in various ways.  For example, the first statement is part 
    of <cit.>; the second and last statements follow from <cit.>.  The 
    third follows from <cit.>.  For the fourth, see <cit.> or <cit.>.
    
    
     §.§ Facing tuples and properness
    
    A facing k–tuple of hyperplanes is a set {ĥ_1,…,ĥ_k} of hyperplanes such that, for each i≤ 
    k, we can choose a half-space h_i such that h_i∩ h_j=∅ for i≠ j.  We are often particularly interested in 
    facing triples, since many of the subcomplexes of X considered later in the paper will be CAT(0) cube complexes that do 
    not contain facing triples.
    
    One useful application of the notion of a facing tuple is the following lemma, which in practice will be used to guarantee 
    properness of certain subcomplexes of X.  See <cit.> for a more detailed discussion. See also <cit.> for a related result,  where X is required to  isometrically  embed into ^D for some D.
    
    
    
    Let X be a CAT(0) cube complex of dimension D<∞.   Suppose that there exists T such that X does not contain a 
    facing T–tuple.  Then  (X,_X) is a 
    proper CAT(0) space.
    
    Let R≥ 0 and let B be a ball of radius R in X (with respect to the CAT(0) metric _X).  Let (B) be the set of hyperplanes intersecting B.
    
    We say that hyperplanes ĥ_1,…,ĥ_n in (B) form a chain if (up to relabelling), each
    ĥ_i separates ĥ_i-1 from ĥ_i+1 for 2≤ i≤ n-1.
    
    We claim that there exists N, depending only on D and R,  such that any chain in (B) has cardinality at most 
    N. Indeed, if ĥ_1,…,ĥ_n is a chain, then any edge dual to ĥ_1 lies at ℓ^1 distance at least 
    n-2 from any edge dual to ĥ_n. Now,  Lemma <ref> implies there exists N (depending only on D and R) such that n>N implies that 
    _X(ĥ_1,ĥ_n)>2R.  This is impossible, since ĥ_1,ĥ_n intersect a common R–ball.
    
    On the other hand, <cit.> provides a constant K=K(D,T) such that any finite set 
    ℱ⊂(B) must contain a chain of length at least |ℱ|/K.  So, |(B)|≤ KN.
    
    Let (B) be the cubical convex hull of B. 
      The set of hyperplanes of the CAT(0) cube complex (B) is 𝒲(B), which we have just shown is finite.  Hence (B) is a compact CAT(0) cube complex, and hence proper.  Since B↪ X is an isometric embedding (with respect to CAT(0) metrics), B is a ball in (B), and is therefore 
    compact.  This completes the proof.
    
    
    The use of the above lemma will be the following.  Given x∈ X^(0) and y∈ X, we can consider the interval 
    (x,y) in X̃.  The intersection (x,y)∩ X is a vertex-convex set, which is the 0–skeleton of a uniquely 
    determined convex subcomplex A.  Note that (A)=(x,y).  This 
    infinite set of hyperplanes cannot contain a facing triple.  Hence, Lemma <ref> shows that A is 
    proper.  We will need this in the proof of Lemma <ref>, to arrange for a sequence of CAT(0) geodesic segments in A to converge uniformly on compact sets to a CAT(0) 
    geodesic ray.  In this way, we avoid a blanket hypothesis that X is proper. 
    
    Note that we therefore only use a special case of the lemma, namely properness of cubical intervals.  Properness of intervals follows from a much stronger statement: intervals endowed with the ℓ_1 metric  isometrically embed into ^(X) (i.e. are Euclidean). It follows that intervals are proper in the CAT(0) metric, since the two metrics are bilipschitz.  This 
    embedding  into ^(X) goes back at least to <cit.>. This embedding is closely related to <cit.>, which bounds the cardinality of facing tuples in Euclidean CAT(0) cube 
    complexes, which include, but are more general than, cubical intervals.  
    
    
    
    
     §.§ Combinatorial Geodesic Rays
    
    
    Next, we develop some basic facts about combinatorial geodesics in CAT(0) cube complexes that will be needed when we relate different types of boundaries.
    
    
     A map γ [0, ∞)→ X^(1) is said to be a combinatorial geodesic ray if γ() ⊂ X^(0) and for each 
    n,m ∈ we have  d_1(γ(n), γ(m) ) = |n-m| and γ is an isometry on each interval [n, n+1]. 
    
     Let γ [0,∞)→ X be a combinatorial geodesic ray. There exists a unique point  y∈ X such that γ(n) →  y
    in X̃ as n →∞. 
    
    
    In the sequel, we will write y = γ(∞) to mean γ(n) →  y.
    
    
    
    Consider the set
    
        D(γ) = {h∈: γ([N,∞)∩)⊂ h for some  N∈}.
     
    This is clearly a consistent choice of half-spaces. We claim that for each h∈, either h or h^* belongs to 
    D(γ).
    Indeed, up to replacing h by h^*, there must be a monotonic sequence n_k→∞ such that γ(n_k) ∈ h. Since h is 
    convex, it follows that γ([n_1,∞)∩) ⊂ h.
    
    Now, define C = 
    ⋂_ h ∈ D(γ) h. We claim that C consists of exactly one point. Note that C ≠∅ because 
    it is a nested intersection of compact sets in X̃. On the other hand, if x,x' ∈ C are distinct points, then consider 
    a 
    half-space h such that x ∈ h and x' ∈ h^*. This half-space must satisfy both h ∈ D(γ) and h^* ∈ D(γ), a contradiction. Thus 
    C = {y}, as desired.
    
     For every x∈ X^(0) and every y ∈ X, there is a combinatorial geodesic ray γ [0,∞) → X such that γ(0) = 
    x and γ(∞) =  y. 
    
    
    The proof of Lemma <ref> is modeled on the construction of normal cubed paths, introduced by Niblo and Reeves in <cit.>.
    
    
    Without loss of generality, let us assume that X̃= (x,y), that is, (X) = _x^+_y^+. 
    The collection of half-spaces _x^+∖_y^+ is partially ordered by set inclusion. Consider h, k ∈_x^+∖_y^+. Since x∈ h∩ k and y∈ h^*∩ k^*, the possible relations between h and k are: h⊂ k or k⊂ 
    h or h⋔ k. In other words, incomparable elements are transverse. In particular, all minimal elements of 
    _x^+∖_y^+ must be pairwise transverse.  By finite dimensionality, the set M_1 of minimal elements is 
    finite.  Let x_1 be the vertex obtained by replacing every h ∈ M_1 by h^*, that is, _x_1^+= 
    (_x^+∖ M_1)∪ M_1^*, a clearly consistent and total choice of half-spaces. In other words, x_1 is 
    diagonally across from x in the unique maximal cube containing x in the vertex interval (x, y). 
    
    Proceeding by induction, suppose that x_n-1 has been defined. 
    Let M_n be the set of minimal elements of  _x_n-1^+ ∖_y^+.
    
    Let x_n be the vertex obtained by replacing every h ∈ M_n by h^*, corresponding to the half-space interval _x_n^+= (_x_n-1^+∖ M_n)∪ M_n^*.
    
    Observing that M_k^*∩ M_j = ∅ for j < k,
    we conclude that 
    
        _x_n^+= ( _x^+∖⋓j=1n-1 M_j ) ∪( ⋓j=1n-1 M_j^*).
    
    
    Fix k<m ∈. We claim that for any integer ℓ∈  [k, m], x_ℓ lies on every geodesic path from x_k to 
    x_m.
    Equivalently, we claim that
    the median of x_k, x_ℓ, and x_m is x_ℓ. Recall that this will be the case if every half-space 
    containing x_k and x_m also contains x_ℓ. This containment can be established as follows
    
        _x_k^+ ∩_x_m^+     = ( _x^+ ∖⋓j=1m-1 M_j )∪( ⋓j=1k-1M_j^* ) 
           ⊂( _x^+ ∖⋓j=1ℓ-1 M_j ) ∪( ⋓j=1ℓ-1M_j^* ) = 
        _x_ℓ^+.
    
    This proves the claim.
    
    Set x_0=x and choose an edge-geodesic γ_k  [0, d(x_k-1, x_k)] →(x_k-1, x_k) from x_k-1 to x_k. Finally, define γ as the infinite
    concatenation γ_1  γ_2 ⋯. Then, by construction, γ(∞) =  y.
    
    
    We will discuss further properties of combinatorial geodesic rays in Section <ref>.
    
    
    
    § CUBOID COMPLEXES WITH MODIFIED CAT(0) METRICS
    
    
    A cuboid is a box of the form [0,a_1] ×…× [0,a_n] ⊂^n. 
    In this section, we describe a way to modify the metric on a
    finite-dimensional CAT(0) cube complex X to produce a new CAT(0) space whose cells are cuboids rather than cubes.   Our 
    results relating the Tits boundary and simplicial boundary of a CAT(0) cube 
    complex will carry over to this context with small changes to some proofs, which we will indicate in the relevant places.
    
    The reader only interested in CAT(0) cube complexes with the standard CAT(0) metric can safely skip this section, apart from the statements of Lemmas <ref> and <ref>. 
    Those lemmas are cuboid generalizations of standard results in the literature, namely <cit.> and <cit.>. Thus, in the standard metric, one can substitute those results from the literature for the lemmas of this section.
    
    
    
    Let X be a finite-dimensional CAT(0) cube complex and let G →(X) be a group acting on X by cubical automorphisms.  Let 
     be the set of hyperplanes in X. 
    
    
    A hyperplane rescaling 
     of X is a map ρ→ (0,∞). The rescaling is called G–admissible 
    if it is G–invariant, and in addition we have m_ρ=inf_ĥ∈ρ(ĥ)>0 and M_ρ=sup_ĥ∈ρ(ĥ)<∞.
    
    
    Let ρ be a G–admissible hyperplane rescaling of X.  Fix a cube c of X.  For each hyperplane ĥ_i 
    intersecting c, let ρ_i=ρ(ĥ_i).  Regarding c as an isometric 
    copy of ∏_i[0,ρ_i], with the Euclidean metric, let d_X^ρ be the resulting piecewise-Euclidean path metric on 
    X.
    
      The following result is a special case of a theorem of Bowditch <cit.>, but we are able to give a direct proof. 
    
    
    Suppose that G acts on X by cubical automorphisms, and let ρ be a G–admissible hyperplane rescaling of X.  Then 
    (X,d_X^ρ) is a CAT(0) space, and the 
    action of G on (X,d_X^ρ) is by isometries.
    
    Let x ∈ X be an arbitrary point. Then the link of x in (X,^ρ_X) 
    is isometric to the link of x  in (X,d_X), and is hence a CAT(1) space. Since the amount of rescaling in bounded, there is a small ϵ depending on x and ρ such that the 
    ϵ–balls about x in the two metrics are (abstractly) isometric. Thus (X, d_X^ρ) is locally CAT(0). Recalling that X is contractible (the homeomorphism type has not changed), we 
    conclude that (X, d_X^ρ) is globally CAT(0) by Cartan–Hadamard theorem <cit.>. 
    
     Since ρ is G–equivariant, G takes cuboids to d_X^ρ–isometric cuboids, 
    hence G acts by isometries.  
    
    
    One can also prove Lemma <ref> using a result of Bridson and Haefliger <cit.>. Our proof is essentially the same argument, but the cubical structure allows us to assume bounded rescaling rather than
    finitely many shapes.
    
    
    
    Consider a finite-dimensional CAT(0) cube complex X, a group G acting on X by cubical automorphisms, and a G–admissible hyperplane rescaling 
    ρ of X. We say that the CAT(0) metric 
    d_X^ρ from Lemma <ref> is a CAT(0) cuboid metric on X, and (X,d_X^ρ) is a CAT(0) 
    cuboid complex.
    
    Suppose that G acts on X by cubical automorphisms, and let ρ be a G–admissible hyperplane rescaling of X. Define (X^ρ) ⊂(X) to be the automorphism group of the rescaled complex (X,d_X^ρ). By construction, the representation G →(X) has image in 
    (X^ρ). 
    
    Every cubically convex subcomplex Y ⊂ X is also geodesically convex in the rescaled metric d_X^ρ.
    In particular, every CAT(0) half-space (k) is convex in d_X^ρ.
    
    By Definition <ref>, a cubically convex subcomplex is an intersection of CAT(0) half-spaces. Since any intersection of d_X^ρ–convex sets will be d_X^ρ–convex, it suffices to prove that CAT(0) half-spaces are d_X^ρ–convex.
    
    Now, let k ∈(X), and let (k) be the the corresponding CAT(0) half-space. Observe that (k) is a CAT(0) cube complex in its own right with half-space structure (k) = {h∈: 
    h⋔ k}. Let G_k= _G(k) which then acts by isometries on ((k)). Clearly the restriction 
    ρ|_(k) is G_k–admissible. By Lemma <ref> we have ((k), 
    d^ρ|(k)_(k)) is a CAT(0) space, so that
    
        d_X^ρ|_(k) = d^ρ|_(k)_(k).
    
    
    Therefore, the identity inclusion (h) ↪ X is isometric with respect to this new CAT(0) metric, and in 
    particular (k) is d_X^ρ–convex. 
    
     
     The following result is a generalization of <cit.> for CAT(0) cuboid complexes.
    
    
    
    Let X be a CAT(0) cube complex and let ρ be a G–admissible hyperplane rescaling.  Suppose that (X) =𝒲_1⊔_2, where ĥ,v̂ cross whenever ĥ∈_1,v̂∈_2.  
    
    Then X=X_1× X_2 (as a product cube complex), where X_1 and X_2 are CAT(0) cube complexes dual to _1 and _2.  
    
    Letting p_i  X→ X_i denote the natural projection, 
    for i∈{1,2}, the map p_i induces a bijection on the sets of hyperplanes such that the preimages of the hyperplanes in 
    X_i are the hyperplanes in _i.  
    
    Moreover, restricting ρ 
     to _i, we obtain rescaled CAT(0) metrics ^ρ_X_i such that (X_i,^ρ_X_i) is a CAT(0) 
    cuboid complex and we have
    
        ^ρ_X(x,y)=√(^ρ_X_1(p_1(x),p_1(y))^2+^ρ_X_2(p_2(x),p_2(y))^2)
     
     for all x,y∈ X. 
    
    The statement about X decomposing as a product cube complex follows from <cit.> and the 
    discussion in <cit.> preceding it.  So, it remains to prove the 
    statement about rescaled CAT(0) metrics.
    
    Admissibility of the rescalings on X_1,X_2 follows from admissibility of ρ and the fact that p_i is a 
    restriction quotient in the sense of <cit.>, meaning it sends 
    hyperplanes to hyperplanes.  So, Lemma <ref> makes each (X_i,^ρ_X_i) a CAT(0) cuboid 
    complex.
    
    We now verify the metric statement.  Let x,y∈ X.  Let α be the ^ρ_X–geodesic from x=(p_1(x),p_2(x)) 
    to y=(p_1(y),p_2(y)).  Let β be the ^ρ_X–geodesic from 
    (p_1(x),p_2(y)) to (p_1(x),p_2(x)), and let γ be the ^ρ_X–geodesic from (p_1(y),p_2(y)) to (p_1(x),p_2(y)).  So, 
    αγβ is a geodesic triangle.  
    
    Note that every point on β has the form (p_1(x),z) and every point on γ has the form (z,p_2(y)), because the 
    p_i are restriction quotients and therefore have convex fibers by 
    Lemma <ref>.  In particular, β=^ρ_X_2(p_2(x),p_2(y)) and 
    γ=^ρ_X_1(p_1(x),p_1(y)) and p_1,p_2 are respectively isometries on γ 
    and β.  Moreover, the Alexandrov angle (see Definition <ref>) formed by β and γ at their common point is π/2.  Perform the 
    same construction with (p_1(x),p_2(y)) replaced by (p_1(y),p_2(x)).  This 
    yields a geodesic quadrilateral in (X, ^ρ_X), with all angles π/2, two adjacent sides having length 
    ^ρ_X_2(p_2(x),p_2(y)) and ^ρ_X_1(p_1(x),p_1(y)), and x and y as opposite 
    corners.  The Flat Quadrilateral Theorem (<cit.>) now implies that 
    
        ^ρ_X(x,y)=√(^ρ_X_1(p_1(x),p_1(y))^2+^ρ_X_2(p_2(x),p_2(y))^2),
    
    as required.
    
    
    We also need the following standard lemma.  In the context of CAT(0) cube complexes, this is <cit.>.  We state it here for cuboid complexes.  The proof 
    from <cit.> goes through with tiny changes that we indicate below.
    
    
     Let X be a D–dimensional CAT(0) cube complex and let ρ be a G–admissible hyperplane rescaling.  Let (X,d^ρ_X) be the resulting CAT(0) cuboid complex.  Let 
    γ [0,∞)→ X be a geodesic ray for the metric d^ρ_X, with γ(0)∈ X^(0).  Then X contains a combinatorial geodesic ray α in X^(1) such that 
    α(0)=γ(0) and such that α fellow-travels with γ at distance depending only on D and ρ.
    
    The proof from <cit.> works with almost no change.  First, <cit.> is about the combinatorial structure of X only, which does not change 
    when we rescale edges to pass from the CAT(0) metric d_X to the CAT(0) metric d_X^ρ.  The proof of <cit.>  needs this lemma, plus CAT(0) convexity of 
    half-spaces, which continues to hold in view of Corollary <ref>.  The proof of <cit.> produces a combinatorial ray α such that each 
    point of α lies in a common cube as a point of γ, and vice versa.  Hence the two rays fellow travel at CAT(0) distance bounded by the diameter of a cube.  In the metric d_X, this is 
    bounded in terms of D; in the metric d_X^ρ, this is bounded in terms of D and the constant M_ρ from Definition <ref>, as required by the statement.
    
    
    Since d_X and d_X^ρ are path-metrics, and for each cube c of X, the standard CAT(0) metric d_X on c is bilipschitz 
    to the restriction of d_X^ρ (with constant depending only on the rescaling constant), the identity map 
    (X,d_X)→(X,d_X^ρ) is bilipschitz.  Combining this fact with Lemma <ref> yields a version of Lemma <ref> for the rescaled metric d_X^ρ:
    
    
    There are constants λ_0^ρ≥ 1, λ_1^ρ≥ 0, depending on X and ρ, such that the following holds. For any pair 
    of points x, y ∈ X,
    
        1/λ_0^ρ  d_X^ρ(x,y) - λ_1^ρ≤ |(x,y)| ≤λ_0^ρ  d_X^ρ(x,y) + λ_1^ρ.
    
    
    In a similar fashion, by Remark <ref>, there is a bilipschitz relationship between (X, d_X^ρ) and (X, d_1).
    
    
    
    § THE  SIMPLICIAL ROLLER BOUNDARY X
    
    In this section, we discuss one of the main objects in the paper: the simplicial Roller boundary.
    
    
    
    Let x,y ∈X̃.  Recall that (x,y) = _x^+  _y^+ is the set of half-spaces that separate x from y. We say that x is commensurate to y, and write x∼ y, if  |(x,y)|< ∞.  
    Observe that X^(0) forms a single commensurability class in X̃. Commensurability classes contained in  X = 
    X̃∖ X^(0) are also called Roller classes.
    
     The Guralnik quotient of the Roller Boundary is X =  X / ∼,  the set of commensurability 
    classes of points in the Roller boundary <cit.>. We shall often implicitly consider elements [x]∈ X as 
    subsets [x]⊂X̃. 
    
    
     
    In most cases,  the quotient topology on X =  X / ∼ is not Hausdorff (in  fact, it does not even 
    satisfy the T_1 axiom). We think of X as only a set, without a topology. In 
    Definition <ref>, we will use a partial order on X to define a simplicial complex X with far nicer topological properties.
    
    
    Following <cit.>,  we  say a set S⊂ is non-terminating if S contains no minimal elements: 
    given any half-space h∈ S, there is a half-space k⊊ h with k∈ S. 
    
    
    
    Let C ⊂ X be a closed, convex set. The following are equivalent:
    
      *  There is a point y∈∂ X such that C= [̃ỹ]̃.
    
      *  There exists k≤ (X) and a family (h^1_m)_m≥ 0, (h_m^2)_m≥ 0,…, (h_m^k)_m≥ 0 of descending chains of  half-spaces  such that 
    
        C =⋂_i=1^k⋂_m≥ 0h_m^i.
    
      * C is a union of Roller classes.
    
      *  The set of half-spaces _C^+ is non-terminating.
    
    We will prove <ref>⇒<ref>⇒<ref>⇒<ref> and <ref>⇔<ref>. 
    
    The claim that <ref> implies <ref>  is a restatement of <cit.>.
    
    
    
    
    
    
    To prove that <ref> implies <ref>,
    assume that y ∈ C = ⋂_i=1^k⋂_m≥ 0h_m^i and y' ∼ y
    meaning that  |(y, y')|< ∞. 
    Since _y^+ ∖_y'^+ is finite, it follows that there exists an N for which h_m^i ∈_y'^+ (i.e. y'∈ h_m^i) for each m≥ N and i=1, …, k.
    That is to say, 
    
        y'∈⋂_i=1^k⋂_m≥ Nh_m^i= ⋂_i=1^k⋂_m≥ 0h_m^i = C.
    
    
    To prove
    <ref> implies <ref>,
    suppose that C is  a union of Roller classes. 
    Let _C be the collection of half-spaces that cut C.  By Theorem <ref>, there is an associated cube complex X(_C). 
    Since C is closed and convex, Proposition <ref> and Lemma <ref> give an embedding i_C X̃(_C)↪X̃ whose image is C, and furthermore
    C= ⋂_h∈_C^+h.
    
    
    Let y_0 ∈ X(_C)^(0) and note that [̃ỹ_̃0̃]̃= X̃(_C).   Let  y=i_C(y_0)∈ C and note that i_C([y_0]) ⊂ [y], hence C=i_C([̃ỹ_̃0̃]̃) ⊂[̃ỹ]̃.  Since C is a union of equivalence classes, we have [y]⊂ C. Since C is closed, we have that [̃ỹ]̃⊂ C and hence C= [̃ỹ]̃.
     
    
    
    
    To prove <ref> implies <ref>,
    suppose  there exists a minimal half-space h_0∈_C^+. We claim that _C^+∖{h_0} is consistent. Indeed, if h∈_C^+∖{h_0} then h^*∉_C^+∖{h_0}. If h⊂ k then k∈_C^+, and since h_0 is minimal, h_0≠ k so k∈_C^+∖{h_0}. 
    
    We may therefore consider the CAT(0) cube complex associated to _C ⊔{h_0, h_0^*}. Fix y, y' ∈ X(_C ⊔{h_0, h_0^*}) such that y∈ h_0 and y'∈ h_0^*. Then, by Proposition <ref>  there is a unique point ỹ∈ C associated to the total and consistent choice of half-spaces 
        {h∈_C: y∈ h}⊔_C^+.
     Similarly, there is a unique point ỹ'∈ X∖ C associated to 
        {h∈_C: y'∈ h}⊔{h_0^*}⊔ (_C^+∖{h_0}).
    
    By construction, |(ỹ, ỹ')| = 2, hence C is not a union of Roller classes. 
    
    
    
    Finally, to prove <ref> implies <ref>, suppose that C is not a union of Roller classes. Then there are commensurate elements 
    y∈ C and  y' ∈ X ∖ C. Convexity means 
    
        C = ⋂_h∈_C^+h,
    
    hence there is a half-space h∈_C^+ with y∈ C ⊂ h and y'∉ h. Under the assumption that 
    |(y,y')|<∞, we may choose a minimal such h and conclude that _C^+ fails to be non-terminating. 
    
    Given a closed, convex set C satisfying 
    one of the equivalent conditions of Lemma <ref>, the class [y] whose closure is C is called the principal class of C. Compare Guralnik <cit.>. 
    
    Let [x],[y] ⊂ X be Roller classes. 
    We define a partial order on X by setting [x] ≤ [y] whenever _[x]^+ ⊂_[y]^+, or equivalently _[̃x̃]̃^+ ⊂_[y]^+.
    
    
    The following result is essentially a corollary of Lemma <ref>.
    
    
     For Roller classes [x],[y] ⊂ X, the following are equivalent:
     
      * [x] ≤ [y]
      * _[x]^+ ⊂_[y]^+
      * [y]⊂[̃x̃]̃
      * [y]∩[̃x̃]̃≠∅
    
    Conditions <ref> and <ref> are equivalent by Definition <ref>.  Since _[x]^+ =_[̃x̃]̃^+, by Lemma <ref>, Remark <ref> implies that <ref> and <ref> are equivalent. Next, <ref> trivially implies <ref>. Finally, <ref> implies <ref> by Lemma <ref>.
    
    The simplicial Roller boundaryX is the simplicial realization of the partial order of Definition <ref>. That is: vertices of X correspond to points of X, or equivalently Roller classes in X. Simplices in  X correspond to totally ordered chains of Roller classes. 
    
    Observe that the action of (X) on X preserves commensurability classes and the order ≤, yielding a bijective action  on X and a simplicial action on X.
    
    The characterization of Lemma <ref>.<ref> implies that any simplex in X has k ≤ X vertices, hence X≤ X-1.
    
    
    § THE SIMPLICIAL BOUNDARY
    
    
    In this section, we recall the definition of the simplicial boundary ∂_ X<cit.>; see Definition <ref>. Then, we 
    develop some connections between ∂_ X, the Roller boundary X, and the simplicial Roller boundary X. See Theorem <ref> and Corollary <ref> for the most top-level statement. The lemmas used to prove those top-level results will be extensively used in later sections.
    
    
    
     §.§ Unidirectional boundary sets
     
    Recall that  is the set of half-spaces of X and  is the set of hyperplanes of X. In this section, we mainly focus on collections of hyperplanes.
    
    
    A  triple  h_1, h_2, h_3 ∈ is called a facing triple if  their complements h_1^*, h_2^*, h_3^* are 
    pairwise disjoint. Similarly, a triple of hyperplanes ĥ_1, ĥ_2, ĥ_3 ∈ is called a facing 
    triple if there exists a choice of orientation such that h_1, h_2, h_3 form a facing triple.
    
    
    Caprace and Sageev  <cit.> showed that  in a non-elementary
     essential CAT(0) cube complex, given any half-space h∈ there exist half-spaces k, ℓ∈ such that {h,k,ℓ} is a facing triple. 
    
    
    
    A collection  of hyperplanes 𝒮⊂ is called unidirectional if for every ĥ∈𝒮, at most one side of ĥ contains infinitely many other elements of 𝒮. 
    
    A collection 𝒮⊂ is called inseparable if whenever ĥ, k̂∈𝒮 and ℓ̂ is a hyperplane that separates ĥ and k̂, then ℓ̂∈𝒮. This is closely related to the “tightly nested” condition in Proposition <ref>.
    
     A set ⊂ is a unidirectional boundary set (abbreviated UBS) if it is infinite, unidirectional, inseparable, and does not contain a facing triple. 
      
    Let  and 𝒱 be UBSes.  Define a relation ≼ where ≼𝒱 if all but finitely many elements of  lie in
    𝒱.  Say that  and  are commensurate (denoted ∼)  if ≼ and ≼.
    
    The relation ≼ on UBSes descends to a
    partial order on commensurability classes of UBSes. We say that  is minimal if its commensurability class is minimal — that is, if  ≼ implies ∼. Similarly, we say that  is maximal if ≼' implies ∼'.
    
    For disjoint subsets A, B ⊂X̃, let (A, B) be the set of hyperplanes separating A from B.
     It is straightforward to check that (A, B) is inseparable and does not contain a facing triple. Furthermore, if A⊂ X then (A, B) is unidirectional.  If, in addition, B⊂ X, then (A, B) is infinite. Under these last two conditions, we conclude that (A, B) = (A, B) is a UBS. Compare Lemma <ref>.
     
    Let  be a UBS. We say that  is pruned if every hyperplane ĥ∈ has exactly one associated half-space h containing infinitely many elements of . In this situation, we call 
    h the  canonical orientation of ĥ or the canonical half-space associated to ĥ.
    
    Let  be a UBS. Then  contains a canonical pruned sub-UBS ' ⊂ that is commensurate to .
    
    Let F_ be the set the hyperplanes of  with the property that both associated half-spaces contain finitely many elements of . We claim that F_ is finite.
    To see this, let ĥ_1, …, ĥ_D be a maximal family of pairwise transverse hyperplanes in F_. This family is finite because D ≤ X. For any ĥ∈ F_∖{ĥ_1, …, ĥ_D} there is at least one i for which ĥ is parallel (i.e. not transverse) to ĥ_i. By the definition of F_,  there are finitely many hyperplanes in  parallel to each ĥ_i,
     hence F_ is finite. 
     
     Now, define ' = ∖ F_. By construction, every ĥ∈' has exactly one associated half-space containing infinitely many elements of , hence infinitely many elements of ' as well.
     
    We claim that ' is a UBS. Since F_ is finite, it follows that ' is infinite. Unidirectionality and the lack of facing triples are properties that pass to subsets of , hence to '.  Next, suppose that ĥ, k̂∈' with ℓ̂ in between. Since ĥ, k̂∈ and  is inseparable, observe that ℓ̂∈. But
    ℓ̂∉ F_, because ĥ, k̂ both bound half-spaces containing infinitely many elements of . We conclude that ℓ̂∈', verifying that ' is a UBS. Since  and ' differ by finitely many hyperplanes, they are commensurate.
    
    
    
    Hagen proved that every (commensurability class of) UBS  decomposes in a well-defined fashion into a disjoint union of minimal UBSes.
    The following is a restatement of <cit.> and <cit.>.
    
    
    Let  be a UBS. Then there is a decomposition ∼_i=1^k _i, where:
    
      *  each _i is a minimal UBS;
      
      *  any UBS ⊂ is commensurate with the disjoint union of some of the _i;
      
      *  if 1≤ j < i ≤ k, then every hyperplane in _i crosses all but finitely many of the hyperplanes in _j.
     
    Consequently, there are finitely many commensurability classes of UBSes ≼.
    
    
    Lemma <ref> enables the following definition.
    
    
    
    
    For a UBS , the dimension of  is the number k appearing in the decomposition of Lemma <ref>. This is an invariant of the commensurability class.
    An immediate consequence of Lemma <ref>.<ref> is that () ≤ (X).
    
    The simplicial boundaryX is the following simplicial complex.  For each commensurability class of a UBS 
    , there is a (k-1)–simplex σ_, where k is the dimension of the class of .  The face relation is defined 
    as follows: σ_ is a face of σ_ if and only if ≼.  
    
    
    Note that X has a vertex for each commensurability class of a minimal UBS. Furthermore, a finite collection of 
    vertices spans a maximal simplex if and only if the union of the corresponding minimal UBSes is commensurate with a maximal UBS. However, there can exist non-maximal simplices that do not correspond 
    to a UBS; see Example <ref>. For this reason, X is not the simplicial realization of the partial order ≼.
    
    
    Observe that (X) acts on UBSes in a way that preserves  the ≼ relation, and hence preserves commensurability. Thus (X) acts simplicially on X.
    
    
    
    
     §.§ Minimal and dominant UBSes
    
    Next, we establish some structural results about minimal UBSes. 
    Given a set S consisting of hyperplanes, the inseparable closure of S, denoted S,
     is the intersection of all inseparable sets containing S. 
    
    
    Let ⊂(X) be a minimal UBS.  Then there exists an infinite descending chain {h_n : n ∈}⊂ with ĥ_n ∈, such that ∼{ĥ_n:n∈}.
    
    
    Conversely, for every descending chain {h_n : n ∈}⊂, there exists N≥ 0 such that {ĥ_n:n≥ N} is a minimal UBS.
    
    Let  be a minimal UBS.  Let  {h_n : n ∈}⊂ be a descending chain such that {ĥ_n}⊂, which exists because  is infinite, unidirectional, contains no facing triple, and 
    contains no infinite collection of pairwise-crossing hyperplanes.  Let ' = {ĥ_n} be the inseparable closure of {ĥ_n}. Since  is 
    inseparable, we have '⊂ by the definition of the inseparable closure.   Note that ' is a UBS (compare the proof of <cit.> or <cit.>).  Since '⊂ and  is minimal, we have '∼, which 
    proves the first assertion of the lemma.
    
    Now we prove the second assertion.  For each m≥ 0, let C_m={h_n:n≥ m} and let C_m be its inseparable closure.  As before, each C_m is a UBS.  Note that C_m⊂C_m' whenever m≥ m'.  In particular, C_m≼C_m' for m' ≥ m.  So, by Lemma <ref>, there exists M≥ 0 such that C_m∼C_M for all 
    m≥ M.  Hence, if m≥ M and {k_i} is any descending chain of half-spaces corresponding to hyperplanes in C_M, then there exists I≥ 0 such that {k̂_i : i≥ I}⊂ C_m.  This implies that C_M is commensurate with {k̂_i :i ≥ 0}, by, for example <cit.>. See also the proof of <cit.>.    
    
    Now let ⊂ C_M be a minimal UBS, which exists by <cit.>.  By the first part of the lemma,  is commensurate with the inseparable closure of some chain contained in 
    C_M.  By the preceding paragraph, C_M∼, so C_M is minimal, as required.
    
    Lemma <ref> has been generalized to the setting of median spaces by Fioravanti <cit.>. In fact, the same result of Fioravanti also generalizes 
    many other basic facts about UBSes, such as <cit.>.  
    
    The second assertion of Lemma <ref> corrects a slight misstatement in <cit.>: it is 
    true that minimal UBSes are commensurate with inseparable closures of chains, but inseparable closures of chains need not be minimal; one might first need to pass to a (cofinite) sub-chain (see 
    e.g. <cit.> and the paragraph following).  We emphasize that this does not affect the use 
    of <cit.> in <cit.>, because what's being used is the (correct) statement that, up to 
    commensurability, minimal UBSes arise 
    as inseparable closures of chains.
    
    In this paper, we primarily use the first assertion of Lemma <ref>, in conjunction 
    with Lemma <ref>, to decompose a UBS  as a disjoint union of minimal UBSes (up to commensurability), 
    each of which has the additional property that it is the 
    inseparable closure of a chain.
    
    
    
    
    The following consequence of Lemma <ref> neatly sums up the special properties of chains whose inseparable 
    closures are minimal UBSes:
    
    
    
    Let {h_n:n≥ 0} be an infinite descending chain of half-spaces.  For each m≥ 0, let _m be the inseparable closure of {ĥ_n:n≥ m}.  Then the following are equivalent:
    
      *  The UBS _m is minimal for all m≥ 0.
     
      * _m∼_0 for all m≥ 0.
    
    In particular, if _0 is minimal, then _0∼_m for all m≥ 0.
    
    Since _m≼_0 for all m, the first statement immediately implies the second.  For the reverse direction, Lemma <ref> provides M≥ 0 such that _m is minimal for m≥ 
    M.  If the second assertion holds, it then follows that the first must also.  
    
    Following Corollary <ref>,  for the rest of this subsection we shall refer to a sequence of disjoint hyperplanes {ĥ_n } whose inseparable closure is a minimal UBS
     as a chain of hyperplanes.
    
     
     In particular, a chain of hyperplanes {ĥ_n }_n≥ 0 defines a descending chain of half-spaces { h_n }_n≥ 0.  A descending chain of half-spaces { h_n }_n≥ 0 has the 
    property that for all sufficiently large N, the sequence {ĥ_n }_n≥ N  is a chain of hyperplanes, in view of Lemma <ref>. 
    
    
    
    Let  be a UBS. A hyperplane ĥ∈ is called dominant for  if ĥ = ĥ_0 is the base of a chain of hyperplanes { h_n }⊂ such that ĥ 
    crosses all but finitely many hyperplanes in ∖{ h_n }. 
    
    
    
     Recall that by definition of a chain of hyperplanes, {h_n } is a minimal UBS. See Figure <ref> for an example. 
    By Lemma <ref>, the inseparable closure { h_n }  is commensurate to some minimal UBS _i in the decomposition ∼_i=1^k _i of that lemma. Furthermore, _i 
    is unique: since a dominant hyperplane ĥ∈ is the base of a chain in _i, then ĥ must intersect all but finitely many hyperplanes of _j (for j ≠ i), hence ĥ 
    cannot be disjoint from a chain in _j.
    
    
    We also observe that if  is minimal and pruned, then every hyperplane of  is vacuously dominant.
    
    
    
    
    
    The following lemma is only stated in the special case where (X) is already a UBS. In practice, we will apply Lemma <ref> to convex subcomplexes (such as the convex hull of a geodesic ray) where this hypothesis holds.
    
    
     Suppose that = (X)
      is a pruned UBS of dimension k.  Then  contains minimal UBSes 𝒟_d ,…, 𝒟_k such that the following hold: 
     
      * Each 𝒟_i is a set of dominant hyperplanes for , and all but finitely many dominant hyperplanes belong to ⋃_i = d^k 𝒟_i.
      
      * For each i∈{d, …, k} and each ĥ_0 ∈𝒟_i, there is a chain {ĥ_n 
    }_n≥0⊂𝒟_i such that 𝒟_i is commensurate with {ĥ_n },  the 
    inseparable closure of the chain.
    
      *  For any such chain {ĥ_n }, there is N > 0, such that for all n ≥ N, we have 
    
        (ĥ_n+1)∖𝒟_i⊂(ĥ_n)∖𝒟_i.
     Furthermore, for all n 
    ≥ 0, we have 
    
        |(ĥ_n)-(ĥ_n+1)|<∞.
    
      *  For every hyperplane û∈, there exists ∈∈{d,…,k} and a dominant hyperplane ĥ∈𝒟_i such that ĥ lies in the canonical 
    half-space 
    associated to û. 
     
    
    We will not use item (<ref>) later in the paper, but we record it as a potentially useful fact about UBSes.
    
    
    By Lemma <ref>, there is a decomposition ∼_i=1^k_i, with an ordering such that for j < i, every hyperplane in _i crosses all but finitely many of the hyperplanes in _j. The ordering is only partially determined: if every hyperplane in _i crosses all but finitely many hyperplanes in _i+1, then we can 
    reverse the order of _i,_i+1 while keeping the conclusion of Lemma <ref>.<ref>.  Let d be the smallest index i such that _i can be placed at the top of the order in such a decomposition.
    
    
    Now, fix an index i ≥ d. 
    By Lemma <ref>, _i is commensurate with 𝒟_i = {ĥ_n}, where 
    {ĥ_n}⊂_i is a chain. Thus 𝒟_i ∼_i is a minimal UBS.
    
    We claim that every ĥ∈𝒟_i is dominant. 
     Given ĥ∈𝒟_i and the canonical associated half-space h (recall Definition <ref>), there exists N≥ 0 such that ĥ_N ⊂ h. 
     Thus ĥ is the base of the infinite chain {ĥ,ĥ_N,ĥ_N+1,⋯}. Furthermore, ĥ∈𝒟_i ⊂_i intersects all but finitely many hyperplanes in _j 
    for j ≠ i, because we have chosen an index i ≥ d. Thus ĥ is dominant by Definition <ref>.
     Thus we have found dominant minimal UBSes 𝒟_d,…,𝒟_k satisfying conclusions <ref> and 
    <ref>.
    
    Now we verify assertion <ref>. Fix i ≥ d and let ĥ,ĥ'∈𝒟_i.  Since the 
    minimal UBS 𝒟_i is the inseparable closure of a chain, ĥ,ĥ' both cross finitely many hyperplanes in 𝒟_i.  Indeed, if 𝒲(ĥ)∩𝒟_i is infinite, it must contain a chain of hyperplanes whose inseparable closure 𝒟' belongs to 𝒟_i, and is contained in 
    𝒲(ĥ) since the latter is inseparable.  Since 𝒟_i is minimal, 𝒟'∼𝒟_i.  Hence 𝒲(ĥ) contains all but finitely many elements of 𝒟_i;  since ĥ∈𝒟_i, this contradicts that 𝒟_i is the inseparable closure of a chain.  Thus 𝒲(ĥ)∩𝒟_i is finite.  Moreover, since 𝒟_i 
    is dominant, ĥ,ĥ' both cross all but finitely many hyperplanes of ∖𝒟_i, and we can therefore conclude that 
    
        |(ĥ)(ĥ')|<∞.
    
    
    So,  it suffices to show that, for all sufficiently large n,  we have (ĥ_n+1)∖𝒟_i⊂(ĥ_n)∖𝒟_i.
    
    If this doesn't hold, then  for infinitely many n we can find a hyperplane û_n∉𝒟_i that crosses 
    ĥ_n+1 but not 
    ĥ_n; note that û_n does not separate any two elements of our chain since û_n∉𝒟_i.  Since there are no facing 
    triples, û_n 
    crosses ĥ_m for 
    m≥ n+1. 
       Since the collection of violating 
    hyperplanes {û_n} is infinite and contains no hyperplanes crossing ĥ_0, dominance of ĥ_0 is 
    therefore 
    contradicted.  Thus there exists N such that (ĥ_n+1)∖𝒟_i⊂(ĥ_n)∖𝒟_i for n≥ N, establishing <ref>.
    
    We now prove assertion <ref>.  Let û∈ be a hyperplane, and let u be the  canonical 
    half-space associated to û. Given the fixed decomposition ∼_i=1^k_i, let i be the 
    largest index such that
    u contains a chain of hyperplanes in , whose inseparable closure _i' is commensurate to some _i. Such an i exists because  is pruned. We claim that i ≥ d. This claim implies 
    that u contains infinitely many hyperplanes of 𝒟_i, which will suffice to prove the lemma.
    
    Suppose for a contradiction that i < d. Fix v̂∈_i', and consider a minimal UBS _j for j > i. If any hyperplane in _j fails to cross v̂, then it fails to cross û, 
    hence u contains a chain in _j, contradicting the maximality of i. See Figure <ref>.
    
    
    
    
    Furthermore, since v̂∈_i, it must cross all but finitely many hyperplanes of _ℓ for ℓ < i by 
    Lemma <ref>.<ref>. Thus v̂ crosses all but finitely many hyperplanes of ∖_i', hence v̂ is dominant. Since v̂∈_i' was 
    arbitrary, this shows that i ≥ d by the definition of d.
    
    
     §.§ Connections between X and X
    
    The next several lemmas develop tools for comparing the Roller boundary and the simplicial boundary. 
    
    
    
    
    Let ⊂(X) be a  UBS, and let ' ∼ be a pruned UBS commensurate to . For every ĥ∈', let 
    h ∈(X̃) be the canonical orientation of ĥ,  that is,  the (extended, vertex) half-space  containing 
    infinitely many hyperplanes 
    of '. 
    
    The umbraỸ_ associated to  is 
    
        Ỹ_ = ⋂_ĥ∈' h ⊂X̃.
    
    By Definition <ref>, the umbra Ỹ_ is a convex subset of X, one may think of it as the Roller realization of the UBS . In Lemma <ref>, we will show that  Ỹ_ satisfies the equivalent conditions of Lemma <ref>. Then, Y_ will denote the principal class of Ỹ_: that is, the unique Roller class whose closure is Ỹ_.
    
    Let ⊂(X) be a UBS. Then the umbra Ỹ_ associated to  is a nonempty subset of X.
    Furthermore, 
     
      *  If ∼ then Ỹ_ = Ỹ_. 
    
      *  If ∼_1∪⋯∪_N for some UBSes _1, …,_N then 
        Ỹ_ = ⋂_i=1^NỸ__i.
    
    Let ' be the pruned UBS commensurate to . As in Definition <ref>, let h be the canonical orientation of every ĥ∈', and define  𝔘' = {h : ĥ∈' }⊂. Then
     Ỹ_:= ⋂_h∈𝔘'h. 
      
     Since X̃ is compact, to show that Ỹ_ is not empty, it is sufficient to show that 𝔘' has the  finite 
    intersection property. By the Helly property for half-spaces <cit.> this is equivalent 
    to showing that every pair of half-spaces h,k ∈𝔘' has nonempty intersection. But a disjoint pair 
    h, k∈𝔘'  contradicts the unidirectionality of ', as both sides of ĥ would contain infinitely many elements  of '. 
    
    Using the same argument, we observe that for every h∈𝔘' there is an infinite descending chain { h_n } with h_0 = h and h_n∈𝔘'. Indeed, fix h∈𝔘'. Since ' is pruned, there are infinitely many hyperplanes in ' contained in h. Since ' is unidirectional, k̂⊂ h and k̂∈' implies k ⊂ h. Applying induction, we find the infinite descending chain. Thus Ỹ_⊂ X.
    
    We now turn to the commensurability class of . Suppose that  is a UBS commensurate to . Since commensurability is an equivalence relation, we conclude that ' and ' are commensurate as well. Let 𝔙' = {h : ĥ∈' }⊂ be the set of canonical half-spaces associated to '.
    
    
    We claim that 𝔘' and 𝔙' are also commensurate. Since the map taking half-spaces to hyperplanes is 2-to-1, it suffices to show that under this map, the set 𝔘'∖𝔙'  has image in the finite set '∖', and vice versa. Let h∈𝔘'∖𝔙'. Then ĥ∈'. By definition of 𝔘', we know that the set {k̂∈: k̂⊂ h} is infinite. The commensurability of  and  implies that {k̂∈: k̂⊂ h} is infinite as well. But h∉', hence it must be the case that ĥ∉'. 
    
    
    To see that Ỹ_= Ỹ_ it is sufficient to  show that if h∈𝔘'  then there is k∈'∩𝔘' with k⊂ h. But this is immediate. As was proved above, for any h∈𝔘' there is an infinite descending chain { h_n }⊂𝔘' with h_0 = h. Since 𝔘' and 𝔙' are commensurate, for N sufficiently large, we must have that h_N∈𝔙'.
    
    
    
    
    Finally, the construction above makes it clear that  if  is commesurate to _1∪⋯∪_N for some  UBSes 
    _1, …,_N then Ỹ_ = ⋂_i=1^NỸ__i. 
    
    For every UBS , there is a Roller class Z ⊂ X such that Ỹ_ = Z̃. Furthermore, the assignment ↦ Z = Y_ is (X)–equivariant.
    
    By Lemmas <ref> and <ref>,  is commensurate to a UBS =_i=1^k_i, where _i = {ĥ_n^i} for a descending chain of half-spaces { h_n^i }. Note that every _i is pruned. Thus
    
        Ỹ_ =  ⋂_1≤ i ≤ kỸ__i = ⋂_1≤ i ≤ k  ⋂_ĥ∈_i h = ⋂_1≤ i ≤ k  ⋂_n ∈ h_n^i.
    
    Here, the first equality holds by Lemma <ref>, the second equality holds by Definition <ref>, and the third equality holds because the hyperplanes added in the inseparable closure do not affect the intersection. By Lemma <ref>, a set of this form is the closure of a unique (principal) Roller class Y_. 
    
    We observe that the above construction is independent of the choice of  descending chains with the desired properties, and hence the map ↦ Y_ is (X)–equivariant.
    
    Let x∈ X^(0) and let Y ⊂ X be a convex set. Then the set of separating hyperplanes (x,Y)= (x,_Y(x)) is a pruned UBS.  
    If x'∈ X^(0), then 
    (x',Y) ∼(x,Y). Finally, (x,[y])∼(x,y) for every y∈ X. 
    
    We begin by showing that  :=(x,Y) is a UBS.  Recall that (x,Y) is the set of hyperplanes associated to _x^+ _Y^+. Since x ∈ X^(0), it follows that _x^+ satisfies the descending chain condition and since Y⊂ X, it follows that _Y^+=_Ỹ^+ 
    has an infinite descending chain. Hence,  is unidirectional and infinite. Since =(x,Y) is an interval, it follows that it is inseparable and does not contain a facing triple, hence  is a UBS. The fact that (x,Y)= (x,_Y(x)) follows from Proposition <ref> and shows that  is pruned.  
    
    Let x,x' ∈ X^(0). We claim that (x,Y) (x',Y) ⊂(x,x').  By symmetry, it suffices to observe that  a hyperplane ĥ separating x from Y but not x' from Y necessarily separates x from x'. Since the cardinality of (x,x')  is the distance d(x,x')<∞, we conclude that the two UBSes are commensurate. 
     
    Finally, fix y∈∂ X. We show that (x,[y])∼(x,y). Proposition <ref> says that (x,[y]) = (x,_[y](x)), which implies that (x,[y]) ∪(_[y](x), y)= (x,y). But _[y](x) ∈ [y] by definition, hence  | (_[y](x),y) | < ∞, completing the proof. 
    
    Let  Y ∈ X be a Roller class, and fix a basepoint x ∈ X^(0). Following Lemma <ref>, we call (x,Y) a UBS representing the class Y, and denote it _Y. Since the commensurability class [_Y] is independent of x, by Lemma <ref>, we do not include the basepoint x in the notation _Y.
    
    It follows immediately that the assignment Y ↦ [ _Y ] is (X)–equivariant.
    
    
    
    With this notation in place, we  conclude:
    
    
    Fix x∈ X^(0) and Y∈ X. Then  Y = Y__Y. In particular,  every Roller class arises as the principal class of the umbra of some UBS.
    
    Since _Y = (x,Y) is a UBS, by Lemma <ref> it is commensurate to _i=1^k  {ĥ_n^i} for descending chains { h_n^i }, hence Equation (<ref>) gives
    
        Ỹ__Y =  ⋂_1≤ i ≤ k  ⋂_n ∈ h_n^i.
    
     By construction, Ỹ⊂ h_n^i for every ĥ_n^i ∈_i, hence Ỹ⊂Ỹ__Y.
    
    As in Lemma <ref>, let  Y__Y  denote  the principal Roller class of Ỹ__Y. 
     We claim that Y = Y__Y. So far, we have shown that Y__Y≤ Y in the partial order of Lemma <ref> and so we are left to show that Y≤ Y__Y. To this end, we fix a half-space h∈ with Y ⊂ h and now show that  Y__Y⊂ h. 
    
    Let x'∈ h^* ∩ X^(0) and set '_Y = (x',Y). Observe that ĥ∈'_Y by construction. Then by Lemma <ref> we have that '_Y is a pruned UBS commensurate to _Y and so Lemma <ref> implies Ỹ__Y=Ỹ_'_Y. Finally, by Definition <ref> we have that Y__Y⊂Ỹ__Y⊂ h. 
    
    Let γ⊂ X be a geodesic ray, in either the CAT(0) or combinatorial metric. Let  (γ) be the collection of hyperplanes intersecting γ, which is a UBS by  <cit.>.
     If  is a UBS and ∼𝒲(γ) for some combinatorial geodesic ray γ, we say that the class of  is ℓ^1–visible. 
    Let Y ∈ X. Then, for any x ∈ X^(0) and any y ∈ Y, Lemma <ref> provides a combinatorial geodesic ray γ such that γ(0)=x and γ(∞) =  y ∈ Y. By Definition <ref> and Lemma <ref>, we have 
    
        (γ) = (x, y) ∼(x, [y]) = (x, [̃ỹ]̃).
    
    
    Furthermore, by Lemma <ref>, the commensurability class [(γ)]= [_Y] does not depend on the choice of x ∈ X^(0) and  y ∈ Y.  In particular, every UBS representing a class Y is ℓ^1–visible.
    
    Let  be a UBS.  Let y∈Ỹ_ and let γ be a combinatorial geodesic in X such that 
    γ(∞) = y. 
     Then ≼(γ).  In particular, if  is maximal, then ∼(γ).
    
    As in Lemma <ref>,  is commensurate to _i=1^k _i, where the _i are minimal and _i = {ĥ_n^i} for a descending chain of half-spaces { h_n^i }. Thus 
    Equation (<ref>) gives
    
        Ỹ_ =  ⋂_1≤ i ≤ kỸ__i = ⋂_1≤ i ≤ k  ⋂_ĥ∈_i h = ⋂_1≤ i ≤ k  ⋂_n ∈ h_n^i.
    
    Since γ(m) → y ∈Ỹ_, we must have y ∈ h_n^i for every i and every n. At the same time, since the sequence { h_n^i } is a descending chain for each i, we have that x = γ(0)
    ∉ h_n^i for sufficiently large n. Thus all but finitely many hyperplanes ĥ_n^i belong to (x,y)=(γ). The inseparable closure of this cofinite subset of {ĥ_n^i} must belong 
    to (γ), and by minimality of _i and Corollary <ref>, it follows that all but finitely many elements of each _i belong to W(γ).
    
    Let  be a maximal UBS. Then, for every y ∈  Y_, there is a combinatorial geodesic γ limiting to y, such that ∼(γ). In particular, the commensurability class [] is ℓ^1–visible.
    
    Let y ∈ Y_. By Lemma <ref>, there is a combinatorial geodesic ray γ limiting to y.  By  
    Lemma <ref>, we have ∼(γ). Thus, by Definition <ref>,  is ℓ^1–visible.
    
    
    In Corollary <ref>, the conclusion that [] is visible was previously shown by Hagen <cit.>. The above proof, using the Roller 
    boundary viewpoint, is considerably simpler.
    
    
    
    
     §.§ Order-preserving maps
    
    Recall from Definitions <ref> and <ref> that the partial order ≤ on Roller classes is set containment of the associated sets of half-spaces, while the partial order ≼ on commensurability classes of UBSes  is set containment up to commensurability. 
    The following theorem says that these partial orders are closely related.
    
    
    
    Let 𝒰ℬ𝒮(X) be the collection of commensurability classes of UBSes in X. Then there are (X)–equivariant functions 
    𝒰ℬ𝒮(X) → X and X →𝒰ℬ𝒮(X), with the following properties.
    
      *  The assignment [] ↦ Y_ is order-preserving and onto.
    
      *  The assignment Y ↦ [_Y] is an order-preserving section of .
    
      *  restricts to a bijection between the set of  ≼–maximal classes of UBSes and the set of ≤–maximal Roller classes, with inverse .
    
    
    The notation  stands for “Roller to unidirectional,” while  stands for “unidirectional to Roller.” This is inspired from the classical notation denoting the collection of maps from a set A to a set B as B^A.
    
    
    To prove <ref>, let  be a UBS. By Lemma <ref>, there is a well-defined Roller class Y_ such that the
     umbra Ỹ_ is the Roller closure of Y_. By 
    Lemma <ref>, Y_ only depends on the commensurability class []. Hence the assignment [] ↦ Y_ gives a well-defined function  
    𝒰ℬ𝒮(X) → X. This function  is (X)–equivariant by Lemma <ref>, and onto by Corollary <ref>. 
    
    Next, we check that  respects the ordering. Lemma <ref> implies that if
     ≼𝒱, then
    Y_𝒱⊂Y_, hence the
    Roller classes satisfy
    Y_≤ Y_𝒱 by Lemma <ref>. Thus  is order-preserving, proving <ref>.
    
    
    
    To prove <ref>, let Y ∈ X. By Definition <ref>, there is a well-defined commensurability class of UBS representing Y, namely [_Y] = (Y) ∈𝒰ℬ𝒮(X). Thus  is well-defined. Equivariance also follows from Definition <ref>. Next, observe that
    
        ∘(Y) = ([_Y]) = Y__Y = Y,
    
     where the last equality follows from Corollary <ref>. Thus  is a section of .
    
    To check that  is order-preserving, let Y, Z be Roller classes with Y ≤ Z. By  Lemma <ref>, this means Z⊂Y.  Fix a base vertex x∈ X^(0).  By Lemma <ref>, there exist 
    combinatorial geodesic rays γ_y, γ_z, originating at x, such that γ_y(∞) =  y∈ Y and γ_z(∞) =  
    z ∈ Z.  Now, Remark <ref> says that 
    
        _Y∼(x,Y) ⊂(x,Z) ∼_Z,
    
    hence [_Y] ≼ [_Z], as desired.
    
    
    
    To prove <ref>, let  be a maximal UBS. Choose a point y ∈ Y_ = ([]). By Corollary <ref>, there is a combinatorial geodesic ray γ limiting to y, such that ∼(γ). Thus, by Remark <ref>, we have
    
        [] = [(γ)] = [_Y_] = (Y_) = ∘([]).
    
    Thus the restriction of  to maximal classes in 𝒰ℬ𝒮(X) is invertible, and in particular bijective.
    
    Equation (<ref>) also shows that  sends maximal classes in 𝒰ℬ𝒮(X)  to maximal classes in X. Indeed, suppose that [] is maximal but ([]) = Y_ < Z for some Roller class Z. Then we would have [] = (Y_) < (Z), contradicting the maximality of . That  sends maximal classes to maximal classes is checked in the same way.
    
    
    The following example shows that  can fail to be injective.
    
    
     Consider the standard 1/8th-plane staircase, corresponding to squares whose  vertices (x,y) satisfy x≥ y≥ 0. In 
    this case, there are exactly 2 equivalence classes of minimal UBS, corresponding to vertical hyperplanes _V and horizontal 
    hyperplanes _H. These are almost transverse, hence _H_V  ∪_H. However, [_H] = ([_V  ∪_H]). Thus  is not injective.
    
    
    
    On the other hand, the following corollary shows that  is finite-to-one.
    
    
    Let Y ∈ X be a Roller class. Then there are finitely many other Roller classes Z such that Z ≤ Y.
    
    For each Z ≤ Y, Theorem <ref>.<ref> says that (Z) ≼(Y). Furthermore,  is injective.
    By Lemma <ref>, there are only finitely many commensurability classes  [] ≼(Y). Thus there are finitely many Z ≤ Y. 
    Let ( X)' be the barycentric subdivision of X. Recall from Definition <ref> that
    X is the union of simplices corresponding to commensurability classes
    of UBSes. However, a simplex of X may have proper faces that do not come from commensurability
    classes, as illustrated in Example <ref> below.  Hence, a vertex of ( X)' might fail to be 
    associated to a UBS commensurability class. 
    
    Let X be the simplicial realization of the partial order ≼ on 𝒰ℬ𝒮(X). Then X naturally embeds into ( X)'. By the above paragraph, this embedding is not 
    in general onto.
    
    
    The following example, constructed by Dan Guralnik and Alessandra Iozzi, illustrates a subtlety in the definition of X which shows the difference between X and X.
    
    
    [Weird faces of simplices of X]
    Let X be the 3–dimensional 
    CAT(0) cube complex given by the following data:
    
      *  The set of hyperplanes has the form (X) = {B_i}_i ≥0⊔{S_j}_j≥0⊔{D_k}_k ≥0.  
      *  For each 
    A∈{B,S,D} and each n≥1, the hyperplanes A_n±1 are separated by A_n.
    
      * B_i crosses S_j if and only if i ≥ j.
    
      * S_j crosses D_k if and only if j ≥ k.
    
      * B_i crosses D_k if and only if i ≥ k.
    
      *  If i < j < k, then S_j separates B_i from D_k.
    
    Part of X is shown in Figure <ref>.  
    
    
    Then X is a single 2–simplex represented by the UBS 
    {B_i}_i ≥0∪{S_j}_j≥0∪{D_k}_k ≥0.  The 0–simplices are represented by the minimal UBSes 
    {B_i}, {S_j}, {D_k}.  The sets {B_i}∪{S_j} and {S_j}∪{D_k} are UBSes representing 1–simplices, 
    but {B_i}∪{D_k} is not a UBS, because it is not inseparable (consider the last bullet).  The complex X is therefore obtained from 
    the barycentric subdivision of the 2–simplex by deleting all of the cells that contain a vertex at the barycenter of {B_i}∪{D_k}.
    
    
    
     We remark that by <cit.>, a face of a simplex of X can only fail to correspond to a commensurability class of UBSes when one of the 0–simplices of that face is
     ℓ^1–invisible.
    
    
    Having passed from X to X, Theorem <ref> has the following corollary.
    
    
    The order-preserving maps  and  of Theorem <ref> induce (X)–equivariant simplicial maps X→ X and X →  X, as follows:
    
      * X→ X is  surjective.
    
      * X →  X  is an injective section of .  
    
      *  is a homotopy 
    equivalence with homotopy inverse  .
    
     By definition, X is the simplicial realization of the partial order ≤ on X.  Similarly, X is the simplicial realization of the partial order 
    ≼ on 𝒰ℬ𝒮(X).  So, the first two enumerated assertions follow from 
    Theorem <ref>.  
    
    To prove <ref>, let Y be a Roller class.  Let [𝒱]∈ ()^-1(Y).  Then Y_𝒱=Y__Y.  By 
    Remark <ref> and Lemma <ref>, we have 𝒱≼_Y.
    
    Using the notation Y for the 0–simplex of X corresponding to the Roller class Y, we have just shown that ^-1(Y) is a subcomplex of X spanned by 
    0–simplices adjacent or equal to the 0–simplex [_Y], so ^-1(Y) is topologically a 
    cone.  In particular, ^-1(Y) is contractible.  Quillen's fiber theorem (see e.g. <cit.>) implies that  is a homotopy equivalence, such that any section is a homotopy inverse. In particular,  is a homotopy inverse of .
    
    The preceding corollary provides an explicit (X)–equivariant homotopy equivalence X→ X.  Furthermore, it is possible, although somewhat tedious, to construct an explicit, 
    (X)–equivariant homotopy equivalence X→  X.  Composing these maps gives
    a homotopy equivalence X → X, which is (X)–equivariant on the nose.
    This is slightly stronger than Proposition <ref>, which asserts that X and 
    X are  homotopy equivalent.  We have chosen a different proof of Proposition <ref> that is somewhat shorter, relying on the nerve theorem, and only yielding 
    (X)–equivariance up to homotopy.  Our ultimate goal is to relate the homotopy type of X and X to that of the Tits boundary X, and in any case our homotopy equivalence X→ X, provided by Theorem <ref>, is only equivariant up to homotopy. 
    
    
    § THE TITS BOUNDARY
    
    
    In this section, we recall the definition of the Tits boundary X, and establish some 
    connections between points on the Tits boundary and UBSes. The main result of this section, Proposition <ref>, is a technical result about combining UBSes that will be crucial in the next section.
    
    In this section, we will work extensively with the CAT(0) metric d_X on the cube complex X, hence most half-spaces considered here are CAT(0) half-spaces.  Recall from Section <ref> that if ĥ is a hyperplane with open carrier N(ĥ),
    the two vertex half-spaces associated to  ĥ are denoted h, h^*. The two CAT(0) half-spaces associated to ĥ are the cubical convex hulls (h) and (h^*), respectively. 
    Observe that 
     (h) and (h^*) are exactly the components of X ∖ N(ĥ). 
    
    
    
    The Tits boundary of X, denoted X, is the set of equivalence classes of CAT(0) geodesic rays  in 
    X, where rays γ,γ' are equivalent if the Hausdorff distance between them is finite.  As a set, X coincides with the visual boundary of X.
    
    We endow X with a metric, as follows.
    Given CAT(0) geodesic rays α,β [0,∞)→ X with α(0)=β(0)=x, the Alexandrov angle formed by α,β at x is 
    
        ∠_x(α,β)=cos^-1(lim_t,t'→0_X(α(t), β(t'))^2-t^2-(t')^2/2tt')
    
    In other words, ∠_x(α,β) is computed by applying the law of cosines to a triangle with sides along α and β, and then taking a limit as the triangle shrinks.
    Let a = [α] ∈ X and b = [β] ∈ X be the the equivalence classes of α,β respectively.  Following  <cit.>, we define
    
        ∠_T(a,b) = ∠_T([α],[β])
        :=sup_x∈ X∠_x(α_x,β_x),
    
     where α_x,β_x are the rays emanating from x and representing 
    a,b respectively.  Then ∠_T induces a length metric d_T on X in the standard way, making it a CAT(1) 
    space. See <cit.>. We always equip X with the metric _T. By <cit.>, the automorphism group 
    (X) acts on X by isometries.
    
    
    We remark that the original definition of the Alexandrov angle <cit.> is somewhat more involved. In our setting, since X is a CAT(0) space, <cit.> says the limit in (<ref>)  exists and is equal to the Alexandrov angle in the original definition. Compare <cit.>.
    
    Definition <ref> has the following generalization to the cuboid setting.
    
    
    
    Fix a group G acting on X by cubical automorphisms, as well as a G–admissible hyperplane rescaling ρ, as in Definition <ref>.
    Then the cuboid metric d_X^ρ is still a CAT(0) metric by Lemma <ref>. Applying Definition <ref> to the CAT(0) space (X, d_X^ρ), we obtain the cuboid Tits boundary^ρ X = (X, d_X^ρ), with an associated CAT(1) metric d_T^ρ. 
    The restricted automorphism group (X^ρ) acts on ^ρ X by isometries. Since ρ is a G–admissible rescaling, we have G ⊂(X^ρ) by Definition <ref>, hence ^ρ X still admits a G–action.
    
    
    All of the results of this section extend to a cuboid metric d_X^ρ. See Remarks <ref>, <ref>, and <ref> for details.
    
    Throughout this section, we use Greek letters α, β, γ to denote geodesic rays, and the corresponding Roman letters a,b,c to denote equivalence classes. We write a = [α] = α(∞) to denote the endpoint of α in X.
    
    
    
    
    
     §.§ Deep sets
    
    Every point of the Tits boundary has an associated deep set of half-spaces.
    
    
    Let a∈ X, and
    let α [0,∞)→ X be a CAT(0) geodesic representing a. We define the deep set
        D_a = {h∈ :  for all  R>0  there is  t_R>0  s.t. 𝒩_R( α[t_R,∞)) ⊂(h) }.
    
    It is immediate to check that the definition does not depend on the representative geodesic α. If h ∈ D_a, we say that h is deep for a.
    
    Let α [0,∞)→ X be a CAT(0) geodesic ray with α(0) ∈ X^(0), and let ĥ∈(α). Then the following hold:
    
      *  Define f(t) = d_X(α(t), ĥ), and let t_0 = α^-1(ĥ). Then, for 
    t_0 ≤ s ≤ t, we have
    
        f(t)-f(s) ≥ A_0 · (t-s),
    
    where A_0 > 0,  and A_0 may depend on ĥ and α but not on s,t.
    
      *  The hyperplane ĥ has a deep half-space h ∈ D_a.
    
    Consequently, (α) is a pruned UBS. 
    
    By <cit.>, f is a convex, 1–Lipschitz function.   
    By convexity, f has left and right derivatives at every point in (0,∞), and these are non-decreasing.  Since f is Lipschitz and convex,  the left and right 
    derivatives coincide almost everywhere, hence f' is well-defined almost everywhere, and
    non-decreasing at all points where it is defined.
    
    Let t_0 = α^-1(ĥ). Since the carrier N(ĥ) ≅ĥ× (-1/2, 1/2) is an ℓ^2 product and α(t_0) ∈ĥ lies on the midcube of a cube, there 
    is an initial segment of α after crossing ĥ on which f(t) is an increasing linear function. Therefore, f'(t) = f'(t_0) = A_0 > 0 on this segment. (In fact, f'(t_0) = sinθ_0, 
    where θ_0 is the angle between α and ĥ in the ℓ^2 metric on a cube.) Hence f'(t) ≥ A_0 for all t≥ t_0 at which f'(t) is defined. Since f is Lipschitz, it 
    follows that for all t_0≤ s≤ t, we have 
    
        f(t)-f(s)=∫^t_sf'(z)  dz ≥ A_0·(t-s),
    
    proving <ref>. 
    
    Now, <ref> immediately implies <ref>.
    The conclusion that (α) is pruned is then immediate from Definition <ref>.
    
    
    The following lemma is a strengthening of <cit.>. While <cit.> proves that D_a contains an infinite descending chain, we prove the stronger statement that D_a is non-terminating.
    
    
    For a point a ∈ X, define Ỹ_a = ⋂_h∈ D_a h. Then D_a and Ỹ_a have the following properties:
    
      * D_a is consistent, and therefore D_a = ^+_Ỹ_a. 
    
      *  Every half-space h_0 ∈ D_a belongs to a descending chain {h_0, h_1, …}⊂ D_a. Furthermore, if ĥ_0 ∈(α) for a ray α∈ a, then ĥ_n ∈(α) for all n.
    
      * Ỹ_a⊂ X is the closure of a (unique, principal) Roller class Y_a.
    
    The consistency of D_a is immediate from the definition. Thus, by Proposition <ref>.<ref>, we obtain D_a = ^+_Ỹ_a. This proves <ref>.
    
    To prove <ref>, let h_0 ∈ D_a.  By <cit.>,  there exists a geodesic 
    ray α representing a such that α(0) ∈ h_0^*. Since h_0 ∈ D_a, Definition <ref> implies that 
    α must deviate arbitrarily far from ĥ_0.
    Thus, by Lemma <ref>, a point α(t) for large t has the property that |(α(t), y)| ≥ 1 for 
    every y ∈ N(ĥ_0). Now,  Proposition <ref> says that there is at least one hyperplane ĥ_1 separating 
    α(t) from N(ĥ_0). Observe that ĥ_1 ∈(α) by construction, and orient ĥ_1 by choosing the 
    half-space h_1 ⊂ h_0. Now, Lemma <ref> says that h_1 ∈ D_a. Continuing inductively, we obtain 
    a descending chain {h_0, h_1, …}⊂ D_a where ĥ_n ∈(α) for all n, proving 
    <ref>.
    
    
    By <ref>,  D_a = ^+_Ỹ_a is consistent, and by  <ref>, D_a contains an infinite descending chain. Thus Ỹ_a  = ⋂_h∈ D_a h is a convex, nonempty subset of X.  Since D_a is non-terminating by  <ref>, Lemma <ref> implies
     that Ỹ_D_a is the closure of a principal Roller class Y_a ∈ X. (Compare Definition <ref>.) This proves <ref>.
     
    The previous lemmas generalize readily to a cuboid metric d_X^ρ. Indeed, Lemma <ref> generalizes because because hyperplane carriers are still ℓ^2 products, and because <cit.> works in any CAT(0) space.
    Similarly, Lemma <ref> generalizes because <cit.> works in every CAT(0) space and, because d_X^ρ is quasi-isometric to the ℓ^1–metric on X^(0). 
    
    
     §.§ CAT(0) rays and their UBSes
    
    Given a CAT(0) geodesic ray γ in X, starting at a point of X^(0), recall that  (γ) denotes the set of 
    hyperplanes h that intersect γ.  It is easy to see (cf. <cit.>) that 
    (γ) is a UBS.
    
    
    
    
    Throughout this subsection, fix a,b∈ X and let α, β be CAT(0) geodesic rays representing a and b, respectively. We can assume that  α(0)=β(0) = x ∈ X^(0).
    
    The following lemma says that when (α)∪(β) has finite symmetric difference with a UBS, it actually is a UBS. 
    Several subsequent lemmas build toward Proposition <ref>, which will show that (α)∪(β) is in fact a UBS associated to a ray γ.
    
    
    Suppose that (α)∪(β) is commensurate with a UBS. 
    Define 𝒜=(α) ∖(β) and ℬ=(β) ∖(α) and  𝒞=(α)∩(β).
    Then
    
      *  Each of 𝒜,ℬ is infinite or empty.
     
      *  Every element of 𝒜 crosses every element of ℬ.
      
      * (α) ∪(β) = 𝒜⊔ℬ⊔𝒞 is a UBS.
    
    
    Let = (α) ∪(β). Since  is commensurate with a UBS by hypothesis, it must be infinite and unidirectional. We 
    will check the other properties of a UBS at the end of the proof.
    
    
    By Lemma <ref>, every hyperplane ĥ = ĥ_0 ∈(α) corresponds to a deep half-space h_0 ∈ D_a, and  by Lemma <ref>, h_0 is the start of a descending chain {h_0, h_1, …}⊂ D_a, where h_n ∈(α) for every n. Similarly, every hyperplane k_0 ∈(β) defines a descending chain {k_0, k_1, …}⊂ D_b, where k_m ∈(β) for every m.
    
     If 𝒜 = (α) ∖(β) ≠∅, then any hyperplane ĥ_0 ∈𝒜 defines a chain  {ĥ_0, ĥ_1, …}⊂(α), as above. Furthermore, ĥ_0 separates every ĥ_n from β. Thus ĥ_n ∈𝒜, and 𝒜 is infinite. Similarly, ℬ must be empty or infinite, proving  <ref>.
    
    Next, suppose for a contradiction that ĥ_0 ∈𝒜 is disjoint from k̂_0 ∈ℬ. Then the deep half-spaces h_0 ∈ D_a and k_0 ∈ D_b are also disjoint. But then the disjoint chains {ĥ_n}⊂(α) and {k̂_m }⊂(β) contradict the fact that = (α) ∪(β) is unidirectional. This proves  <ref>.
    
    
    Finally, we show that  is a UBS. We have already checked that  is infinite and unidirectional.
    To check inseparability, suppose that ℓ̂ is a hyperplane of X that separates ĥ, k̂∈. Since we already know that (α) and (β) are inseparable, it suffices to check the case that ĥ∈𝒜 and k̂∈ℬ. But then ĥ and k̂ must cross by <ref>, a contradiction. Similarly, since (α) and (β) contain no facing triples, any potential facing triple in  must contain at least one hyperplane  ĥ∈𝒜 and at least one hyperplane  k̂∈ℬ. But then ĥ and k̂ must cross, hence  cannot contain any facing triples. Thus  is a UBS, proving <ref>.
    
    
    Recall from Definition <ref> that given a UBS , we have the umbra Ỹ_⊂X̃.
    Following Proposition <ref>, let _Y_ = _Ỹ_X̃→ Y_ be the gate projection to Ỹ_.
    
    
    Suppose α and β are geodesic rays starting at x∈ X^(0), and that = (α)∪(β) is commensurate with a UBS. Then = (x, _Y_(x)). 
    
    Since the geodesic rays start at the vertex x, Lemma <ref> says that  all the hyperplanes they cross are deep, i.e.  (x,Y_a) =(α) and (x,Y_b)= (β), hence = (x,Y_a)∪(x,Y_b). In addition, Lemma <ref> says that  is a UBS.
    
    
    Now, Lemma <ref> gives  Ỹ_= Ỹ_a  ∩Ỹ_b, and in particular _Ỹ_^+ = D_a∪ D_b. By Lemma <ref> and
      Remark <ref>, we have 
     (x, Ỹ_)=(x, Y_)= (x, _Y_(x)). 
    We must show that this UBS equals  = (x,Y_a)∪(x,Y_b).
     To this end we have by Proposition <ref>:
     
        __Y_a(x)^+    =    [_x^+∖ D_a^*]∪ D_a,
        __Y_b(x)^+    =    [_x^+∖ D_b^*]∪ D_b,
        __Y_(x)^+    =    [_x^+∖ (D_a^*∪ D_b^*)]∪ (D_a∪ D_b).
    
    Then a standard Venn diagram argument shows that 
    
        _x^+∖__Y_(x)^+    =    _x^+∖( [_x^+∖ (D_a^*∪ D_b^*)]∪ (D_a∪ D_b)
        )
        
           =   ( _x^+∩ (D_a^*∪ D_b^*) ) ∖(D_a∪ D_b).
    
    The set of hyperplanes on the left-hand side is (x, _Y_(x)), while the set of hyperplanes on the right-hand side is (x,Y_a)∪(x,Y_b).
    
     Suppose that (α)∪(β) is commensurate with a UBS.  Then d_T(a,b)≤π/2.
    
    We will show that π/2 is an upper bound on the Alexandrov angle between rays representing a,b based at an arbitrary point, and then 
    use (<ref>).  The bound will be produced by finding a convex subspace, 
    isometric to a Euclidean cube, which has one corner at the basepoint and which contains nontrivial initial segments of the 
    rays.
    
    Angle bound at a vertex:  Let y∈ X be an arbitrary vertex.  Let α',β' be CAT(0) geodesic rays 
    emanating from y and representing a,b respectively (so, α is asymptotic to α' and β is asymptotic to 
    β').  Let =(α)∪(β), and let '=(α')∪𝒲(β').  Then  is commensurate to ', and hence commensurate to a UBS.  
    Lemma <ref> then implies that ' is actually a UBS.
    
    Now let X_y⊂ X be the cubical convex hull of α'∪β'.  Then the set of hyperplanes crossing X_y is 
    exactly '.  Moreover, by Lemma <ref>, there exists a point y̅ in the Roller boundary 
    such that ' is precisely the set of hyperplanes separating y from y̅.
    
    Let ◃ be the partial order on ' defined by declaring that ĥ◃ĥ' if the hyperplane ĥ 
    separates y from ĥ'.  Since every hyperplane of X_y separates y from y̅, any hyperplanes ĥ,ĥ'∈' are either ◃–comparable, or they cross.
    
    Note that if ĥ∈' is dual to a 1–cube of X_y incident to y, then ĥ is ◃–minimal.  
    Hence the set '_min of ◃–minimal hyperplanes is nonempty. Since ◃–incomparable hyperplanes cross, '_min is a 
    set of pairwise-crossing hyperplanes of X.  Since X_y is convex and every hyperplane in ' crosses X_y, we 
    have a cube C ⊂ X_y such that the hyperplanes crossing C are exactly those in '_min.
    
    Note y∈ C.  Also note that any cube C' of X_y with y∈ C' satisfies C'⊂ C.  Thus any nontrivial 
    CAT(0) geodesic segment in X_y emanating from y has a nontrivial initial subsegment  lying in C.  In 
    particular, α' and β' have nontrivial initial segments lying in C.  Since the ambient CAT(0) metric restricts 
    to the Euclidean metric on the cube C, the Alexandrov angle made by α',β' at y satisfies
    
        ∠_y(α',β')=lim_t,t'→0∠_y(α'(t),β'(t))≤π/2,
    
    because any two segments in a cube emanating from a common corner make an angle at most π/2.
    
    Angle bound at arbitrary points:  We now bound the angle made by rays representing a,b and emanating from 
    non-vertex points, by an identical argument taking place in an appropriate cubical subdivision of X.  Let y∈ X be an 
    arbitrary point.  Perform a cubical subdivision of X to obtain a CAT(0) cuboid complex X' in which y is a vertex, so that
    the CAT(0) cuboid metric coincides with the original metric on X.  
    
    More precisely, for each hyperplane ĥ, identify its carrier with ĥ×[-1/2,1/2].  For each ĥ 
    such that y∈ĥ×(-1/2,1/2), let ϵ_ĥ be such that y∈ĥ×{ϵ_ĥ}.  The (geodesically convex) subspace ĥ×{ϵ_ĥ} has a natural cubical structure with an n–cube 
    for each (n+1)–cube intersecting ĥ.  We subdivide X so that the cubes of ĥ×{ϵ_ĥ} are 
    subdivided cubes whose edges are segments in X whose lengths are inherited from X.  The result is a cuboid complex X' such that 
    the identity map X→ X' is an isometry in the CAT(0) metric, preserves the median, and sends y to a vertex.  Since the 
    hyperplanes of X' are parallel copies of hyperplanes of X, the set of hyperplanes of X' that cross α∪β 
    continues to be a UBS, so Lemma <ref> still applies. (Compare Remark <ref>.) We can thus argue exactly as before to see that 
    ∠_y(α',β')≤π/2.
    
    Conclusion:  We have shown that, for all y∈ X, letting α',β' be the rays based at y and 
    representing a,b respectively, we have ∠_y(α',β')≤π/2.  Taking the supremum over all y∈ X, as in (<ref>), we see 
    that the angular metric satisfies ∠_T(a,b)≤π/2.  Now, 
    Definition <ref> gives _T(a,b)≤π/2, as required.
    
    Lemmas <ref> and <ref> extend immediately to the cuboid setting, because they use only hyperplane combinatorics and prior lemmas. The above proof of 
    Lemma <ref> also extends to cuboids, because it uses prior lemmas combined with CAT(0) geometry. Indeed, the above argument uses cuboids in combination 
    with Remark <ref> to prove the desired angle bound for arbitrary basepoints in X. The key conceptual reason why the argument works for cuboids is that every pair of geodesic segments 
    in a cuboid,  emanating from a corner, meets at angle at most π/2. 
    
    The reliance on cuboids to prove the desired result for cubes can be avoided, as follows. First, prove the angle bound at a vertex of X, exactly as above. Then, let X' be the cubical subdivision 
    of X, and observe that the CAT(0) geodesics in X' are exactly the same as those in X. (See e.g. <cit.>.) Thus the same argument proves the angle bound at 
    every vertex of X'. 
    
    Continuing to subdivide by induction, we obtain a set V_∞⊂ X of points that are vertices of the subdivision at some (and hence all subsequent) stages.  Note that V_∞ intersects 
    each of the original cubes of X in a dense subset, and in particular contains all the original vertices.  The desired angle bound holds when the rays in question are based at any point in 
    V_∞.  Now, fixing a,b∈ X, we can consider the function x↦∠_x(α,β), where α,β are the rays representing a,b and starting at x.  This function need 
    not be continuous on X (it is upper semicontinuous <cit.>), but it can be shown to be continuous on each open cube of X (of any dimension).  Since it is 
    bounded above by π/2 on a dense subset of each such cube, we conclude that sup_x∠_x(α,β)=∠_T(a,b)≤π/2.
    
    Finally, observe that the statement and proof of Lemma <ref> fail completely if we modify the angles of the cubes, precisely because two segments emanating from a vertex of a parallelogram might meet at a large angle.
    
    
    
    Our main goal in this section is to show that if α,β are geodesic rays with common initial point, and (α)∪(β) is a UBS, then any 
    geodesic ray γ representing an interior point on the Tits geodesic from α(∞) to β(∞) must cross all the hyperplanes in (α)∪(β).  Before proving this in Proposition <ref>, we will need a few auxiliary results,  starting with a corollary of Lemma <ref>.
    
    
    
    
    Suppose that = (α)∪(β) is a UBS. Let Y be the cubical convex hull of α∪β. Let γ [0,∞)→ X be a CAT(0) geodesic ray with γ(0)=α(0)=β(0).  Suppose that γ is contained in Y and crosses every dominant hyperplane in .  Then γ crosses every 
    hyperplane in .
    
    This follows immediately from 
    Lemma <ref>.<ref> applied to = (Y).
    
    
    Next, we study angles at which rays cross dominant hyperplanes. 
    
    
     Let α be a CAT(0) geodesic ray with α(0)∈ 
    X^(0).  Then there exists κ>0 such that the following holds.  Let 𝒟_d,⋯,𝒟_k⊂(α) be the dominant minimal UBSes provided by applying Lemma <ref> to 𝒲(α), and let i∈{d,…,k}.  Then 𝒟_i contains a chain {û_n}_n≥0 of hyperplanes such 
    that 𝒟_i is commensurate with the inseparable closure of {û_n}_n≥ 0, and 
    
        ∠_y_n(α,û_n)≥κ
    
    for all n≥ 0, where y_n is the point α∩û_n.
    
    Recall from Lemma <ref> that (α) is a pruned UBS. Thus Lemma <ref> applies to (α).
    
    Now, fix i∈{d,…,k}.  
    Lemma <ref> says that 𝒟_i={ĥ_m}_m≥0, where
    each ĥ_m is dominant. This means each ĥ_m crosses all but finitely many hyperplanes in 𝒲(α) ∖𝒟_i.  
    
    The divergence f(t) of α from ĥ_0:  Define f(t) = _X(α(t),ĥ_0), and 
    let T_0 = α^-1(ĥ_0). By Lemma <ref>.<ref>, there is a constant A_0 > 0 (depending on ĥ_0 but not s,t) such that
    
        f(t)-f(s) ≥ A_0·(t-s)
    
    for all T_0≤ s≤ t.
    
    Hyperplane count:  We wish to produce a constant C such that any length–C subpath of α 
    crosses an element of 𝒟_i.
    
    Let s_0≥ T_0 be sufficiently large that α([0,s_0)) crosses all of the finitely many hyperplanes in 𝒲(α) ∖𝒟_i not crossing ĥ_0.  Suppose that s_0≤ s≤ t.  Then all hyperplanes crossing α([s,t]) either cross ĥ_0 or belong to 𝒟_i.  
    Assume that α([s,t]) does not cross any element of 𝒟_i.  
    
    Let H_st = (α([s,t])) denote the cubical convex hull of α([s,t]).  There may be hyperplanes crossing H_st that do not cross α([s,t]), because α(s),α(t) need 
    not be vertices. However, we can bound the number of such hyperplanes as follows.  Let 𝒲_bad⊂𝒲(H_st)⊂𝒲(α) be the set of hyperplanes 
    that cross H_st but do not cross 
    α([s,t]).  Note that 𝒲(H_st) inherits a partial order from 𝒲(α), by restricting the partial order ◃ from the proof of 
    Lemma <ref>.  
    Suppose that ĥ∈𝒲(H_st) is neither ◃–maximal nor ◃–minimal in 𝒲(H_st).  Then there exist û,v̂∈𝒲(H_st) such that 
    ĥ separates û from v̂.  By the definition of the convex hull, ĥ cannot separate û or v̂ from α([s,t]), so ĥ must cross α([s,t]).  Thus 
    every hyperplane in 𝒲_bad is ◃–minimal or ◃–maximal.  Since incomparable hyperplanes have to cross, we conclude that |𝒲_bad|≤ 
    2(X), hence there are at most D=2 X hyperplanes that cross H_st but not α([s,t]).
    The rest of the 
    hyperplanes crossing H_st must cross ĥ_0, since they cross α([s,t]), and we have chosen s ≥ s_0 and assumed 𝒲(α([s,t]))∩𝒟_i=∅.
    
     
     
    Consider the CAT(0) closest-point projections p  X→ĥ_0 and q  X→ H_st.
    By <cit.>,  the d_X–convex hull of p(H_st)∪ 
    q(ĥ_0) is isometric to p(H_st)× [0,_X(ĥ_0,H_st)], where p(H_st)  is identified with p(H_st) ×{ 0 }, and q(ĥ_0) is identified with p(H_st) ×{_X(ĥ_0,H_st)}.
    By <cit.>, the hyperplanes that cross q(ĥ_0) are precisely those that 
    cross ĥ_0 and H_st.  So, there are at most D hyperplanes crossing H_st but not q(ĥ_0).  By 
    Lemma <ref>, the points α(s),α(t) are thus both within distance λ_0D+λ_1 of 
    points in q(ĥ_0), where λ_0D+λ_1 depends only on D. Thus
    
        _X(α(t),ĥ_0)  ≤ λ_0D+λ_1+_X(H_st,ĥ_0)  ≤ λ_0 D+λ_1+_X(α(s),ĥ_0).
      In other words, since  s,t≥ s_0 ≥ T_0, we have shown
    
        A_0(t-s) ≤ f(t)-f(s)≤λ_0D+λ_1.
    
    Thus, for any 0≤ s≤ t (without assuming s ≥ s_0), we get 
    
        t-s≤λ_0D+λ_1/A_0+ s_0.
    
    
    
    Letting C=  λ_0 D+λ_1/A_0 + s_0+1, we have shown that any subsegment of α of 
    length at least C crosses an element of 𝒟_i.  
    
    Hence, for any 0≤ s≤ t, we have that α([s,t]) 
    crosses at least ⌊ (t-s)/C⌋ elements of 𝒟_i.  
    
    Big angle hyperplanes:  Let σ be a subsegment of α.  Consider the hyperplanes in 𝒟_i 
    crossing σ.  Any two such hyperplanes are either disjoint or not, and any collection of pairwise crossing 
    hyperplanes has size at most X.  So, if there are more than (3, X+1) hyperplanes in 𝒟_i crossing σ, then there are 
    three disjoint such hyperplanes, where ( ·, ·) denotes the Ramsey number.  Hence, if σ has length |σ|=C·(3, X+1)+1, 
    then σ crosses three disjoint hyperplanes û,v̂,ŵ∈𝒟_i.  Without loss of generality, 
    say v̂ separates û,ŵ.  Hence α∩ N(v̂) is a subpath of α lying between the points 
    α∩û and α∩ŵ∈σ, so 
    
        |α∩ N(v̂)|≤ C·(3, X+1)+1=L.
    
    Note that L is independent of the hyperplane v̂. Indeed, L depends on A_0,λ_0,λ_1,s_0, and hence is determined by X, the hyperplane ĥ_0 and the geodesic α.  
    Now, using the fact that N(v̂) is isometric to a product
     of the form v̂×(-1/2,1/2), we see that
    
        ∠_α∩v̂(v̂,α)≥sin^-1(1L),
    
    which we denote by κ.  
    
    Since we can do the above procedure for infinitely many disjoint length–L segments in α, we find infinitely many 
    hyperplanes in 𝒟_i making an angle at least κ with α.  Since any infinite subset of a UBS contains 
    a chain, we thus have a chain {û_n}_n≥ 0⊂𝒟_i with this property.  Finally, the inseparable 
    closure of {û_n}_n≥ 0 is a UBS contained in 𝒟_i, and hence commensurate with 𝒟_i since 
    𝒟_i is minimal.  This verifies the statement for the given 𝒟_i, and we conclude by replacing κ 
    with the minimal κ for the various i∈{d,…,k}.
    
    Extending Lemma <ref> to a cuboid metric d_X^ρ requires a bit of care. The above proof relies on 
     some results of of Huang <cit.>, which are written in the context of a cube complex with finitely many isometry types of cells. This hypothesis may fail in (X, d_X^ρ). 
    Fortunately, we only need to use Huang's results in a finite cuboid complex, namely the convex hull of H_st∪ p(H_st), where H_st is itself finite and p is a certain CAT(0) 
    projection. Thus Huang's results <cit.> apply to the subcomplex we need. 
     
    Some constants in the proof would need to be adjusted for the cuboid metric.  The constants λ_0, λ_1 of Lemma <ref>, used in the definition of C, would have to be replaced 
    by the constants λ_0^ρ, λ_1^ρ of Lemma <ref>. 
    In the constant sin^-1(1/L), the numerator 1 is the thickness of a hyperplane carrier, and would have to be replaced by the minimal thickness of a hyperplane carrier in  the metric 
    d_X^ρ.
    
    
    Now we can prove the main result of this section.
    
    
    
    Let α, β be CAT(0) geodesic rays with α(0) = β(0) ∈ X^(0).
    Suppose that (α)∪(β) is commensurate 
    with a UBS.  Then a=α(∞) and b=β(∞) are joined by a unique geodesic 
    g in X. Furthermore, any interior point c of g is represented by a CAT(0) geodesic ray γ 
    such that (γ)  = (α)∪(β).
    
     By Lemma <ref>, we have 
    _T(a,b)≤π/2, so the CAT(1) space X contains a 
    unique geodesic g from a to b.  This proves the first assertion of the lemma. 
    
    Let c ∈ X be an interior point of g.  Let γ be the unique CAT(0) geodesic ray starting at α(0) and 
    representing c.  We need to show that (γ)=𝒲(α)∪(β). 
    
    Working in the convex hull of α∪β:  Let Y be the 
    cubical convex hull of α∪β. We claim that g lies in Y⊂ X.  Indeed, 
    applying Lemma <ref> inside of Y shows that a,b can be joined by a unique geodesic g' in 
    Y.  Since the Tits distance in Y from a to b depends only on {_Y(α(t),β(t)):t≥ 0} and 
    _Y(α(t),β(t))=_X(α(t),β(t)) by convexity of Y, we have that g' is a geodesic of X.   Since 
    g' has length less than π, it is the unique geodesic in X from a to b, i.e. g=g' and g lies in Y. 
    
    For the rest of the proof, we work entirely in Y.
    
    For any y∈ Y, we can choose rays α_y,β_y with α_y(0)=β_y(0)=y and α_y(∞)=a,β_y(∞)=b, and note that the cubical convex hull Y_y of 
    α_y∪β_y is contained in Y, and crosses all but finitely many of the hyperplanes crossing Y.  By convexity, Y_y= Y.  So, when convenient, we can move the basepoint.
    
    What we will actually verify:  The plan is as follows.  Let ĥ be a hyperplane of Y that is dominant in the UBS = (Y) = (α) ∪(β).  We will show that c∉ĥ.  Since the 
    shallow side of any hyperplane in Y is contained in a neighborhood of that hyperplane, it follows that γ must cross ĥ.  Once we show that γ crosses every dominant hyperplane, 
    Corollary <ref> will then imply that γ crosses every hyperplane, i.e. (γ)=(α)∪(β), as required.  So, it remains to argue that 
    c∉ĥ when ĥ is a dominant hyperplane.
    
    Initial segments of α and β inside a cube:  For each r≥ 0, let y_r=α(r).  Let α_y_r and β_y_r be geodesics asymptotic to α and β, defined as above.  Note that Y_y_r⊂ Y 
    contains a ray based at y_r and representing each element of Y.  As in the proof of Lemma <ref>, there is a single cube C_y_r⊂ Y_y_r, with y_r∈ 
    C_y_r, such that any ray in Y_y_r emanating from y_r has a nontrivial initial segment in C_y_r.  
    
    Let α'_y_r,β'_y_r,γ'_y_r be the maximal (nontrivial) segments of α_y_r,β_y_r,γ_y_r that lie in C_y_r.  Then the Alexandrov angle between any two of the rays 
    α_y_r,β_y_r,γ_y_r at y_r is just the Euclidean angle in C_y_r between the corresponding segments.
    
    By <cit.>, ∠_y_r(α_y_r,β_y_r) converges to ∠_T(a,b) = _T(a,b), where the equality follows from
    Lemma <ref> because the distance is less than π.
    
    Angle computation:  Let ĥ be a dominant hyperplane in .  By Lemma <ref>,  we 
    can assume that ĥ∈𝒟, where 𝒟 = 𝒟_j is a minimal UBS consisting of dominant hyperplanes. Since 𝒟⊂(α) ∪(β) is a minimal UBS, we must have either 𝒟≼(α) or 𝒟≼(β). We assume without loss of generality that 𝒟≼(α).
    
    
    Note that every hyperplane in 𝒟 is dominant in (α), because any hyperplane crossing all but 
    finitely many hyperplanes in ∖𝒟 crosses all but finitely many hyperplanes in 𝒲(α) ∖𝒟.  We now apply Lemma <ref> to (α) and 𝒟 to produce 
    a constant κ and a chain  {ĥ_n }⊂𝒟 whose inseparable closure is 𝒟 and whose (necessarily dominant) 
    hyperplanes all cross α at an angle at least κ:
    
        ∠_y_n(α_y_n,ĥ_n)≥κ,
    
    where y_n=ĥ_n∩α and 
    α_y_n is the sub-ray of α emanating from y_n.  
    Since all but finitely many of the ĥ_n lie on the deep side of ĥ, it suffices to show that γ crosses ĥ_n for sufficiently large n. As explained above, it suffices to show that c ∉ĥ_n for sufficiently large n.
    
    
    Let β_y_n be the ray emanating from y_n and 
    asymptotic to β.  
    Working in the cube C_y_n constructed above, we have that the segment α_y_n' makes a Euclidean angle at least κ with the midcube M_n = C_y_n∩ĥ_n.  Meanwhile, 
    the segment β_y_n' makes some angle θ≥ 0 with M_n.  
    See Figure <ref>.
    
    Let s∈(0,1) be such that _T(a,c)=s·_T(a,b) and _T(c,b)=(1-s)·_T(a,b).  Such an s exists since c is an interior point of the Tits geodesic g from a to b.
    
    
    
    
    Let η_n ⊂ C_y_n be the maximal segment that emanates from y_n and makes an angle s·∠_y_n(α_y_n',β_y_n') with α_y_n' and and 
    angle (1-s)·∠_y_n(α_y_n',β_y_n') with β_y_n'.  Then there exists κ_1= (1-s) κ >0 such that ∠_y_n(η_n,
    M_n) ≥κ_1. Crucially, κ_1 is  independent of n.  On the other hand, as 
    n →∞, we have convergent sequences
    
        ∠_y_n (α_y_n',β_y_n')    →_T(a,b), 
        ∠_y_n (α_y_n',γ_y_n')    →_T(a,c) = s ·_T(a,b), 
        ∠_y_n (β_y_n',γ_y_n')    →_T(b,c) = (1-s) ·_T(a,b),
    
    Thus,  for all sufficiently large n, 
    
        ∠_y_n(η_n,γ_y_n')<κ_1/2,
    
    so by the triangle inequality for Alexandrov angles, ∠_y_n(γ'_n,M_n) > κ_1/2 >0.  Hence the ray γ_y_n is not contained in ĥ_n and, since its initial 
    point is in ĥ_n, we thus have c∉ĥ_n.  This completes the proof.
    
    
    
    
    We observe that the proof of Proposition <ref> extends to the cuboid setting with minimal effort. The proof of that lemma combines prior results and the local Euclidean geometry of a 
    cube; all of the local arguments work equally well in a rescaled cuboid. 
    
    
    
    § CONNECTIONS BETWEEN TITS AND ROLLER BOUNDARIES
    
    
    
    In this section, we establish some important connections between X and X. Every Roller class v ∈ X is assigned a 
    canonical CAT(1)–convex  Tits boundary realizationQ(v) ⊂ X.
    We define a pair of maps ψ X → X and φ X → X  that will play a major role in the proof of our main theorem. See Proposition <ref> for the properties of Q(v) and Proposition <ref> for  the relationship between φ and ψ. 
    
    Toward the end of this section, we focus on ℓ^2–visible Roller classes, namely all v ∈ X
     such that ψ∘φ(v) = v. 
    In Section <ref>, we will use the visible Roller classes to construct a closed covering of X that is compatible with a covering of a large part of X, denoted X.
    
    All of the results of this section extend with minimal effort to a cuboid metric d_X^ρ obtained via a G–admissible hyperplane rescaling (recall Definitions <ref> and <ref>). This extension is described in Section <ref>.
    
    
    
    Given a ∈ X, define ψ(a) = Y_a ∈ X to be the Roller class Y_a constructed in Lemma <ref>. That is, ψ(a) is the principal Roller class of the  intersection of half-spaces in the deep set  D_a. 
    
    
    
    Our definition of ψ generalizes Guralnik's boundary decomposition map <cit.>, because X agrees as a set with the visual boundary _ X.
    
    
    
    
    
    
    Let a = [α] ∈ X. Let (α) be the UBS consisting of hyperplanes crossing the geodesic α. Then ψ(a) = Y_a = Y_(α).
    
    By Lemma <ref> we have that D_a= _Ỹ_a^+ and Y_a ∈ X. Fix x∈ X^(0). By definition,  D_a∖_x^+ = (x,Y_a) =  (x,[y]) for any y ∈ Y_a. Finally by  Lemma  <ref>(x,[y])∼(x,y). 
    
    By Lemma <ref>, there is a combinatorial geodesic α'  [0,∞) → X with α'(0) = x and α'(∞) =  y.  By Remark <ref>, we have (α')= (x,y). 
    
    Now, Lemma <ref> implies that α and α' can be chosen to lie at finite Hausdorff distance. Thus α and α' cross the same hyperplanes, 
    except possibly for 
    finitely many. In symbols,
     (α') ∼(α). By Lemma <ref>, we conclude that Y_a = Y_(α).
    
    
     §.§ Tits boundary realizations
    
    Defining a map φ X → X that serves as a partial inverse to ψ takes considerably more effort. As a first step, we will define a Tits boundary realizationQ(v) associated to a Roller class v.
    
    A family ℱ of subsets of X is called filtering if for every E,F∈ℱ there is a D∈ℱ such that D⊂ E∩ F. For example, for y∈ X,  the family 
    
        ℱ :={(h_1)∩⋯∩(h_n)   :   h_1, …, h_n∈_y^+, n∈}
     
    is a filtering family of closed convex subspaces. 
    
    The following theorem combines results of Caprace–Lytchak <cit.> and Balser–Lytchak <cit.>.
    
    
    Let {X_i}_i∈ I be a filtering family of closed convex subsets of a finite-dimensional CAT(0) space X. If the 
    intersection ⋂_i∈ I X_i is empty, then the intersection ⋂_i∈ I X_i of their 
    boundaries is nonempty, and furthermore ⋂_i∈ I X_i has intrinsic radius at most π/2 and therefore a canonical circumcenter.  
    
    
    Next, we present two definitions that will turn out to be equivalent (compare Lemma <ref>). The first of these definitions appears in <cit.>.
    
    
    Let y∈ X. Define Q(y)=⋂_h∈_y^+(h). Note that Q(y) ≠∅ by Theorem <ref>.
    We call Q(y) the Tits boundary realization of y.
    
    Let x∈ X^(0) and let y∈ X.    Recall that (x,y)⊂X̃ is the vertex interval between x and y, so 
    that (x,y)∩ X is a vertex–convex subset of X^(0).  Generalizing Definition <ref>, let (x,y) be the union of all of the cubes in X 
    whose 0–skeleta lie in (x,y)∩ X.
    Then (x,y) is a convex subcomplex of X, 
    and hence has a well-defined Tits boundary naturally embedded in X.  We define  Q'(y)=(x,y).
    
    
    In fact, the two definitions are equivalent: 
    
    
    Let y∈ X and let x,x'∈ X^(0).  Then:
    
      * (x,y)=(x',y), 
    hence Q'(y) is well-defined.
     
      * Q(y)=Q'(y).
     
      *  If y∼ y', then Q'(y)=Q'(y') and Q(y)=Q(y').
    
     To prove conclusion <ref>, observe that (x,y) and (x',y) lie at 
    Hausdorff distance bounded by _1(x,x'). Hence (x,y) and (x',y) have the same 
    Tits boundary.
    
    
    Next, we consider conclusion <ref>.  For any given vertex half-space h∈_y^+, 
    let (h) be the 
    associated CAT(0) half-space containing y.  By <ref>, we can assume that x∈(h).  
    Hence (x,y)⊂(h), so Q'(y)=(x,y)⊂(h). Therefore Q'(y)⊂ Q(y).
    
    For the reverse inclusion, suppose q∉ Q'(y).  Then there is a CAT(0) half-space (h) such that 𝒥(x,y) ⊂(h) and q ∉(h). (To find such a half-space, let γ be any CAT(0) geodesic ray 
    representing q. Since γ leaves every finite neighborhood of (x,y), it must cross a hyperplane ĥ 
    disjoint from (x,y).) The associated vertex half-space h satisfies h∈_y^+ but q ∉(h). By Definition <ref>, it follows that q ∉ Q(y).  Hence Q(y)⊂ Q'(y).
    
    Finally, consider conclusion <ref>. If y ∼ y', the Hausdorff distance from 
    (x,y) to (x,y') is bounded by _1(y,y') < ∞. Using <ref>, we obtain
    
        Q(y) = Q'(y) = (x,y) = (x,y') = Q'(y') = Q(y').
    
    
    
    Following Theorem <ref> and Lemma <ref>, we can make the following definition.
    
    
    Let v ∈ X be a Roller class. Define Q(v) = Q(y) for any representative element y ∈ v.  
    The reader can think of Q(y) according to either Definition <ref> or Definition <ref>.  We call
     Q(v) the Tits boundary realization of the Roller class v.
     
    Observe that the collection of half-spaces ℌ_y^+ containing y has empty intersection in X. Thus, by  Theorem <ref>, 
    Q(v)  has a canonical circumcenter. We define χ(v) ∈ X to be the circumcenter of Q(v). 
    
    For every v ∈ X and every g ∈(X), we have Q(gv) = gQ(v) and (gv) = g (v). Furthermore, Q(v) and Q(gv) have the same intrinsic radius.
    
    Let y∈ X, and let v=[y]. Then, for every h ∈_y^+, the map g gives an isometry from (h)  to (gh). Thus g  Q(v) → Q(gv) is an isometry, hence Q(v) and Q(gv) have the same intrinsic radius. By Theorem <ref>, (v) and (gv) are uniquely determined by the geometry of Q(v) and Q(gv), respectively, hence (gv) = g (v).
    
    
    
    Consider a Roller class v∈ X. We say that a combinatorial geodesic  ray γ in Xrepresentsv if 
    γ(∞) = y ∈ v, or equivalently if 
    the UBS (γ) represents the class v.   Setting x = γ(0), observe that (x,y) is the 
    cubical convex hull of γ, and (γ) = (x,y) is exactly the collection of hyperplanes crossing 
    (x,y). This leads to
    
    
    
    Let v∈ X be a Roller class and let a∈ Q(v).  Then ψ(a)≤ v.  
    
    Let γ be a combinatorial geodesic ray representing v, with γ(0) = x and  γ(∞) = y ∈ v. Then  
    the cubical convex hull of γ, namely (x,y), is also CAT(0) geodesically convex. Since a∈ Q(v) = 𝒥(x,y) by Lemma <ref>,
    we may choose a CAT(0) geodesic α  representing a such that α⊂(x,y).  Then (α) 
    ⊂(γ) = (x,y).  Thus every hyperplane crossing α crosses (x,y) and hence γ.   
    Hence ψ(a)≤ v.
    
    In Definition <ref>, we will define a map φ X→ X with the property that φ(v)∈ Q(v) for each Roller 
    class v. This map will be defined by slightly perturbing the circumcenter (v).  In view of Lemma <ref>, we 
    will have ψ(φ(v))≤ v.
    
    Let v,w∈ X satisfy w≤ v.  Then Q(w)⊂ Q(v).
    
    Fix a basepoint x_0∈ X^(0) and let γ_v,γ_w be combinatorial geodesic rays emanating from x_0 and 
    representing v,w respectively.  Since w≤ v, Theorem <ref>.<ref> says that 𝒲(γ_w)≼(γ_v).  Without moving x_0, we can replace γ_w by its image under the gate map to the 
    cubical convex hull of γ_v, 
    ensuring that 𝒲(γ_w)⊂(γ_v).  Hence, setting y_w = γ_w(∞) ∈ w and y_v = γ_v(∞) ∈ v, the 
    cubical convex hulls of these geodesics satisfy (x_0,y_w)⊂(x_0,y_v).  Taking 
    boundaries and applying Lemma <ref> gives  Q(w)⊂ 
    Q(v).
    
    
     §.§ Diameter, intrinsic radius, and Tits-convexity of Q(v)
    
    Let v ∈ X be a Roller class. Recall that Q(v) is the intersection of the Tits boundaries of the half-spaces corresponding to a representative element of v. We will need the following properties of  Q(v):
    
    
    For any Roller class v, the Tits boundary realization Q(v) has the following properties:
    
      * Q(v) has diameter at most π/2.
         
      * Q(v) is Tits–convex.
         
      * Q(v) is contractible in the Tits metric topology and compact in the visual topology.
         
      * Q(v) has intrinsic radius r_v<π/2. 
         
      * Q(v) ⊂B̃_T((v), r_v).
    
     Let v be an arbitrary Roller class and x_0 ∈ X^(0) an arbitrary basepoint. Let γ be a combinatorial geodesic ray based at x_0 and representing v. Let H= H(x_0,v,γ) denote the cubical convex hull of γ. Then, for an arbitrary point y ∈ [y] = v, the cubical hull H and the interval (x_0, y) lie within bounded Hausdorff distance of each other.  Thus, by 
    Lemma <ref>, Q(v) is equal to the closed subset H  = (x_0, y) ⊂ X.
    
     Diameter: 
    To bound _T(Q(v)), let a,b∈ 
    Q(v).  Represent a,b by CAT(0) rays α,β with initial point x_0. Note that α, β⊂ H because H is a convex subcomplex.  Then (α),(β) 
    are both subsets of (γ), which is a UBS representing v.  So, 𝒲(α)∪(β) ⊂(γ).  Now, (α)∪(β) is 
    infinite.  Moreover, (α)∪(β) is unidirectional and contains no facing triple, since (γ) has those properties.  Thus 𝒲(α)∪(β) is a UBS, hence Lemma <ref> 
    implies _T(a,b)≤π/2.
    
    Convexity:  Since H=H(x_0,v,γ)↪ X is an isometric embedding in the CAT(0) 
    metric, the 
    inclusion H=Q(v)↪ X is a Tits-metric isometric embedding.  Indeed, let a,b∈ 
    Q(v) be represented by CAT(0) rays α,β⊂ H with initial point x_0. Since 
    Q(v) has diameter less than π, we have _T(a,b)=∠(a,b) by  
    <cit.>.  
    Since α, β⊂ H, the angle ∠_T(a,b) is 
    determined entirely by 
    the set {_X(α(t),β(t))}_t≥ 0, by <cit.>).  By convexity of H, this set coincides with 
    {_H(α(t),β(t))}_t≥ 0.  Hence the Tits distance from a to b measured in X 
    is the same 
    as the Tits distance measured in H=Q(v).
    
    Now, Q(v) contains a unique geodesic joining a,b.  Since this geodesic realizes 
    the distance from a to 
    b in X, this shows that Q(v) is Tits-convex.
    
    Intrinsic radius:  Since Q(v) is a CAT(1) space of 
    diameter less than π, the intrinsic radius r_v satisfies r_v<diam Q(v), by <cit.>.  Since diam Q(v)≤π/2, we have r_v<π/2, proving 
    assertion <ref>.  
    Now, observe that Q(v) ⊂B̃_T((v), r_v) by Definition <ref> and Theorem <ref>, proving <ref>.
    
    Topological properties:  Since Q(v) is a uniquely geodesic CAT(1) space, a standard straight-line homotopy allows one to deformation retract Q(v) to 
    a single point. Thus Q(v) is contractible.
    
    Finally, recall from Lemma <ref> (and from earlier in this proof) that Q(v) = (x_0,y) for an arbitrary point  
    y ∈ [y] = v.  By Lemma <ref>, the subcomplex (x_0, y) is proper, hence Q(v) is compact in the visual topology.  (The visual topology is defined in <cit.>, where it is called the cone topology.)
    
    
     §.§ Visibility and perturbing the circumcenter
    
    Recall the (X)–equivariant circumcenter map 
     X → X, mentioned in Corollary <ref>.
    In this subsection, we perturb   to obtain a map φ X→ X with slightly nicer 
    properties.  First, like , the map φ will have the property that φ(v)∈ Q(v) for each Roller class 
    v, and hence ψ(φ(v))≤ v.  Compare Remark <ref>.
    
    We will define φ so that Roller classes v for which ψ(φ(v))=v are exactly those for which there is some 
    CAT(0) geodesic ray representing v. (Note that a combinatorial geodesic exists for every v, but a CAT(0) geodesic is not guaranteed.) Later, we will work with only such Roller classes, which we term 
    ℓ^2–visible; see Definition <ref>. 
    See also Lemma <ref> for several equivalent characterizations of visibility. While the map φ is not guaranteed to be equivariant, the set of ℓ^2–visible Roller classes 
    will still be invariant.
    
    The following example illustrates the point that (v) can lie in Q(w)⊊ Q(v) for some w<v. 
    
    
    Consider the cone of ℝ^3 cut out by the planes z=0, z=y, and z=x, and let X be the union of all cubes (in the standard cubical tiling of ℝ^3) contained in this cone. Then X has four classes, described in coordinates as u=[(∞, 0, 0)], u'=[(0, ∞, 0)], w = [(∞, ∞, 0)], and v = [(∞, ∞, ∞)], all of which are represented by ℓ^2 geodesic rays. Furthermore, Q(v) = Q(∞, ∞, ∞) =  X is isometric to an isosceles triangle of S^2 whose base has length π/2 and whose height is arctan(1/√(2)). The base of the triangle is Q(w) = Q(∞, ∞, 0).
    See Figure <ref>.
    
    
    
    
    First, observe that (w) is the midpoint of the geodesic segment Q(w). Next, we claim that (v) = (w). To see this, let β be the altitude from (w) to the the apex of Q(v). Because Q(v) has a reflective symmetry in β, its circumcenter must be contained in β. In addition, since len(β) = arctan(1/√(2)) < π/4, any point b ∈β must have distance less than π/4 to the apex but distance at least π/4 to the two endpoints of Q(w). Thus (w) = (v) even though w<v and Q(w)⊊ Q(v).
    
    
    The
    phenomenon of Example <ref> will be inconvenient later. To remedy this problem, we will define 
    φ(v) by perturbing (v) slightly, to get a point in the interior of Q(v) that retains the property that 
    all of Q(v) is contained in the r_v–neighborhood of φ(v) for some r_v<π/2.  (This latter property will 
    also be necessary later.)
    
    To achieve this, we need some preliminary discussion and lemmas.  
    
    
    
    For every Roller class v,  there is a unique Roller class M_v ∈ψ(Q(v)) that is maximal among all Roller classes in ψ(Q(v)). Furthermore Q(M_v)=Q(v).
    
    If w∈ψ(Q(v)), then w=ψ(a) for some a∈ Q(v), so w≤ v by Lemma <ref>.  
    Since there is a bound on the length of ≤–chains, it follows that ψ(Q(v)) contains ≤–maximal elements.
    
    Suppose that m,m'∈ψ(Q(v)) are ≤–maximal.  Let a,a'∈ Q(v) be such that 
    ψ(a)=m and ψ(a')=m'.  Let α,α' be CAT(0) geodesic rays in X representing a,a' 
    respectively, chosen so that α(0)=α'(0). Then _m ∼(α) and _m'∼(α'). 
     Since m,m'≤ v, Theorem <ref> gives
     𝒲(α) ≼_v and (α') ≼_v, hence
    W(α)∪(α') is commensurate with a UBS by Lemma <ref>. Thus, by Proposition <ref>, there exists 
    a CAT(0) geodesic ray β with (β)  = (α)∪𝒲(α').  By construction, 
    
        m ≤ψ(β(∞))≤ v,      m' ≤ψ(β(∞))≤ v
    
     where the first inequality for m or m' is strict if 
    m≠ m'. So, β(∞)∈ Q(v) by Lemma <ref> and the second inequality.  Hence the 
    first inequality contradicts the maximality of m,m' in ψ(Q(v)), unless m=m'.  This proves 
    the uniqueness of a maximal element M_v.
    
    Next, M_v≤ v, so Q(M_v)⊂ Q(v) by Lemma <ref>.  On the other hand, if a∈ 
    Q(v), then ψ(a)∈ψ(Q(v)), so ψ(a)≤ M_v.  Hence a∈ Q(ψ(a))⊂ Q(M_v) by 
    Lemma <ref>. Thus Q(v)⊂ Q(M_v), and we conclude  that Q(v) = Q(M_v).
    
    
    For a Roller class v, define Q_0(v) = Q(v) ∖⋃_u < M_v Q(u).
    
    
    
    Let v,w be Roller classes, and let a ∈ Q(v). Then a ∈ Q_0(v) if and only if ψ(a)= M_v.
    
    Furthermore, if Q(v) = Q(w), then M_v=M_w and Q_0(v)=Q_0(w).
    
    First, suppose  that a ∈ Q_0(v). Then ψ(a) ≤ M_v by the definition of M_v. If ψ(a) = u < M_v, then a ∈ Q(u), contradicting the definition of Q_0(v). Thus ψ(a) = M_v, as desired.
    
    Conversely, suppose that ψ(a)=M_v.  If a∈ Q(u) for some u<M_v, then 
    ψ(a)≤ u by Lemma <ref>, so ψ(a)<M_v, a contradiction.  Hence a∈ Q_0(v). 
    
    
    Finally, suppose Q(v) = Q(w). Then Lemma <ref> says that M_v = M_w is the unique maximal element of ψ(Q(v)) = ψ(Q(w)).
    Thus, by the above equivalence, Q_0(v)=Q_0(w).
    
    Let v be a Roller class. Then  Q_0(v) contains points arbitrarily close to (v) in the Tits metric. 
    
    By Lemma <ref>, there is a point a ∈ Q(v)  such that ψ(a) = M_v.
    By Lemma <ref>, we have a ∈ Q_0(v).
    Let g be the geodesic in X from a to 
    b = (v).  By Proposition <ref>.(<ref>), g lies in Q(v).
     For any ϵ>0, choose c ∈ g so that 0 < _T(c,(v))<ϵ.  We will show c ∈ Q_0(v).
     
    By Proposition <ref>, the Tits points a,b,c are represented by CAT(0) geodesic rays α, β, γ such that (γ) = (α) ∪(β) ⊃(α). Thus, by Lemma <ref>, we have ψ(c) = Y_(γ)⊂ Y_(α) = ψ(a).
    By Lemma <ref>, we have ψ(c) ≥ψ(a) = M_v, hence ψ(c) = M_v by the maximality of M_v.
    Therefore, c ∈ Q_0(v) by Lemma <ref>.
    
    Let v be a Roller class, and fix Q = Q(v). Let r<π/2 be the intrinsic radius of Q. Using Lemma <ref>, choose p_Q∈ 
    Q_0(v) such that d_T(p_Q,(v))≤π/4 -r/2. We call p_Q the pseudocenter of Q, and denote it φ(v).
    
    Using Lemma <ref>, we ensure that φ(v) = φ(w) = p_Q for every Roller class w such that Q(w) = Q(v) = Q.
    
    
    In the following proposition we collect the facts about the pseudocenter map 
    φ that will be needed later, in conjunction with Lemma <ref> and the definition of 
    φ.
    
    
         The pseudocenter map φ has the following properties.  Let v∈ X.  Then:
         
      * φ(v)∈ Q(v).
      * ψ(φ(v))≤ v.
      * Q(v)=Q(ψ(φ(v))).
      *  If Q(w)=Q(v), then φ(w)=φ(v). 
         Assertion <ref> holds by construction, and, together with Lemma <ref>, implies 
    assertion <ref>.  Since φ(v)∈ Q_0(v), we have ψ(φ(v))=M_v by Lemma <ref>, and Q(v)=Q(M_v) by 
    Lemma <ref>, yielding assertion <ref>.  Assertion <ref> follows from the 
    definition of φ and Lemma <ref>.
    
    
    We can now define (ℓ^2)–visible Roller classes:
    
    
    Let v∈ X.  Then v is ℓ^2–visible if v∈ψ( X). Let 
    (X) = ψ( X) denote the set of visible Roller classes. Observe that (X) stabilizes (X), because the map ψ is (X)–equivariant.
    
    Let v∈ X. Then the following are equivalent:
    
      * v is ℓ^2–visible.
    
      *  There exists a CAT(0) geodesic ray α such that (α) represents v.
    
      * v = M_v.
    
      * v = ψ(φ(v)).
    
    To begin with, we have <ref>⇔<ref> by Lemma <ref>.
    
    For <ref>⇒<ref>,  let α be a CAT(0) geodesic ray such that 𝒲(α) represents v. Let a = α(∞) ∈ X. 
    
    Then, by Lemma <ref>, we have ψ(a) = v.  Now, recall from Lemma <ref> that M_v is 
    maximal among all Roller classes in ψ(Q(v)). By 
    Lemma <ref>, every class w ∈ψ(Q(v)) satisfies w ≤ v, hence M_v ≤ v.  On the other hand, v = 
    ψ(a) ∈ψ(Q(v)), hence v ≤ M_v by the maximality of M_v. Thus v = M_v.
    
    For <ref>⇒<ref>, suppose v = M_v.  By Definition <ref>, we have 
    φ(v) ∈ Q_0(v). Thus, by Lemma <ref>, we have ψ(φ(v)) = M_v = v.
    
    For <ref>⇒<ref>, suppose v = ψ(φ(v)). 
    Then φ(v) ∈ Q_0(v) ⊂ Q(v). 
    Choose a CAT(0) geodesic ray α representing φ(v).   The associated UBS (α) represents the 
    class ψ(φ(v)) = v.
    
    Let v∈ X be a ≤–minimal Roller class.  Then v is ℓ^2–visible.
    
    Lemma <ref> gives v≥ψ(φ(v)).  By 
    minimality of v, we thus have v=ψ(φ(v)).
    
    
     §.§ Cuboid generalization
    
    Here, we explain how to generalize the results of this section to a cuboid metric d_X^ρ. A reader who is only interested in cube complexes with the standard ℓ^1 and ℓ^2 metrics is invited to skip ahead to Section <ref>. 
    
    For the duration of this subsection, fix a G–admissible hyperplane rescaling ρ (Definition <ref>) and the resulting cuboid metric d_X^ρ. Recall that the cuboid Tits boundary ^ρ X = (X, d_X^ρ) was defined in Definition <ref>. All of the constructions and results involving ^ρ X will be invariant under the restricted automorphism group (X^ρ) of Definition <ref>.
    
    To start, we can define a map ψ^ρ^ρ X → X exactly as in Definition <ref>. Generalizing Lemma <ref>, we can characterize ψ^ρ(a) = ψ^ρ([α]) as the principal class of the umbra of a UBS representing a ray α:
    
        ψ^ρ(a) = ψ^ρ([α]) = Y_(α).
    
    This characterization holds because the proof of Lemma <ref> works for ψ^ρ: its proof combines previous lemmas and combinatorial properties of hyperplane sets. 
    
    Now, consider a point y ∈ X. Since (X, d_X^ρ) is a CAT(0) space and the collection of half-spaces _y^+ is a filtering family, we can define the Tits boundary realization Q^ρ(y) exactly as in Definition <ref>. Following Lemma <ref>, whose proof extends to cuboids because cubical half-spaces are convex in d_X^ρ, we learn that the boundary realization Q^ρ(y) is also the boundary of a cubical interval, and depends only on the Roller class v = [y]. Thus we may define a Tits-convex set  Q^ρ(v) and its circumcenter χ^ρ(v), as in Definition <ref>. Following Corollary <ref>, both  Q^ρ(v) and χ^ρ(v) are invariant under the restricted automorphism group  (X^ρ).
    
    The partial order properties of the Tits boundary realization Q(v) that are proved in Lemmas <ref> and  <ref> still hold for Q^ρ(v), because the proofs of those results are essentially combinatorial.
    The features of Q(v) described in  Proposition <ref> also hold for Q^ρ(v), because the proof of the Proposition uses prior results and the convexity of the cubical convex hull of a geodesic ray.
    
    
    Next, Section <ref> contains several results about perturbing the circumcenter (v) ∈ Q(v) to a pseudocenter φ(v). The definition of the pseudocenter φ(v) is enabled by Lemmas <ref>, <ref>, and <ref>. All of these lemmas generalize immediately to the cuboid setting, because their proofs are essentially a top-level assembly of prior results. Thus we may generalize Definition <ref> to define a pseudocenter φ^ρ(v) ∈ Q^ρ(v). This pseudocenter φ^ρ(v) has all of the properties described in Proposition <ref>, because the proof of that proposition merely assembles previously established results.
    
    Finally, Definition <ref> generalizes immediately to define ^ρ(X) = ψ^ρ (^ρ X), the set of Roller classes that are visible after the rescaling ρ. Since ψ^ρ is ^ρ(X)–equivariant, the set ^ρ(X) is ^ρ(X)–equivariant as well. Lemmas <ref> and <ref> generalize immediately to the cuboid setting, because their proofs are top-level assemblies of previous lemmas.
    
    
    
    In Definition <ref>, the set (X) = ψ( X) is defined in terms of the CAT(0) metric on X.  When 
    we change the metric on X using a G–admissible rescaling ρ, there is no a priori reason to expect (X) 
    = ψ( X) to coincide with ^ρ(X) = ψ^ρ (^ρ X).  Instead, our whole argument simply goes 
    through for whichever of (X) or ^ρ(X) we are considering.
    
    In fact, it turns out that (X)=^ρ(X). Since we do not use this fact in any proofs, we only sketch a proof.  Let v∈(X) 
    be a visible Roller class, and let α:[0,∞)→ X be a CAT(0) geodesic ray for the metric _X with 𝒲(α) representing v.  We will produce a geodesic ray β for the CAT(0) metric _X^ρ, satisfying 
    𝒲(α)=𝒲(β), from which it follows that v∈^ρ(X).  This shows 
    (X)⊆^ρ(X), and a symmetric argument gives the reverse inclusion.
    
    Since cubical convexity of subcomplexes is independent of which CAT(0) metric we consider, we assume for convenience that 
    X is the cubical convex hull of α, i.e. 𝒲(α)=𝒲(X).
    
    First, use Lemma <ref> to produce chains {ĥ_n^1}_n,⋯,{ĥ^k_n}_n of dominant 
    hyperplanes such that there exists a constant C≥ 0 with the property that, for all j≤ k, any subpath of α 
    of length at least C crosses ĥ^j_n for some n.  The lemma allows us to choose these to be dominant hyperplanes in 
    the UBS 𝒲(α); therefore, if we construct a _X^ρ–geodesic β that crosses each h_n^j, then 
    by Lemma <ref>, we get 𝒲(α)=𝒲(β).
    
    By admissibility of the rescaling, there exists m≥ 1 such that the identity map (X,_X)→(X,_X^ρ) is 
    m–bilipschitz.  Since X is the convex hull of α and contains no facing triples, Lemma <ref> guarantees properness of 
    (X,_X) and implies properness of (X,_X^ρ).  Thus, letting β_t 
    be the _X^ρ–geodesic from α(0) to α(t), and letting t tend to infinity, the β_t subconverge 
    uniformly on compact sets to a _X^ρ–geodesic β with β(0)=α(0).
    
    Fix j≤ k.  Now, for any t, the hyperplanes crossing β_t are exactly those crossing α([0,t]).  Indeed, 
    any hyperplane separating α(0),α(t) crosses β_t, and any hyperplane crossing β_t does so in a single 
    point (and hence separates α(0),α(t)), since β_t is a _X^ρ–geodesic.  In particular, 
    α([0,t]) crosses h_1^j,…,h_N_t^j, where N_t=⌊ t/C⌋.  Hence β_t crosses the same 
    hyperplanes while having _X^ρ–length at most mt.  From this one deduces the following: there exists L such 
    that for all n, and all sufficiently large t, the path β_t crosses h^1_1,…,h^1_n and intersects each of 
    those carriers in a subpath of length at most L.  In other words, there is a uniform bound on how long each β_t can 
    fellow-travel any of the ĥ_n^j, whence β cannot be parallel to a ray in any ĥ^n_j.  This implies that 
    β must cross ĥ^j_n for all j,n, and hence, as explained above, 𝒲(β)=𝒲(α) and 
    v∈^ρ(X).
    
    Looking ahead to Definition <ref>,  the above argument also shows that (X) = ^ρ(X) for any 
    admissible rescaling ρ. In the next section, we will heavily use (X) to construct open and closed coverings of 
    X, so that the nerves of those coverings can be used to prove homotopy equivalence. In an analogous fashion, we will 
    use ^ρ(X) to construct open and closed coverings of ^ρ X.   One can then apply Lemma <ref> 
    and Lemma <ref> to show that the nerves of the coverings of X coincide with the nerves of the 
    corresponding coverings of ^ρ X, and one can use Lemma <ref> to see that the covering of 
    X coming from visible Roller classes of X coincides with the corresponding covering constructed using 
    visible classes of X^ρ.  However, as we mentioned, the cuboid version of our argument does not rely on this; one 
    instead just substitutes ^ρ(X) for (X) everywhere, and runs all the arguments.     
    
    
    § OPEN AND CLOSED COVERINGS OF X
    
    In this section, we study the closed covering of X by the sets Q(v) corresponding to maximal  ℓ^2–visible Roller classes (see Definition <ref>). Our goal, achieved in Theorem <ref>, is to show that X is homotopy equivalent to the nerve _T of this cover.
    
    
    Let (X) denote the set of Roller classes v such that:
    
      * v is ℓ^2–visible;
         
      *  if w is visible and v≤ w, then w=v.
    
    
    The plan for this section is as follows. We will first show that {Q(v):v∈(X)} is a closed covering of X.  Then, we will thicken each closed set Q(v) to an open set U(v), in 
    such a way that the intersection pattern of the open cover {U(v) :v∈(X) } is the same as that of the closed cover {Q(v):v∈(X)}.  Then we will apply the Nerve Theorem to 
    conclude that X is homotopy equivalent to the nerves of these covers.
    
    The main result of this section is Theorem <ref>. Section <ref> is about the initial closed covering.  Section <ref> describes the thickening procedure. Section <ref> describes how to generalize these results to a cuboid metric d_X^ρ.
    
    
    
    
     §.§ The closed covering
    
    The maximal visible Tits boundary realizations Q(v) provide a closed covering of the Tits boundary. We use this covering to define a nerve, as follows.
    
    
    Let 𝒩_T be the simplicial complex with vertex set  (X), where vertices v_0,…,v_n∈(X) span an n–simplex if and only if ⋂_i=0^nQ(v_i)≠∅.
    
    Let v∈ X.  Then  there exists w∈(X) with φ(v)∈ Q(w).  
    Hence 
    {Q(v):v∈(X)} covers X.
    
    Note that ψ( φ(v)) ∈(X), by Definition <ref>.
    Hence there exists w∈(X) such that ψφ(v) ≤ w.  
    
    By Lemma <ref>, φ(v) ∈ Q(ψφ(v))⊂ Q(w).
    
    Now, given a point a∈ X, we can apply the above argument to v=ψ(a).  Then, for some w∈(X), Lemma <ref> implies
    
        a∈ Q(ψ(a))=Q(ψφψ(a))  ⊂ Q(w) .
    
    Hence {Q(v):v∈(X)} covers 
    X.
    
    Let v,w∈(X).  Then Q(v)=Q(w) if and only if v=w. In particular, the assignment v ↦ Q(v) gives a bijection from (X) to its image.
    
    Suppose Q(v) = Q(w). Then Proposition <ref>.<ref> implies φ(v)=φ(w). By visibility and Lemma <ref>, we have ψφ(v)=v and ψφ(w)=w, hence v=w.
    
    
    Now, Lemmas <ref> and <ref> combine to yield:
    
    𝒩_T is the nerve of the covering of X by the collection of closed sets {Q(v):v∈(X)}.
    
    
     §.§ The open covering
    
    The goal of this subsection is to thicken up the closed sets Q(v) for v ∈(X) to be open sets U(v), such that the 
    intersection pattern of the U(v) is the same as that of the Q(v). This is needed since the Nerve 
    Theorem <ref> works for open covers only.
    
    
    
    Let v,w∈(X) be points such that Q(v)∩ Q(w)=∅. Then
     _T(Q(v),Q(w))> ϵ_0, where ϵ_0 > 0 is a constant depending only on X.
     
    Let a∈ Q(v) and b∈ Q(w).  By definition, a∈ Q(ψ(a)).  Since 
    v≥ψ(a), we have Q(ψ(a))⊂ Q(v) and 
    similarly Q(ψ(b))⊂ Q(w), by Lemma <ref>. Since we have assumed Q(v)∩ Q(w)=∅, it follows that  Q(ψ(a))∩ 
    Q(ψ(b))=∅.
    
    Choose CAT(0) geodesic rays α,β such that 
    α(0)=β(0) ∈ X^(0) and α(∞)=a, β(∞)=b.
    
    Since X is finite-dimensional, Lemma <ref> provides  ℓ^1 geodesic rays 
    α̅, β̅ with common basepoint α(0)=β(0), that lie at 
    uniformly bounded  Hausdorff distance from α,β respectively.
    Note that 
    (α) ∼(α̅) and (β) ∼(β̅).
    
    We claim that (α̅)∩𝒲(β̅) is finite. Suppose not. By Lemma <ref>, Q(ψ(a)) = _α̅, where _α̅ = (α̅(0), α̅(∞))  is the cubical convex hull of α̅. Similarly, 
    Q(ψ(b)) = _β̅.
    
    Since C=_α̅∩_β̅≠∅, we have
    (C) = (α̅)∩(β̅) by Lemma <ref>.<ref>.
    Now _α̅ is a proper CAT(0) space, by Lemma <ref>. Thus C is also a proper CAT(0) space, hence |(C)| = ∞ implies C is unbounded and 
    C is a nonempty subspace of Q(ψ(a)).  Similarly, C is a nonempty subspace of Q(ψ(b)).  Thus C  ⊂ Q(ψ(a)) ∩ Q(ψ(b)) = ∅, a contradiction. This proves the claim.
    
    Since (α) ∼(α̅) and (β) ∼(β̅), we may define
     N = |(α) ∩(β)| < ∞. Recall that α(0) = β(0).
    Then, for all t ≥ 0, we have
    
        | ( α(t) , β(t) ) | ≥ | ( α(t) , α(0))| + |(β(0), β(t) ) | - 2N.
    
    Applying Lemma <ref> to both sides gives
    
        λ_0 · d_X(α(t), β(t) )+ λ_1 ≥(  t/λ_0 - λ_1 ) + (  t/λ_0 - λ_1 ) - 2N = 2t/λ_0 - 2(N + λ_1).
    
    Here, λ_0 ≥ 1 and λ_1 are constants depending only on X. Taking limits gives 
        lim_t→∞_X(α(t),β(t))/2t≥1/λ_0^2.
      
    
    By <cit.>, we thus have  sin(∠_T(a,b)/2)≥1/λ_0^2.  Now,
    
        _T(a,b) ≥∠_T(a,b)  ≥sin^-1(1/λ_0^2) >1/λ_0^2.
      
    Setting  ϵ_0 = 1/λ_0^2  completes the proof.
    
    
    In the next lemma, we show that, given a collection of Roller classes, the intersection of the associated Tits boundary realizations 
    coincides with the Tits boundary of the intersection of the convex hulls of the corresponding CAT(0) geodesic rays.
    
    
    Let v_1, …, v_k ∈(X) be Roller classes. Then there exist convex subcomplexes 
     _1, …, _k ⊂ X such that the following holds. Each _i is the cubical convex hull 
    of a CAT(0) geodesic ray γ_i, with a common basepoint.
     Furthermore,
    for every subset J ⊂{1, …, k}, we have ⋂_i ∈ J Q(v_i) = (⋂_i∈ 
    J_i).
    
    Fix a basepoint x∈ X^(0).  For 1≤ i≤ k, let _v_i X→ v_i be the gate map of Proposition <ref>, and let y_i= _v_i (x). 
    Let _i=(x,y_i) be the 
    convex subcomplex of X determined by the vertex 
    interval between x and y_i as in Definition <ref>. Then (_i) = (x, y_i) = (x,v_i), where the last equality holds by Proposition <ref>.
     By Lemma <ref>, Q(v_i)=_i.
    
    For each i, let γ_i be a CAT(0) geodesic ray that emanates from x and represents 
    φ(v_i). 
    We want to show that _i = (γ_i), the cubical convex hull of γ_i.
    
    First, we claim that (γ_i) ⊂_i. Since _i is convex in the CAT(0) metric d_X, it contains a CAT(0) geodesic from every point in the interior to every point on the boundary. In particular, it contains the unique CAT(0) geodesic γ_i from γ_i(0) = x∈_i to 
    γ_i (∞)  ∈ Q(v_i) = _i. Thus γ_i ⊂_i. Since _i is cubically convex, it follows that (γ_i) ⊂_i.
    
    
    Next, we claim that _i ⊂(γ_i), or equivalently (_i) ⊂(γ_i).  Since γ_i(0)=x ∈_i, any hyperplane ĥ∈(𝒥_i) ∖𝒲(γ_i) would separate the entire ray γ_i from 
    the entire class v_i, contradicting that ψ(γ_i(∞))=ψ(φ(v_i))=v_i, where the second equality  holds by visibility and Lemma <ref>.  Hence (_i) ⊂(γ_i), 
    and we conclude that _i = (γ_i).
    
    Finally, consider an arbitrary subset  J ⊂{1, …, k}. The inclusion (⋂_i∈ 
    J_i) ⊂⋂_i∈ IQ(v_i) is immediate. For the other inclusion, 
    let 
    b ∈⋂_i∈ JQ(v_i). Then each convex set _i contains the unique CAT(0) ray β starting at 
    x and ending at b.
    Thus β⊂⋂_i∈ J_i, hence b ∈(⋂_i∈ 
    J_i).
    
    The following related statement about ℓ^1 geodesics can be proved by an easier analogue of the proof of Lemma <ref>.
    
    Let v_1, …, v_k be arbitrary Roller classes. Then there exist convex subcomplexes  _1, …, 𝒥_k (defined in exactly the same way, namely  _i=(x,  _v_i (x)) such that each  (_i) is a UBS representing 
    v_i. Furthermore, each _i is the cubical 
    convex hull of a combinatorial geodesic, with a common basepoint. The intersection ⋂_i _i itself has the 
    property that ( ⋂_i _i) = ⋂_i ( _i). In particular, if 
    ( ⋂_i _i) is infinite, then it is an ℓ^1–visible UBS.
    
    
    The next lemma is crucial.  We will later replace the closed covering of X by Tits boundary realizations with an open covering, by 
    slightly thickening each Tits realization.  The lemma says, roughly, that for a collection of Tits boundary realizations corresponding to a 
    simplex in the nerve of the closed covering, any point in the intersection of small ϵ–neighborhoods of the Tits boundary realizations is still in 
    a f(ϵ)–neighborhood of the intersection of the Tits boundary realizations.
    
    
    There exists a constant ϵ_1>0, depending on (X), and a function f  (0,ϵ_1)→(0,π/2) such that lim_ϵ→ 0 f(ϵ) = 0 and 
    such that the following holds.  Fix ϵ∈(0,ϵ_1) and let v_0,…,v_k∈(X) satisfy 
    ⋂_i=0^kQ(v_i)≠∅.  For every a∈ X such that _T(a,Q(v_i)) ≤ϵ for all 
    i, there is a point b ∈⋂_i=0^kQ(v_i) such that
    _T(a, b) ≤ f(ϵ).
    
    We begin by defining the constant ϵ_1 and the function f  (0,ϵ_1)→(0,π/2). Let 
    λ_0, λ_1 be the constants of Lemma <ref>, which depend only on (X). Define K = 4 λ_0^2  (X). Then, we set 
    
        ϵ_1 = 4/5K,     
        f(ϵ)  = cos^-1(1 - K ϵ) ≤cos^-1 (15) < π2.
    
    The bound f(ϵ) ≤cos^-1(1/5) holds because K ϵ < K ϵ_1 = 4/5. The property lim_ϵ→ 0 f(ϵ) = 0 is now immediate.
    
    Plan of the proof.
    Let v_0,…,v_k∈(X) be Roller classes such that 
    ⋂_i=0^kQ(v_i)≠∅.
    By Lemma <ref>, there exist convex subcomplexes _0,…,_k such that ⋂_i = 0^k Q(v_i)=(⋂_i= 0^k _i). Choose  a basepoint x ∈⋂_i= 0^k _i. 
    
    Fix ϵ < ϵ_1, and let a∈ X be a point such that _T(a,Q(v_i)) ≤ϵ for all i. Let α[0,∞)→ X be a CAT(0) geodesic ray, such that α(0) = x and α(∞) = a. To prove the lemma, we will find a point b∈⋂_i=0^kQ(v_i) such that d_T(a, b) ≤  f(ϵ).
    
    We locate the point b using gate projections. Let X →⋂_i=1^k _i be the gate map.
     For t ≥ 0, let x_t = (α(t)). Since ⋂_i=0^k_i is a finite-dimensional CAT(0) 
    cube complex with no facing triple of hyperplanes, it is  proper by 
    Lemma <ref>. We will check that the sequence {x_t}_t∈ is unbounded.
      Thus the segments joining x_0 to the elements of {x_t}_t∈ 
    subconverge uniformly on compact sets to a CAT(0) geodesic ray representing some point b∈⋂_i=0^k Q(v_i).
    
    To prove that d_T(a, b) ≤ f(ϵ), we will estimate the Alexandrov angle at x = α(0) between α(t) and x_t. In order to do this, we will control the number of hyperplanes that separate α(t) from ⋂_i=0^k _i. 
    
    Main hyperplane estimate. For each t ≥ 0, let (t) be the set of hyperplanes that separate α(t) from 
    ⋂_i=0^k_i. We will prove the following double-sided estimate for all large t:
    
        1/λ_0_X(α(t),x_t) - λ_1 ≤| (t)|≤(X)  (λ_0 · 2 t ϵ + λ_1) + D,
    
    where D is a constant independent of t.
    
    The lower bound of (<ref>) is straightforward.  By Lemma <ref>, the gate map X→⋂_i = 0^k _i  is characterized by the property that a 
    hyperplane ĥ separates 
        α(t) from x_t = (α(t)) if and only if ĥ separates α(t) from ⋂_i=0^k_i.  
       In other words, (t) = (α(t), x_t).
         Hence Lemma <ref> gives
    
        1/λ_0 d_X(α(t),x_t) - λ_1 ≤ |(t)| ,
    
    as desired. By contrast, the upper bound requires some hyperplane combinatorics.
    
    
    Hyperplane sets. 
    For each i, let ℬ_i(t) be the set of hyperplanes that separate α(t) 
    from _i.  Note that (t)⊃⋃_i=0^kℬ_i(t). We claim that (t)=⋃_i=0^kℬ_i(t).
    
    Suppose that ĥ∈(t) ∖⋃_i=0^kℬ_i(t).  Then ĥ crosses each _i, so by a standard cubical 
    convexity argument, ĥ crosses ⋂_i=0^k_i and hence cannot separate any point from ⋂_i=0^k_i.  This is 
    a contradiction, and thus (t)=⋃_i=0^kℬ_i(t). 
    
    Let 𝒜_0(t)=ℬ_0(t). For i ≥ 1, let 𝒜_i(t)=ℬ_i(t) ∖⋃_j < i𝒜_j(t).  Then the 
    sets 𝒜_0(t),…,𝒜_k(t) are pairwise disjoint, and their union is (t).  For each i, let 𝒜_i = ⋃_t ≥ 0𝒜_i(t).
    Observe that every 𝒜_i is inseparable, by definition. 
    Furthermore, 𝒜_i is unidirectional. Indeed, 𝒜_i ⊂ℬ_i =  ⋃_t ≥ 0ℬ_i(t), and ℬ_i separates _i from the tail of the ray 
    α. Unidirectionality passes to subsets, hence 𝒜_i is unidirectional.
     Consequently 𝒜_i is either finite or a UBS.
    
    
    
    
    Let J⊂{0,…,k} be the set of i such that 𝒜_i is a UBS. Observe that 𝒜_i  ∩𝒜_j = ∅ for i ≠ j and _i ∈ J𝒜_i ⊂(α), which is itself a UBS. Thus, by Lemma <ref>, we have |J| ≤(X).
     We define D = ∑_i ∉ J | 𝒜_i |. 
    
    The upper bound of (<ref>). 
    Next, we will use the decomposition (t) = _i=1^k 𝒜_i(t) to prove the upper bound  of (<ref>).
    
    For each i ∈{0, …, k}, let ξ_i be a ray in _i issuing from x = α(0), such that ξ_i(∞) is a closest point in 
    Q(v_i) = _i to a.  
    Now, for all i and all t, any hyperplane ĥ∈𝒜_i(t) separates α(t) from _i and hence separates α(t) from 
    ξ_i(t).  Thus Lemma <ref> gives
    
        |𝒜_i(t)| ≤ |(α(t),ξ_i(t))| ≤λ_0 · d_X (α(t), ξ_i(t)) + λ_1.
     
    
    Now, by <cit.>, for any δ>0 there exists t_0 such that for all t>t_0, 
    we have _X(α(t),ξ_i(t))≤ t(2sinϵ/2+δ).  Since ϵ is independent of t, it follows that 
    for all sufficiently large t,  we have 
    
        _X(α(t),ξ_i(t))≤ 4tsinϵ2 < 2 t ϵ.
      
    
    
    Summing |𝒜_i(t)| over all i  gives
    
        | (t) |    = ∑_i∈ J|𝒜_i(t)| + ∑_i∉ J|𝒜_i(t)| 
           ≤∑_i ∈ J( λ_0 · d_X (α(t), ξ_i(t)) + λ_1 ) + ∑_i ∉ J | 𝒜_i | 
           ≤  |J| (λ_0 · 2 t ϵ + λ_1) + D,
    
    which proves (<ref>) because |J| ≤(X). 
    
    
    Angle estimate.
    Let x=α(0).  Set A = _X(α(0), α(t))=t (latter equality since α is a geodesic), and B = _X(α(0), x_t), and C = _X(α(t), x_t).  Let θ̅_t 
    be the Euclidean angle at the vertex corresponding to x in the Euclidean comparison triangle with sides of length A,B,C, i.e. the comparison angle between α(t) and x_t at x.  Let 
    θ_t be the Alexandrov angle at x = α(0) between x_t and α(t), so that θ_t≤θ̅_t.   
    
    We can estimate θ̅_t using the law of cosines, starting with an estimate of C. Multiplying every term of (<ref>) by λ_0 and choosing t sufficiently large yields
    
        C = d_X(α(t), x_t) ≤ 4 λ_0^2 (X) ·ϵ t = K ϵ t.
    
    Meanwhile, B can be estimated as follows:
    
        t(1-K ϵ) 
         ≤_X(α(0),α(t))-_X(α(t),x_t))
        ≤_X(α(0),x_t) = B ≤ t.
    
    Here, the first inequality is by (<ref>), the second inequality is the triangle inequality, and the final inequality 
    holds because the projection  is 1–Lipschitz for the CAT(0) metric by Lemma <ref>.  
    
    
    
    By  the cosine law and the CAT(0) inequality, we have
    
    
        2 AB cos(θ_t) ≥ 2AB cos(θ̅_t)=A^2 + B^2 - C^2.
    
    The equality is the cosine law applied to the Euclidean comparison triangle, and the inequality holds for the corresponding CAT(0) triangle.  We are interested in the former, since we will need a 
    bound on θ̅_t (which will incidentally bound θ_t).
    Substituting the bounds (<ref>) and (<ref>) into the cosine law shows that for all large t, we have
    
        2t^2cosθ̅_t  ≥  t^2+t^2(1-K ϵ)^2- t^2 (Kϵ)^2,
    
    which simplifies to
    cosθ̅_t ≥ 
    1-K ϵ. Since we have chosen ϵ∈ (0, 45K ), this ensures that θ̅_t is a small angle; more precisely θ̅_t ≤cos^-1( 1- K ϵ).
    
    Conclusion. 
    Since K ϵ < 4/5, equation (<ref>) implies 
    d_X(α(0), x_t) ≥ (1-K ϵ) t > 1/5 t.
    Thus the sequence {x_t}_t∈ is unbounded,
    and some subsequence converges to a point b∈⋂_i=0^kQ(v_i), as mentioned above.
    By <cit.>, which relates the Tits angle ∠(a,b) to the Euclidean comparison angles θ̅_t, we have 
    
        ∠(a,b)≤liminf_t→∞θ̅_t ≤cos^-1 (1 - K ϵ) = f(ϵ).
    
    Since we have already checked that f(ϵ) < π/2, this ensures  
     ∠(a,b) ≤ f(ϵ)<π/2.  In particular, _T(a,b)=∠(a,b) ≤ f(ϵ).
    
    
    
    Recall from Proposition <ref>.(<ref>),(<ref>) that for each v∈(X), there is a radius r_v<π/2 such that Q(v) is contained in the closed ball 
    B̃_T((v), r_v) in the Tits metric.
    
    
    Let ϵ_0 be the constant of Lemma <ref>. Let f  (0, ϵ_1) → be the function from Lemma <ref>.  Since lim_ϵ→ 0 f(ϵ) = 0, that lemma allows us to 
    choose a constant ϵ_2 < ϵ_1, depending  only on (X), so that f(ϵ)+ϵ≤ϵ_0 whenever 
    ϵ≤ϵ_2.  
    For each Roller class w, define a thickening constantϵ(w) = min{ϵ_0/2 ,ϵ_2, r_w/4} > 0.
    
    Since the constants ϵ_0, ϵ_2 depend only on (X), and the intrinsic radius r_w depends only on the (X)–orbit of w by Corollary <ref>,
    it follows that ϵ(w) itself depends only on the the (X)–orbit of w.
    
    For every v∈(X), there exists a subset U(v)⊂ X such that the following 
    hold:
    
      * Q(v)⊂ U(v)⊂𝒩_ϵ(v)(Q(v));
      * U(v) has diameter less than 3π/4; 
     
      * U(v) is open;
      * U(v) is convex and contractible;
     
      * U(gv) = gU(v) for all g ∈(X).
    
    Let Y be the Euclidean cone on X, with cone-point denoted 0.  
    By <cit.>, the usual cone metric _Y on Y has the 
    property that (Y,_Y) is a CAT(0) geodesic space.  We use the notation ν_δ(A) to denote the open δ–neighborhood of a set A ⊂ Y in this CAT(0) metric.
    
    We identify X 
    with the unit sphere about 0 in Y. We also set Q = Q(v) for simplicity of notation. Recall from Proposition <ref>.(<ref>) that the intrinsic radius of Q is r_v 
    ∈ [0, π/2).
    
    The convex sub-cone Z = Z(v):  Let Z⊂ Y be the subspace arising as the union of all rays in Y 
    emanating from 0 and passing through Q⊂ X.  We claim that 
    Z is convex in (Y,_Y).  Indeed, let x,y∈ Z. Then x,y 
    respectively lie on rays α_x,α_y emanating from 0 and intersecting Q 
    in points x',y'.  By <cit.>, the rays α_x,α_y determine a convex sector S ⊂ Y 
    intersecting X in the unique Tits geodesic from x' to y', which lies in 
    Q by Tits convexity of Q.  Hence S lies in Z, and thus so does 
    the _Y–geodesic from x to y, since x,y∈ S.
    
    The horoball B = B(v):  Let  c=(v) be the circumcenter of Q = Q(v). Let α =α_c be the parametrized geodesic ray in Y such that α(0)=0 and α(1)=c.  Let p  Y→ be the associated 
    horofunction, defined by 
    
        p(y)=lim_s→∞[_Y(α(s),y)-s] .
     
    Let 
    t_0=cos r_v, which is positive since r_v∈[0,π/2).
    
    Let B = B(v)=p^-1((-∞,-t_0]).  Recall from e.g. <cit.> that B is a convex 
    subset of Y.  Let K(v)=B∩ Z. See Figure <ref>.
    
    
    Q lies in K(v):  We claim that Q⊂ K(v).  Since Q is the unit sphere in Z by the definition of Y and Z, 
    it suffices to show that Q⊂ B.  To that end, fix q∈ Q, and observe that 
    _Y(q,0)=1.  Let s≫ 0 and consider the convex Euclidean triangle in Y with vertices at 0,q,α(s).  The angle in this triangle at 0 is denoted 
    θ, and we note that θ≤ r_v.  From the cosine law, we obtain 
    _Y(q,α(s))^2=s^2+1-2scosθ.  Hence 
    
        p(q)=lim_s→∞[√(s^2+1-2scosθ)-s]=-cosθ≤ - cos r_v = - t_0.
    
    Thus, by the definition of B, we have q∈ B, as 
    required.  Since Z∩ X=Q, we have in fact shown that K(v)∩ 
    X=Q. 
    
    K(v) satisfies d(0,K(v)) = t_0:  We claim that K(v) is disjoint from the open t_0–ball in Y about 
    0.  Indeed, let b∈ K(v).  Then p(b)≤ -t_0.  Hence, for any fixed 
    δ>0, and any sufficiently large s>0, we have 
    _Y(b,α(s))<s-t_0+δ.  By the triangle inequality, s≤_Y(0,b)+s-t_0+δ, i.e. _Y(0,b)>t_0-δ.  Hence 
    _Y(b,0)≥ t_0, as required.  At the same time, α = α_c is a parametrized geodesic ray and α(t_0) is a point of K(v) at distance exactly t_0 from 0, hence d(0,K_v) = t_0.
    
    
    The projection ϖ and the open set U'(v):  Let ϖ:Y ∖{0}→ X be the radial projection. Recall that ν_ρ(0) is the open ρ–neighborhood of 0. 
    We claim that for every 0 < ρ≤ 1, the restriction of ϖ to  Y ∖ν_ρ(0) is 1/ρ–Lipschitz. Indeed,  by <cit.>, it suffices to check this claim on a sector of ^2. In polar coordinates on ^2, the distance element ds satisfies ds^2 = dr^2 + r^2 dθ^2, hence the projection ϖ rescales ds by a factor of at most r^-1, hence ϖ is 1/ρ–Lipschitz when r ≥ρ. 
    
    Recall the constant ϵ(v) defined in Definition <ref>, and define a positive constant 
    
        ϵ' = ϵ'(v) = ϵ(v) /1 + ϵ(v) t_0 ∈ (0, t_0),
          which satisfies  ϵ'/t_0 - ϵ' = ϵ(v).
    
    Let U'(v) = ν_ϵ' (K(v)) be the open ϵ'–neighborhood 
    of K(v) in Y.  Since K(v) = B ∩ Z is convex and Y is CAT(0), it follows that U'(v) is convex. Furthermore, U'(v) is open and disjoint from the ball of radius t_0 - ϵ' about 
    0.  See Figure <ref>.
    
    Definition and properties of U(v):
    Let U(v)=ϖ(U'(v))⊂ X. We claim that this has all of the properties claimed in the lemma statement. First, since Q(v) ⊂ K(v) by construction, and ϖ is the identity map on X ⊂ Y, it follows that Q(v) = ϖ(K(v))⊂ U(v).
    On the other hand, since d(0, U'(v)) ≥ t_0 - ϵ',  the projection ϖ is 1/(t_0 - ϵ')–Lipschitz on U'(v). Therefore, (<ref>) implies
    
        U(v) = ϖ(ν_ϵ' (K(v)) ) ⊂ν_ϵ(v) (ϖ(K(v))) =  ν_ϵ(v) (Q(v)),
    
    proving the first bullet of the lemma.
    
    Second, recall from Definition <ref> that ϵ(v) ≤ r_v / 4. Thus Proposition <ref>.(<ref>) implies
    
        (U(v)) ≤(Q(v)) + 2ϵ(v) ≤π/2 + r_v/2 < π/2 + π/4 = 3π/4.
    
    
    Third, observe that ϖ is an open map.  Indeed, 
    Y ∖{0} is homeomorphic to X×(0,∞), and ϖ is 
    projection to the first factor, which is an open map. Thus U(v) = ϖ(U'(v)) is open.
    
    Fourth, it follows from <cit.> and the convexity of U'(v)  that U(v) is convex in X. Since U(v) has diameter less than π, it is uniquely geodesic, hence contractible.
    
    Fifth, observe that all of the ingredients in the definition of U(v) are (X)–equivariant. Indeed, the intrinsic radius r_v is invariant under (X), hence the number t_0 = cos(r_v) is as well. Thus the definitions of the sub-cone Z(v), the horoball B(v), and the set K(v) = Z(v) ∩ B(v) are all (X)–equivariant. The constant ϵ'(v), defined in (<ref>) is invariant under (X), because both t_0 and ϵ(v) are. It follows that U(v) = ϖ(ν_ϵ' (K(v)) ) is also (X)–equivariant.
    
    
    Recall that in Section <ref>, we have defined a simplicial complex 𝒩_T.
    By Corollary <ref>, 𝒩_T coincides with the nerve of the cover of X by the closed sets Q(v)  for v ∈ (X). By Lemmas <ref> and <ref>,  the open sets U(v) for v ∈ (X) also cover X. 
    
    By analogy with Definition <ref>, we define a simplicial complex 𝒞_T with vertex set X, where vertices v_0, …, v_n ∈ X span an n–simplex if and only if ⋂_i=0^n U(v_i)≠∅.
    The content of the following lemma is that 𝒞_T is isomorphic to 𝒩_T.
     
    
    
    
    For Roller classes v_0, …,v_n ∈(X), we have ⋂_i=0^n U(v_i)≠∅ if and only if 
    ⋂_i=0^n Q(v_i)≠∅. Consequently, the identity map (X) →(X) induces an (X)–equivariant simplicial isomorphism 𝒞_T  →𝒩_T.
    
    Observe that ⋂_i=0^n Q(v_i)≠∅ trivially implies ⋂_i=0^n U(v_i)≠∅. 
    For the other direction, we assume ⋂_i=0^n U(v_i) ≠∅ and aim to show ⋂_i=0^n Q(v_i)≠∅. 
    
    We will argue by induction on n. 
    
     In the base case, n=1, suppose that U(v_0) ∩ U(v_1) ≠∅. Since U(v_i) ⊂𝒩_ϵ(v_i)(Q(v_i)), and ϵ(v_i) ≤ϵ_0/2 by Definition <ref>, it follows that there are points a_i ∈ Q(v_i) such that d_T(a_0, a_1) < ϵ_0. But then Lemma <ref> implies Q(v_0) ∩ Q(v_1) ≠∅, proving the base case.
    
    For the inductive step, assume that ⋂_i=0^n U(v_i) ≠∅ and
    ⋂_i=0^n-1Q(v_i)≠∅. We claim that there is a Roller class w ∈(X) such that ⋂_i=0^n-1Q(v_i)=Q(w).
    
    By Lemma <ref>, we have convex subcomplexes _0, …, _n-1⊂ X, such that Q(v_i) = _i 
    and ⋂_i=0^n-1Q(v_i) = ⋂_i=0^n-1_i. By Lemma <ref>, the hyperplane 
    collection (_i) is a UBS. Furthermore, since each _i is convex, we have (⋂_i) 
    = ⋂(_i), which is a UBS because ⋂_i is unbounded. By Lemma <ref>, the 
    UBS (⋂_i) represents a Roller class w', which means that  
    Q(w') =  ⋂_i=0^n-1_i = ⋂_i=0^n-1Q(v_i). Now, we let w = ψ(φ(w')). Then 
    Definition <ref> says that w ∈(X), and Proposition <ref>.<ref> says that 
    Q(w) = Q(w') = ⋂_i=0^n-1Q(v_i), proving the Claim.
    
    Next, we claim that Q(v_n)∩ Q(w) ≠∅. Since Q(w) = ⋂_i=0^n-1Q(v_i), this will complete the inductive step and prove the Lemma.
    
    Suppose for a contradiction that Q(v_n)∩ Q(w) = ∅. Then, by Lemma <ref>, we have
    _T(Q(v_n),Q(w))>ϵ_0.  Let ϵ_2 be as in Definition <ref>.
    Fix a∈⋂_i=0^n U(v_i) ⊂⋂_i=0^n𝒩_ϵ(v_i)(Q(v_i)), which ensures that _T(a,Q(v_n))<ϵ_2.  Since ϵ(v_i) ≤ϵ_2 for each v_i,  
    Lemma <ref> implies _T(a,Q(w))<f(ϵ_2).  
    Thus _T(Q(v_n),Q(w))<ϵ_2+f(ϵ_2) ≤ϵ_0, a contradiction.  This proves the Claim and the equivalence ⋂_i=0^n Q(v_i)≠∅⇔⋂_i=0^n U(v_i)≠∅.
    
    This gives the simplicial isomorphism 𝒞_T →𝒩_T. This isomorphism is (X)–equivariant, by Corollary <ref> 
    and Proposition <ref>.
    
    
     §.§ Homotopy equivalence of X and 𝒩_T
    
    There is an  homotopy equivalence from  the simplicial complex 𝒩_T to X. 
    By Corollary <ref>, 𝒩_T is the nerve of the covering of X by the closed sets Q(v), where v varies over 
    (X).
    
    By Proposition <ref>, X admits an open covering { U(v) : v∈(X) }, with each U(v) a 
    convex, uniquely geodesic subspace of X.  Hence, if v_0,…,v_n∈(X), then either 
    ⋂_i=0^nU(v_i)=∅, or ⋂_i=0^nU(v_i) is contractible. Let ℒ_T be the nerve of this open covering. By the Equivariant Open Nerve Theorem <ref>,
    there is an  homotopy equivalence ℒ_T → X.
    
    As above, let 𝒞_T be the simplicial complex with one vertex for each v∈(X), with v_0,…,v_n spanning an 
    n–simplex whenever ⋂_i=0^nU(v_i)≠∅.  Note that 𝒞_T is not necessarily isomorphic to ℒ_T, since we may have U(v_i)=U(v_j) for some pair v_i,v_j with i≠ j.  But 𝒞_T is 
    homotopy-equivalent to ℒ_T, which can be seen as follows.  The (X)–equivariant assignment 
    v↦ U(v) (i.e. the surjection 𝒞_T^(0)→ℒ_T^(0)) determines an equivariant simplicial map 𝒞_T →ℒ_T such that the preimage of each 0–simplex U(v) is the full subcomplex of 𝒞_T spanned by the set of w 
    with 
    U(v)=U(w).  Since any finite set of such w span a simplex of 𝒞_T, this preimage is contractible: it is 
    homeomorphic to the cone on the link of any of its vertices.  Hence the map 𝒞_T →ℒ_T is a homotopy 
    equivalence, by Quillen's fiber theorem (see e.g. <cit.>).
    
    To conclude, recall that by Lemma <ref>, we have an equivariant simplicial isomorphism 𝒞_T →𝒩_T. Hence we have a chain of  homotopy equivalences
    
        𝒩_T  𝒞_T ℒ_T  X.
    
    
     §.§ Cuboid generalization
    
    
    All of the results of this section have a straightforward generalization to the cuboid setting. In the following description, we refer to the notation introduced in Section <ref>.
    
    Definition <ref> generalizes immediately to give a set of maximal ℓ^2 visible Roller classes, namely ^ρ(X) ⊂^ρ(X). Following Definition <ref>, we get a simplicial complex _T^ρ with vertex set ^ρ(X), where vertices v_0, …, v_n span an n–simplex if and only if ⋂_i=1^n Q^ρ(v_i) ≠∅. Then, Lemmas <ref> and <ref> generalize immediately because their proofs are assembled from the results of Section <ref>, and we have already checked that those results generalize to cuboids. Thus Corollary <ref> generalizes as well, and we learn that _T^ρ is the covering of ^ρ X by the closed sets {Q^ρ(v) : v ∈^ρ(X) }.
    
    (Recall that Remark <ref> outlined an argument that (X) = ^ρ(X) for every admissible rescaling 
    ρ. It follows that (X) = ^ρ(X) as well.  The nerves _T and _T^ρ can then be 
    shown to coincide, as mentioned in Remark <ref>. However, we do not use this.)
    
    Moving ahead to Section <ref>, the results generalize as follows. The existence statement of Lemma <ref> extends, with the modification that the constant ϵ_0 depends on (X) and ρ. This is because the proof of Lemma <ref> uses the constants λ_0, λ_1 of Lemma <ref>, which needs to be replaced by the constants λ_0^ρ, λ_1^ρ of Lemma <ref>. Lemma <ref> extends to cuboids as well, because the proof of that lemma uses combinatorial arguments in combination with the d_X^ρ–convexity of cubical convex hulls.
    Similarly, Lemma <ref> extends: its proof works perfectly well in the cuboid metric d_X^ρ, once we substitute Lemma <ref> for Lemma <ref>. As above, the outputs of that lemma depend on both (X) and ρ. Combining these ingredients, we can follow Definition <ref> to define a thickening constant ϵ^ρ(w) > 0 for every Roller class w. This constant depends only ρ and the ^ρ(X)–orbit of w.
    
    Proposition <ref> extends verbatim to cuboids. Indeed, its proof is a CAT(0) argument that takes place in the Euclidean cone on X, which works equally well in the Euclidean cone on ^ρ X. (The proof also uses Proposition <ref>, which works for cuboids.) At the end of the lemma, we get a collection of open sets U^ρ(v) for v ∈^ρ(X), which is invariant under ^ρ(X).
    
    By analogy with Definition <ref>, we define a simplicial complex 𝒞_T^ρ, where the simplices are defined by intersection patterns of the open sets U(v_i) for v_i ∈^ρ(X). Now, Lemma <ref> extends verbatim to give an ^ρ(X)–equivariant simplicial isomorphism 𝒞_T^ρ→_T^ρ. The proof of Theorem <ref> also extends verbatim, because all of its ingredients extend. Thus we obtain the following cuboid extension of 
    Theorem <ref>:
    
    
    Let ρ be a G–admissible hyperplane rescaling of X. Then there is a  homotopy homotopy equivalence _T^ρ→^ρ X. 
    
    
    § PROOF OF THE MAIN THEOREMS
    
    
     In this section, we prove Theorem <ref>, which was stated in the Introduction. That is, we construct the following commutative diagram of  homotopy equivalences:
     X       ^       X  
       _      _   
          _ X      
    
    The homotopy equivalence X → X will be proved in Proposition <ref>, while the homotopy equivalence X → X will be proved in Corollary <ref>. At the end of the section, we check that all of the arguments extend to cuboids, proving Theorem <ref>.
    
    To prove Corollary <ref>, we first study a subcomplex of X.  
    
    
    Let X be the  subcomplex of X consisting of all simplices corresponding to chains 
    v_0≤⋯≤ 
    v_n such that v_i∈(X) for 0≤ i≤ n. 
    
    For each v∈(X), let Σ_v be the connected subcomplex of X consisting of all simplices 
    corresponding to 
    chains v_0≤⋯≤ v_n for which:
    
      *  each v_i∈(X);
         
      * v_n = v.
    
    
     §.§ Closed cover of X
    
    
    Next, we show that the complexes Σ_v yield a closed covering of X, and use this covering to build a nerve.
    
    
    The set {Σ_v:v∈(X)} is a closed covering of X.  Moreover, for all 
    v,v_0,…,v_n∈(X), we have the following:
    
      * Σ_v is finite.
         
      * Σ_v_i=Σ_v_j only if v_i=v_j.
         
      * ⋂_i=0^nΣ_v_i is either empty or contractible.
         
      *  For every g ∈(X), we have g Σ_v = Σ_gv.
    
    Let w ∈(X).  Then there exists v ∈(X) with w ≤ v, and hence w ∈Σ_v^(0).  Thus 
    {Σ_v:v∈(X)} is a closed covering of X.
    
    Let v be a (visible) Roller class. By Corollary <ref>, there are finitely many other classes w such that w ≤ v. This proves 
    assertion <ref>. 
    
    
    
    Now suppose that v_i,v_j are (visible) Roller classes satisfying Σ_v_i=Σ_v_j.  Since v_j ∈Σ_v_i, 
    we have v_j≤ v_i.  Likewise, v_i ≤ v_j.  Hence v_i=v_j, proving assertion <ref>.
    
    Next, let v_0,…,v_n∈(X) and suppose that ⋂_i=0^nΣ_v_i≠∅.  First, note that 
    Σ_v_i=v_i L_v_i, where L_v_i (the link of v_i in Σ_v_i) is a subcomplex of X and  denotes the simplicial 
    join operation.   Hence Σ_v_i is topologically a cone, and is thus contractible.
    
    For each i, let 𝒱_i be a UBS representing v_i (recall Definition <ref>).  Then 
    ⋂_i=0^n𝒱_i is unidirectional and contains no facing triple, since those properties hold for each 𝒱_i and are inherited by subsets.  Second, ⋂_i=0^n𝒱_i is inseparable, because each 𝒱_i is.
    
    Now, if u ∈⋂_i=0^nΣ_v_i is a 0–simplex, then u ≤ v_i for all i, so 
    u is represented by a UBS of the form ≼⋂_i=0^n𝒱_i.  
    Hence ⋂_i=0^n𝒱_i is infinite. Combined with the above discussion, this shows that 
    ⋂_i=0^n𝒱_i is a UBS.  Let v be the corresponding Roller class. Since ≼⋂_i=0𝒱_i, we have u ≤ v.  
    
    Since each such u is ℓ_2–visible, the set of visible Roller classes w with w≤ v is nonempty.  Hence there is a unique Roller class m such that m≤ v, and m 
    is ℓ_2–visible, and m is ≤–maximal with those properties, by Lemma <ref> and Definition <ref>.  Since each u∈⋂_i=0^nΣ_v_i satisfies u≤ m∈ X, there is a subcomplex L⊂ X such that ⋂_i=0^nΣ_v_i=m⋆ L, so ⋂_i=0^nΣ_v_i is contractible in X.
    
    
    Finally, statement <ref> follows from the equivariance of (X) and the partial order ≤.
    
    Let 𝒩_ be the nerve of the closed covering {Σ_v:v∈(X)} of X.  By 
    Lemma <ref>.<ref>, 𝒩_ has vertex-set (X), 
    and v_0,…,v_n span an n–simplex if and only if 
    ⋂_i=0^nΣ_v_i≠∅. By 
    Lemma <ref>.<ref>, (X) acts by simplicial automorphisms on 𝒩_.
    
    Let v_0,…,v_n∈(X).  Then 
    
        ⋂_i=0^nΣ_v_i≠∅ ⇔ ⋂_i=0^nQ(v_i)≠∅.
    
    Consequently, there is an (X)–equivariant simplicial isomorphism 𝒩_→𝒩_T.
    
    Suppose that there exists a∈⋂_i=0^nQ(v_i).  Then Lemma <ref> says ψ(a) ≤ v_i for all i.  Hence, by Definition <ref>, we have ψ(a)∈Σ_v_i for all i.  
    
    Conversely, suppose that there exists a vertex (i.e. a Roller class) w∈⋂_i=0^nΣ_v_i.  Then w ≤ v_i 
    for all i, by definition.  Hence, by Lemma <ref>, Q(w)⊂ Q(v_i) for all i, from which it 
    follows that φ(w)∈⋂_i=0^nQ(v_i). 
    
    Finally, the simplicial isomorphism 𝒩_→𝒩_T comes from identifying the 0–skeleta of 𝒩_  and 𝒩_T with (X).
    
    
     §.§ Homotopy equivalence between X and X
    
    We can now assemble the proof that X is homotopy equivalent to X. We do this in two propositions:
    
    
    
    There is an  homotopy equivalence  X → X.
    
    Consider the covering {Σ_v:v∈(X)} of X by the subcomplexes Σ_v, coming from 
    Lemma <ref>.  By Definition <ref>, the nerve of this cover is  
    𝒩_.  By Lemma <ref>.<ref>, the intersection of any finite 
    collection of the Σ_v is either empty or contractible.  
    Hence, by the Equivariant Simplicial Nerve Theorem <ref>, there is an  homotopy equivalence X →𝒩_.
    
    By Lemma <ref>, there is a simplicial isomorphism 𝒩_→𝒩_T. Finally, by Theorem <ref>, there is an  homotopy equivalence 𝒩_T → X. 
    Putting it all together, we obtain a chain of  homotopy equivalences
    
        X 𝒩_𝒩_T   X.
    
    The inclusion X ↪ X is an (X)–equivariant homotopy equivalence. Its homotopy inverse is an  deformation retraction X → X.
    
    First, observe that since X is (X)–invariant by Definition <ref>, and the set (X) is (X)–invariant by Definition <ref>, the inclusion  X ↪ X is (X)–equivariant.
    
    In the remainder of the proof, we will construct a deformation retraction X → 
    X that serves as a homotopy inverse to the inclusion X ↪ X. 
    
    Let w be an invisible Roller class (viewed as a 0–simplex of X). 
     By Lemma <ref>, w is not minimal, so there exists a 
    minimal Roller class m with m < w.  Let n(w)≥1 be the maximum length of a 
    chain of the form m < ⋯ < w with m a minimal Roller class. 
    
    Let D be the maximal number such that there exists an invisible Roller class w with n(w)=D. By 
    Remark <ref>, every simplex in X has at most X vertices, hence D ≤ X.
    
    
    Let I_n be the set of invisible Roller classes v with n(v)=n.
    Then 
    
        ( X)^(0)= ( X)^(0)⊔_n=1^ DI_n.
      
    Let ( X)_0= X.  For 1≤ N≤  D, let ( X)_N be the subcomplex spanned by 
    ( X)^(0)⊔_n=1^NI_n, so
    
        X = ( X)_0 ⊂( X)_1⊂⋯⊂( X)_D= X.
    
    
    Given a Roller class w and a positive integer n ≤ D, define the open starst_n(w) to be the union of {w} and all of the 
    open simplices of ( X)_n whose 
    closures contain w.  Let St_n(w) be the union of all (closed) simplices of 
    ( X)_n containing w.  Define the  (downward) linkL_n(w)=St_n(w) ∖ st_n(w).
    
    
    For w ∈  I_n, we have L_n(w) ⊂ ( X)_n-1.
    
    
    Let w∈ I_n ⊂ ( X)_n.  Let σ be a maximal simplex of ( X)_n 
    containing w and lying in ( X)_n.  Let v_0<⋯<v_m be the 
    corresponding chain, with w=v_i for some i.  Since n(w)=n, the chain 
    v_0 <⋯<v_i has length at most n. 
    
    First, consider v_j for j<i.  If v_j is visible, then v_j∈( X)_0⊂( X)_n-1.  If 
    v_j is invisible, then since v_0 <⋯ < v_j is a chain of length less than 
    n, and σ is maximal, n(v_j)<n, hence v_j∈( X)_n-1.  
    
    Next, consider v_j for j>i.  If v_j is visible, then v_j∈( X)_0⊂( X)_n-1.  If 
    v_j is invisible, then v_j∉I_n, since there is a chain 
    v_0 <⋯< v_j of length more than n = n(v_i), which would contradict the containment σ⊂ ( X)_n.
    
    Hence the simplex σ' corresponding to the chain 
    v_0<⋯<v_i-1<v_i+1<⋯ <v_m lies in ( X)_n-1.  
    This proves the claim.
    
    Contractibility of links:  Now, fix w ∈  I_n. We will show that L_n(w) is 
    contractible.  Establishing this involves several claims, leading up to Claim <ref>.
    
    
    For a minimal Roller class with m∈ L_n(w), let St(m) = ⋃_n St_n(m) denote the star of m in X.  Then:
    
      * L_n(w)∩ St(m) is topologically a cone with cone-point m.
         
      * L_n(w) is the union of the subcomplexes L_n(w)∩ St(m), as m varies over  the finitely many minimal Roller classes with 
    m ≤ w.
    
    
    Let L(m) denote the link of m in X. Then, by definition, St(m) decomposes as a join: St(m)=m  L(m).  Moreover, m∈ L_n(w), so 
    
        L_n(w)∩ St(m)=  L_n(w) ∩ (m  L(m)) = m (L_n(w)∩ L(m)),
    
     which proves the first assertion.
    
    By Corollary <ref>, there are finitely many minimal Roller classes m ≤ w. For each such m, we clearly have L_n(w)∩ St(m)⊂ L_n(w).  Conversely, if v∈ L_n(w), 
    then there exists a minimal class m such that m ≤ v and m ≤ w, hence v∈ L_n(w)∩ St(m).  This proves  the claim.
    
    
    
    Let m_0, …, m_k be distinct minimal Roller classes with m_i < w for all i.  Then ⋂_i=0^k St(m_i) ∩ L_n(w) is  topologically a cone, and is in particular nonempty.
    
    
    By 
    Lemma <ref>, each m_i is ℓ^2–visible, so we can choose CAT(0) geodesic rays ξ_i:[0,∞)→ X such 
    that ξ_i(0)=ξ_j(0) for all i, and such that ξ_i(∞)=φ(m_i) for each i.  
    For each i, define ℳ_i=(ξ_i), a UBS representing m_i.
    Since m_i is minimal 
    for all i, Lemma <ref> implies the intersection ℳ_i∩ℳ_j is finite whenever i ≠ j.  
    Moving the common basepoint ξ_1(0) = … = ξ_k(0) ensures that ℳ_i∩ℳ_j=∅ for all i 
    ≠ j, and that each ℳ_i is the inseparable closure of an infinite descending chain.  Indeed, by moving the 
    basepoint across each of the finitely many hyperplanes appearing in some ℳ_i∩ℳ_j, we arrange the 
    first property, and the inseparable closure property holds by Lemma <ref>, Lemma <ref>, 
    and minimality of the m_i.
    
    Let 𝒜 be a UBS representing w. Since m_i ≤ w for all i, we have ℳ_i ≼𝒜 for each i.
    Thus it is readily checked that ⋃_i=0^kℳ_i is a UBS. 
    
    Consider a pair of indices i≠ j. Then since ⋃_i=0^kℳ_i is unidirectional and ℳ_i ∩ℳ_j = ∅,  
    any pair of hyperplanes  ĥ_i ∈ℳ_i and ĥ_j ∈ℳ_j must cross. Indeed, ĥ_i ≠ĥ_j, and ĥ_i is the base of a 
    chain in _i, and ĥ_j is the base of a chain in _j.  If ĥ_i, ĥ_j did not cross, then the union of this pair of chains 
    would violate unidirectionality of _i∩_j. 
    
    Thus, by Lemma <ref>, the convex hull of 
    ⋃_i=0^kξ_i is isometric to ∏_i=0^kY_i, where Y_i is the 
    cubical convex hull of ξ_i.  For each t>0, let x_t be the image of (ξ_0(t),…,ξ_k(t)) under the isometric 
    embedding ∏_i=0^kY_i→ X.  Then segments joining the basepoint to the points x_t converge uniformly on compact sets to a geodesic ray representing a point b∈ X with the property 
    that ψ(b)=u is 
    represented by = _i=0^kℳ_i.  Hence u is visible by Definition <ref>.  Moreover, m_i ≤ u ≤ w 
    for all i. To complete the proof of the claim, we will show that u is the promised cone point of ⋂_i=0^k St(m_i) ∩ L_n(w).
    
    For each i, the fact that  m_i ≤ u implies u∈ St(m_i).  On the other hand, u≠ w since u is visible but w is 
    not.  Thus u < w, so u∈ L_n(w).  Thus far, we have shown that ⋂_i=0^k St(m_i) ∩ L_n(w) ≠∅. 
    Now, suppose v∈ L_n(w)∩ St(m_i) for all i.  To complete the claim, we must show that u and v are ≤–comparable. By definition, m_i ≤ v for all i, hence ℳ_i ≼ for all i, where  is a UBS representing . Therefore, = _i=0^kℳ_i ≼, which implies u ≤ v. Thus ⋂_i=0^k St(m_i) ∩ L_n(w) is a cone with cone point u, completing Claim <ref>.
    
    
    L_n(w) is contractible. 
    
    
    By Claim <ref>, L_n(w) is a finite union of subcomplexes L_n(w)∩ St(m), where m varies over the minimal 
    Roller classes satisfying m ≤ w.  By Claim <ref>, any collection of the L_n(w)∩ St(m) 
    intersect in a contractible subcomplex.  Hence, by the Simplicial Nerve Theorem <ref>, 
    L_n(w) is homotopy equivalent to the nerve of this covering. (We do not need to check equivariance at this step.) But, since any collection of the L_n(w)∩ St(m) 
    have nonempty intersection, this nerve is a finite 
    simplex and thus contractible.  Hence L_n(w) is contractible.
    
    
    
    Conclusion:  We have shown that the following hold for 1≤ 
    n≤ D:
    
      *  Claim <ref> says that for each vertex v∈( X)_n ∖ ( X)_n-1, the link in ( X)_n of 
    v is contained in ( X)_n-1;
    
      *  Claim <ref> says that for each vertex v∈( X)_n ∖ ( X)_n-1, the link in ( X)_n of 
    v is contractible.
    
    The first fact says that the open stars st_n(v) of the vertices 
    v∈( X)_n ∖ ( X)_n-1 are pairwise disjoint.  Together with the second 
    fact, this implies that ( X)_n is homotopy equivalent to 
    
        ( X)_n-1  =   ( X)_n ∖( ⋃_v∈( X)_n^(0)∖ ( X)_n-1^(0)st_n(v) ).
    
    It follows that we can independently deformation retract the various open stars st_n(v) to the corresponding links L_n(v) to get a deformation retraction ( X)_n→( X)_n-1 that is a homotopy inverse for the inclusion.
    Composing these retractions (for 1≤ n≤ D) gives the desired deformation retraction X → X. 
    
    Finally, recall from the discussion after Definition <ref> that every homotopy inverse of a (X)–equivariant inclusion X → X  is itself an  homotopy equivalence. Thus we have an  deformation retraction X → X.
    
    
    
    Combining Propositions <ref> and <ref> gives a proof of half of Theorem <ref>.
    
    
    
    There is an  homotopy equivalence X → X.
    
    
     §.§ Homotopy equivalence between X and X
    
    
    
    The following proposition proves the homotopy equivalence of the simplicial boundary and the simplicial Roller boundary, completing the proof of Theorem <ref>.
    
    
    There is an  homotopy equivalence X → X.
    
    Let σ be a maximal simplex of X, corresponding to a class [_σ] ∈𝒰ℬ𝒮(X). Then, by Theorem <ref>, v_σ = ([_σ]) is a maximal Roller class.
    
    Let 𝒜 be the nerve of the covering of X by  maximal simplices.  Now, since any 
    collection of maximal simplices intersect in ∅ or a simplex, and simplices are contractible, 
    the Equivariant Simplicial Nerve Theorem <ref>
    provides an  homotopy equivalence X →𝒜.
    
    Now, for each maximal Roller class v, consider the subcomplex Υ_v of X consisting of all simplices 
    corresponding to chains in which v is the maximal element.  Note that the set of such Υ_v is a cover of X.  
    
    A simpler version of the proof of Lemma <ref> implies that for all finite collections 
    { v_1,…, v_n } of maximal Roller classes, ⋂_i=1^nΥ_v_i is empty or contractible.  Indeed, suppose this 
    intersection is nonempty.  Exactly as in the proof of Lemma <ref>, each v_i corresponds 
    to a commensurability class [𝒱_i] of UBSes whose intersection is a UBS 𝒱, which in turn determines a 
    ≤–maximal Roller class v such that v≤ v_i for all i.  As in Lemma <ref>, 
    this implies that ⋂_i=1^nΥ_v_i is a cone with cone-point v.  (In the context of 
    Lemma <ref>, there is an additional step to check that v is visible, but that is 
    unnecessary here since we are working in all of X rather than in ^∢ X.)
    
    Let ℬ be the nerve of the covering of 
    X by the subcomplexes Υ_v, as v varies over the maximal Roller classes. Observe that the assignment v ↦Υ_v is a bijection from the set of maximal Roller classes to ℬ^(0). By Theorem <ref>, as above, there is an  homotopy equivalence X →ℬ.
    
    
    To conclude, we will show that 𝒜 and ℬ are equivariantly isomorphic.  The vertex set of 𝒜 is the set of maximal simplices 
    σ of X, so we may define a function f 𝒜^(0)→ℬ^(0) via the composition
    
        σ↦ [_σ] ↦ v_σ↦Υ_v_σ,
    
    where the middle arrow is the equivariant map  of Theorem <ref>.  Since both σ and v_σ are maximal by definition, the map f is a bijection by Theorem <ref>.<ref>. Every arrow is (X)–equivariant by construction.
    
    
    To extend f to a simplicial isomorphism f 𝒜→ℬ, it suffices to check that for all maximal simplices 
    σ_0,…,σ_n of X, we have ⋂_i=0^nσ_i≠∅ if and only if 
    ⋂_i=0^nΥ_v_σ_i≠∅; that this is sufficient follows since 𝒜 is the nerve of the covering of X by maximal simplices and ℬ is the nerve 
    of the covering of X by the subcomplexes Υ_v.  
    
    Suppose that ⋂_i=0^nσ_i≠∅.  Let 𝒱_i be a UBS representing σ_i.  So, 𝒱_i also represents the corresponding Roller class f(σ_i).  Let 
    𝒱=⋂_i=0^n𝒱_i, and note that 𝒱 is infinite.  Then by Remark <ref>, 𝒱 is an ℓ^1–visible UBS. Hence 
    𝒱 represents a Roller class w such that w≤ v_σ_i for all i.  Thus 
    ⋂_i=0^nΥ_v_σ_i contains w.  The converse is similar.  Hence f extends to an isomorphism, and 
    it follows that 
    
        X 𝒜ℬ X
    
    is an  homotopy equivalence.
    
    
     §.§ Cuboid generalization
     We can now conclude the proof of 
    Theorem <ref>.
    
    
    Let G be a group acting on X by cubical automorphisms, and let ρ be a G–admissible rescaling of X, with rescaled metric d_X^ρ. Recall from Definition <ref> that the action of G factors through ^ρ(X). In Section <ref>, we have checked that all of the constructions and results about the Tits boundary X also apply to ^ρ X, the Tits boundary of the rescaled metric (X, d_X^ρ), in a G–equivariant way.
    
    In Section <ref>, we have checked that the constructions of open and closed nerves for X also work for ^ρ X. In particular, by Theorem <ref>, there is a  homotopy equivalence between ^ρ X and the nerve
     _T^ρ of the closed cover  {Q^ρ(v) : v ∈^ρ(X)}.
     
    Now, we inspect the results of this section. In Lemma <ref>, one simply needs to replace (X) by ^ρ(X) and (X) by ^ρ(X); the same exact proof then applies. 
    In Definition <ref>, replacing (X) by ^ρ(X) yields a nerve _^ρ. Then the proof of Lemma <ref> extends verbatim to give an ^ρ(X)–equivariant simplicial isomorphism _^ρ→_T^ρ. Proposition <ref> extends verbatim, because its proof is a top-level assembly of previous results. Similarly, Proposition <ref> extends immediately to cuboids, because its proof is a topological argument about simplicial complexes. (The proof of Proposition <ref> does use several lemmas from Sections <ref> and <ref>, particularly in Claim <ref>, but all of those lemmas have been extended to cuboids. Compare Remark <ref>.) Combining the cuboid versions of Propositions <ref> and <ref> gives a  homotopy equivalence X →^ρ X.
    
    Finally, note that the  homotopy equivalence X → X established in Proposition <ref> is also a  homotopy equivalence, because G acts by cubical automorphisms. Thus we have both of the  homotopy equivalences claimed in the theorem.
    amsalpha